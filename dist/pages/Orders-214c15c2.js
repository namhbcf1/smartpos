import{u as e,g as n,j as s,E as t,x as r,J as i,B as a,i as l,l as c,G as h,K as d,N as o,y as x,W as j,X as m,Y as u,n as g,Z as p,_ as y,$ as v,a0 as f,a1 as b,a2 as S,C,O as _,m as w,h as T,a4 as k,a5 as W,a6 as I,a7 as z,o as P,a9 as B}from"../chunks/mui-core-c8a509c2.js";import{r as O}from"../chunks/react-vendor-546521e5.js";import{a as R}from"../chunks/ui-vendor-6aa703b7.js";import{f as $,a as L}from"../assets/index-e3f8a988.js";import{$ as G,p as K,a0 as N,_ as D,a1 as q,S as A,F as E,Y as H,Z as X,o as V,E as F,G as U}from"../chunks/mui-icons-38bddb39.js";import"../chunks/query-vendor-a9f5ea8b.js";import"../chunks/utils-vendor-11713830.js";const Y=()=>{const Y=e();n(Y.breakpoints.down("md"));const{enqueueSnackbar:Z}=R(),[J,Q]=O.useState([]),[M,ee]=O.useState(!0),[ne,se]=O.useState(0),[te,re]=O.useState(10),[ie,ae]=O.useState(0),[le,ce]=O.useState(""),[he,de]=O.useState(""),[oe,xe]=O.useState(""),[je,me]=O.useState(null),[ue,ge]=O.useState(!1),[pe,ye]=O.useState(!1),[ve,fe]=O.useState(""),[be,Se]=O.useState(""),[Ce,_e]=O.useState(!1),[we,Te]=O.useState({totalOrders:0,totalRevenue:0,pendingOrders:0,completedOrders:0}),ke=async()=>{try{ee(!0);const e=new URLSearchParams({page:(ne+1).toString(),limit:te.toString()});le&&e.append("search",le),he&&e.append("payment_status",he),oe&&e.append("payment_method",oe);const n=await L.get(`/sales?${e.toString()}`);if(n.success){Q(n.data.data||[]),ae(n.data.pagination?.total||0);const e=n.data.data||[];Te({totalOrders:e.length,totalRevenue:e.reduce((e,n)=>e+n.total_amount,0),pendingOrders:e.filter(e=>"pending"===e.payment_status).length,completedOrders:e.filter(e=>"paid"===e.payment_status).length})}}catch(e){Z("Lỗi khi tải danh sách đơn hàng",{variant:"error"})}finally{ee(!1)}};O.useEffect(()=>{ke()},[ne,te,le,he,oe]);const We=e=>{switch(e){case"paid":return"success";case"pending":return"warning";case"cancelled":return"error";default:return"default"}},Ie=e=>{switch(e){case"paid":return"Đã thanh toán";case"pending":return"Chờ thanh toán";case"cancelled":return"Đã hủy";default:return e}},ze=e=>{switch(e){case"cash":return"Tiền mặt";case"card":return"Thẻ";case"bank_transfer":return"Chuyển khoản";default:return e}};return s.jsxs(t,{maxWidth:"xl",sx:{py:{xs:1,sm:2},px:{xs:1,sm:2,md:3},minHeight:"100vh",bgcolor:"grey.50"},children:[s.jsx(r,{elevation:1,sx:{p:{xs:2,sm:3},mb:3,borderRadius:2,bgcolor:"white"},children:s.jsxs(i,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},spacing:2,children:[s.jsxs(a,{children:[s.jsxs(l,{variant:"h4",sx:{display:"flex",alignItems:"center",gap:1,fontSize:{xs:"1.5rem",sm:"2rem",md:"2.125rem"},fontWeight:600,color:"primary.main",mb:1},children:[s.jsx(G,{sx:{fontSize:"inherit"}}),"Quản lý đơn hàng"]}),s.jsx(l,{variant:"body1",color:"text.secondary",sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:"Theo dõi và quản lý tất cả đơn hàng"})]}),s.jsxs(i,{direction:"row",spacing:1,children:[s.jsx(c,{variant:"outlined",startIcon:s.jsx(K,{}),onClick:ke,disabled:M,children:"Làm mới"}),s.jsx(c,{variant:"outlined",startIcon:s.jsx(N,{}),children:"Xuất dữ liệu"})]})]})}),s.jsxs(h,{container:!0,spacing:3,sx:{mb:3},children:[s.jsx(h,{item:!0,xs:12,sm:6,md:3,children:s.jsx(d,{children:s.jsx(o,{children:s.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(a,{children:[s.jsx(l,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Tổng đơn hàng"}),s.jsx(l,{variant:"h5",component:"div",children:we.totalOrders})]}),s.jsx(G,{color:"primary",sx:{fontSize:40}})]})})})}),s.jsx(h,{item:!0,xs:12,sm:6,md:3,children:s.jsx(d,{children:s.jsx(o,{children:s.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(a,{children:[s.jsx(l,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Tổng doanh thu"}),s.jsx(l,{variant:"h5",component:"div",children:$(we.totalRevenue)})]}),s.jsx(D,{color:"success",sx:{fontSize:40}})]})})})}),s.jsx(h,{item:!0,xs:12,sm:6,md:3,children:s.jsx(d,{children:s.jsx(o,{children:s.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(a,{children:[s.jsx(l,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Chờ thanh toán"}),s.jsx(l,{variant:"h5",component:"div",children:we.pendingOrders})]}),s.jsx(q,{color:"warning",sx:{fontSize:40}})]})})})}),s.jsx(h,{item:!0,xs:12,sm:6,md:3,children:s.jsx(d,{children:s.jsx(o,{children:s.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(a,{children:[s.jsx(l,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Đã hoàn thành"}),s.jsx(l,{variant:"h5",component:"div",children:we.completedOrders})]}),s.jsx(G,{color:"success",sx:{fontSize:40}})]})})})})]}),s.jsx(r,{elevation:1,sx:{p:{xs:2,sm:3},mb:3,borderRadius:2},children:s.jsxs(h,{container:!0,spacing:2,alignItems:"center",children:[s.jsx(h,{item:!0,xs:12,md:4,children:s.jsx(x,{fullWidth:!0,placeholder:"Tìm kiếm theo tên khách hàng, số điện thoại...",value:le,onChange:e=>{ce(e.target.value),se(0)},InputProps:{startAdornment:s.jsx(A,{sx:{mr:1,color:"text.secondary"}})}})}),s.jsx(h,{item:!0,xs:12,sm:6,md:2,children:s.jsxs(j,{fullWidth:!0,children:[s.jsx(m,{children:"Trạng thái"}),s.jsxs(u,{value:he,label:"Trạng thái",onChange:e=>de(e.target.value),children:[s.jsx(g,{value:"",children:"Tất cả"}),s.jsx(g,{value:"paid",children:"Đã thanh toán"}),s.jsx(g,{value:"pending",children:"Chờ thanh toán"}),s.jsx(g,{value:"cancelled",children:"Đã hủy"})]})]})}),s.jsx(h,{item:!0,xs:12,sm:6,md:2,children:s.jsxs(j,{fullWidth:!0,children:[s.jsx(m,{children:"Phương thức TT"}),s.jsxs(u,{value:oe,label:"Phương thức TT",onChange:e=>xe(e.target.value),children:[s.jsx(g,{value:"",children:"Tất cả"}),s.jsx(g,{value:"cash",children:"Tiền mặt"}),s.jsx(g,{value:"card",children:"Thẻ"}),s.jsx(g,{value:"bank_transfer",children:"Chuyển khoản"})]})]})}),s.jsx(h,{item:!0,xs:12,md:4,children:s.jsx(i,{direction:"row",spacing:1,children:s.jsx(c,{variant:"outlined",startIcon:s.jsx(E,{}),onClick:()=>{ce(""),de(""),xe(""),se(0)},children:"Xóa bộ lọc"})})})]})}),s.jsxs(r,{elevation:1,sx:{borderRadius:2,overflow:"hidden"},children:[s.jsx(p,{children:s.jsxs(y,{children:[s.jsx(v,{children:s.jsxs(f,{sx:{bgcolor:"grey.50"},children:[s.jsx(b,{sx:{fontWeight:600},children:"ID"}),s.jsx(b,{sx:{fontWeight:600},children:"Khách hàng"}),s.jsx(b,{sx:{fontWeight:600},children:"Số điện thoại"}),s.jsx(b,{sx:{fontWeight:600},children:"Tổng tiền"}),s.jsx(b,{sx:{fontWeight:600},children:"Phương thức TT"}),s.jsx(b,{sx:{fontWeight:600},children:"Trạng thái"}),s.jsx(b,{sx:{fontWeight:600},children:"Ngày tạo"}),s.jsx(b,{sx:{fontWeight:600},children:"Thao tác"})]})}),s.jsx(S,{children:M?s.jsx(f,{children:s.jsx(b,{colSpan:8,sx:{textAlign:"center",py:4},children:s.jsx(C,{})})}):0===J.length?s.jsx(f,{children:s.jsx(b,{colSpan:8,sx:{textAlign:"center",py:4},children:s.jsx(l,{color:"text.secondary",children:"Không tìm thấy đơn hàng nào"})})}):J.map(e=>s.jsxs(f,{hover:!0,children:[s.jsxs(b,{children:["#",e.id]}),s.jsx(b,{children:s.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(H,{sx:{fontSize:16,color:"text.secondary"}}),e.customer_name||"Khách vãng lai"]})}),s.jsx(b,{children:s.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(X,{sx:{fontSize:16,color:"text.secondary"}}),e.customer_phone||"-"]})}),s.jsxs(b,{children:[s.jsx(l,{variant:"body2",sx:{fontWeight:600},children:$(e.total_amount)}),e.discount_amount>0&&s.jsxs(l,{variant:"caption",color:"text.secondary",children:["(Giảm: ",$(e.discount_amount),")"]})]}),s.jsx(b,{children:s.jsx(_,{label:ze(e.payment_method),size:"small",variant:"outlined"})}),s.jsx(b,{children:s.jsx(_,{label:Ie(e.payment_status),size:"small",color:We(e.payment_status)})}),s.jsx(b,{children:s.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(q,{sx:{fontSize:16,color:"text.secondary"}}),new Date(e.created_at).toLocaleDateString("vi-VN")]})}),s.jsx(b,{children:s.jsxs(i,{direction:"row",spacing:1,children:[s.jsx(w,{title:"Xem chi tiết",children:s.jsx(T,{size:"small",onClick:()=>(async e=>{try{const n=await L.get(`/sales/${e}`);n.success&&(me(n.data),ge(!0))}catch(n){Z("Lỗi khi tải chi tiết đơn hàng",{variant:"error"})}})(e.id),children:s.jsx(V,{})})}),s.jsx(w,{title:"Cập nhật trạng thái",children:s.jsx(T,{size:"small",onClick:()=>{me({order:e,items:[]}),fe(e.payment_status),ye(!0)},children:s.jsx(F,{})})}),s.jsx(w,{title:"Hủy đơn hàng",children:s.jsx(T,{size:"small",onClick:()=>(async e=>{if(window.confirm("Bạn có chắc chắn muốn hủy đơn hàng này?"))try{(await L.delete(`/sales/${e}`)).success&&(Z("Hủy đơn hàng thành công",{variant:"success"}),ke())}catch(n){Z("Lỗi khi hủy đơn hàng",{variant:"error"})}})(e.id),color:"error",children:s.jsx(U,{})})})]})})]},e.id))})]})}),s.jsx(k,{component:"div",count:ie,page:ne,onPageChange:(e,n)=>{se(n)},rowsPerPage:te,onRowsPerPageChange:e=>{re(parseInt(e.target.value,10)),se(0)},labelRowsPerPage:"Số hàng mỗi trang:",labelDisplayedRows:({from:e,to:n,count:s})=>`${e}-${n} của ${-1!==s?s:`hơn ${n}`}`})]}),s.jsxs(W,{open:ue,onClose:()=>ge(!1),maxWidth:"md",fullWidth:!0,children:[s.jsx(I,{children:s.jsxs(l,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(V,{}),"Chi tiết đơn hàng #",je?.order.id]})}),s.jsx(z,{children:je&&s.jsxs(a,{children:[s.jsxs(h,{container:!0,spacing:2,sx:{mb:3},children:[s.jsxs(h,{item:!0,xs:12,md:6,children:[s.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Thông tin khách hàng"}),s.jsxs(a,{sx:{pl:2},children:[s.jsxs(l,{variant:"body2",children:[s.jsx("strong",{children:"Tên:"})," ",je.order.customer_name||"Khách vãng lai"]}),s.jsxs(l,{variant:"body2",children:[s.jsx("strong",{children:"Số điện thoại:"})," ",je.order.customer_phone||"-"]}),s.jsxs(l,{variant:"body2",children:[s.jsx("strong",{children:"Email:"})," ",je.order.customer_email||"-"]})]})]}),s.jsxs(h,{item:!0,xs:12,md:6,children:[s.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Thông tin thanh toán"}),s.jsxs(a,{sx:{pl:2},children:[s.jsxs(l,{variant:"body2",children:[s.jsx("strong",{children:"Phương thức:"})," ",ze(je.order.payment_method)]}),s.jsxs(l,{variant:"body2",children:[s.jsx("strong",{children:"Trạng thái:"}),s.jsx(_,{label:Ie(je.order.payment_status),size:"small",color:We(je.order.payment_status),sx:{ml:1}})]}),s.jsxs(l,{variant:"body2",children:[s.jsx("strong",{children:"Ngày tạo:"})," ",new Date(je.order.created_at).toLocaleString("vi-VN")]})]})]})]}),s.jsx(P,{sx:{my:2}}),s.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Sản phẩm trong đơn hàng"}),s.jsx(p,{component:r,variant:"outlined",children:s.jsxs(y,{size:"small",children:[s.jsx(v,{children:s.jsxs(f,{children:[s.jsx(b,{children:"Sản phẩm"}),s.jsx(b,{children:"SKU"}),s.jsx(b,{align:"right",children:"Số lượng"}),s.jsx(b,{align:"right",children:"Đơn giá"}),s.jsx(b,{align:"right",children:"Thành tiền"})]})}),s.jsx(S,{children:je.items.map(e=>s.jsxs(f,{children:[s.jsxs(b,{children:[s.jsx(l,{variant:"body2",sx:{fontWeight:500},children:e.product_name}),s.jsx(l,{variant:"caption",color:"text.secondary",children:e.category_name})]}),s.jsx(b,{children:e.product_sku}),s.jsx(b,{align:"right",children:e.quantity}),s.jsx(b,{align:"right",children:$(e.unit_price)}),s.jsx(b,{align:"right",children:$(e.total_price)})]},e.id))})]})}),s.jsx(P,{sx:{my:2}}),s.jsx(a,{sx:{display:"flex",justifyContent:"flex-end"},children:s.jsxs(a,{sx:{minWidth:200},children:[s.jsxs(l,{variant:"body2",sx:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{children:"Tạm tính:"}),s.jsx("span",{children:$(je.order.total_amount-je.order.tax_amount+je.order.discount_amount)})]}),je.order.discount_amount>0&&s.jsxs(l,{variant:"body2",sx:{display:"flex",justifyContent:"space-between",color:"error.main"},children:[s.jsx("span",{children:"Giảm giá:"}),s.jsxs("span",{children:["-",$(je.order.discount_amount)]})]}),s.jsxs(l,{variant:"body2",sx:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{children:"Thuế VAT:"}),s.jsx("span",{children:$(je.order.tax_amount)})]}),s.jsx(P,{sx:{my:1}}),s.jsxs(l,{variant:"h6",sx:{display:"flex",justifyContent:"space-between",fontWeight:600},children:[s.jsx("span",{children:"Tổng cộng:"}),s.jsx("span",{children:$(je.order.total_amount)})]})]})}),je.order.notes&&s.jsxs(s.Fragment,{children:[s.jsx(P,{sx:{my:2}}),s.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Ghi chú"}),s.jsx(l,{variant:"body2",sx:{pl:2},children:je.order.notes})]})]})}),s.jsx(B,{children:s.jsx(c,{onClick:()=>ge(!1),children:"Đóng"})})]}),s.jsxs(W,{open:pe,onClose:()=>ye(!1),maxWidth:"sm",fullWidth:!0,children:[s.jsx(I,{children:s.jsxs(l,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(F,{}),"Cập nhật trạng thái đơn hàng #",je?.order.id]})}),s.jsx(z,{children:s.jsxs(a,{sx:{pt:2},children:[s.jsxs(j,{fullWidth:!0,sx:{mb:2},children:[s.jsx(m,{children:"Trạng thái thanh toán"}),s.jsxs(u,{value:ve,label:"Trạng thái thanh toán",onChange:e=>fe(e.target.value),children:[s.jsx(g,{value:"paid",children:"Đã thanh toán"}),s.jsx(g,{value:"pending",children:"Chờ thanh toán"}),s.jsx(g,{value:"cancelled",children:"Đã hủy"})]})]}),s.jsx(x,{fullWidth:!0,label:"Ghi chú (tùy chọn)",multiline:!0,rows:3,value:be,onChange:e=>Se(e.target.value),placeholder:"Nhập ghi chú về việc cập nhật trạng thái..."})]})}),s.jsxs(B,{children:[s.jsx(c,{onClick:()=>ye(!1),children:"Hủy"}),s.jsx(c,{onClick:async()=>{if(je)try{_e(!0);(await L.put(`/sales/${je.order.id}/status`,{payment_status:ve,notes:be})).success&&(Z("Cập nhật trạng thái đơn hàng thành công",{variant:"success"}),ye(!1),fe(""),Se(""),ke())}catch(e){Z("Lỗi khi cập nhật trạng thái đơn hàng",{variant:"error"})}finally{_e(!1)}},variant:"contained",disabled:Ce||!ve,startIcon:Ce?s.jsx(C,{size:16}):null,children:"Cập nhật"})]})]})]})};export{Y as default};
