import{j as e,B as s,C as t,H as n,h as a,i,l as r,G as l,K as c,N as o,o as d,y as h,W as x,X as m,Y as u,n as j,O as g,a5 as p,a6 as y,a7 as v,a9 as b}from"../chunks/mui-core-c8a509c2.js";import{j as k,u as f,r as C}from"../chunks/react-vendor-546521e5.js";import{a as I}from"../assets/index-e3f8a988.js";import{J as A,E as w,G as T,K as S,z as W,r as K,I as P}from"../chunks/mui-icons-38bddb39.js";import"../chunks/query-vendor-a9f5ea8b.js";import"../chunks/ui-vendor-6aa703b7.js";import"../chunks/utils-vendor-11713830.js";const _=()=>{const{id:_}=k(),H=f(),[Q,D]=C.useState(null),[F,$]=C.useState([]),[B,G]=C.useState(!0),[R,U]=C.useState(null),[z,N]=C.useState(!1),[X,q]=C.useState(!1),[M,V]=C.useState({}),E="new"===_;C.useEffect(()=>{E?(N(!0),G(!1),V({name:"",description:"",sku:"",barcode:"",categoryId:void 0,price:0,costPrice:0,taxRate:0,stockQuantity:0,stockAlertThreshold:10,isActive:!0,imageUrl:""})):L(),J()},[_,E]);const L=async()=>{try{G(!0);const e=await I.get(`/products/${_}`);D(e),V(e)}catch(e){U("Không thể tải thông tin sản phẩm")}finally{G(!1)}},J=async()=>{try{const e=(await I.get("/categories?limit=100")).data||[];Array.isArray(e)?($(e),E&&e.length>0&&V(s=>({...s,categoryId:e[0].id}))):$([])}catch(e){$([])}},O=(e,s)=>{R&&U(null),V(t=>({...t,[e]:s}))},Y=e=>new Date(e).toLocaleDateString("vi-VN");return B?e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(t,{})}):Q||E?e.jsxs(s,{p:3,children:[e.jsxs(s,{display:"flex",alignItems:"center",mb:3,children:[e.jsx(a,{onClick:()=>H("/products"),sx:{mr:2},children:e.jsx(A,{})}),e.jsx(i,{variant:"h4",component:"h1",children:E?"Thêm sản phẩm mới":"Chi tiết sản phẩm"}),e.jsx(s,{ml:"auto",children:z||E?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"contained",startIcon:e.jsx(S,{}),onClick:async()=>{try{if(!M.name||!M.sku)return void U("Vui lòng điền đầy đủ tên sản phẩm và mã SKU");if(!M.categoryId||M.categoryId<=0)return void U("Vui lòng chọn danh mục sản phẩm");const e={name:M.name,description:M.description,sku:M.sku,barcode:M.barcode,category_id:M.categoryId,price:M.price,cost_price:M.costPrice,tax_rate:M.taxRate,stock_quantity:M.stockQuantity,stock_alert_threshold:M.stockAlertThreshold,is_active:M.isActive,image_url:M.imageUrl};if(E){const s=await I.post("/products",e);D(s),V(s),H(`/products/${s.id}`)}else{const s=await I.put(`/products/${_}`,e);D(s),N(!1)}}catch(e){e.response?.data?.message?U(e.response.data.message):U(E?"Không thể tạo sản phẩm mới":"Không thể cập nhật sản phẩm")}},sx:{mr:1},children:"Lưu"}),e.jsx(r,{variant:"outlined",startIcon:e.jsx(W,{}),onClick:()=>{N(!1),V(Q||{})},children:"Hủy"})]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"outlined",startIcon:e.jsx(w,{}),onClick:()=>{N(!0)},sx:{mr:1},children:"Chỉnh sửa"}),e.jsx(r,{variant:"outlined",color:"error",startIcon:e.jsx(T,{}),onClick:()=>q(!0),children:"Xóa"})]})})]}),R&&e.jsx(n,{severity:"error",sx:{mb:3},children:R}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(c,{children:e.jsxs(o,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Thông tin cơ bản"}),e.jsx(d,{sx:{mb:2}}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Tên sản phẩm",value:z?M.name||"":Q?.name||"",onChange:e=>O("name",e.target.value),disabled:!z,margin:"normal"})}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(s,{display:"flex",gap:1,alignItems:"end",children:[e.jsx(h,{fullWidth:!0,label:"Mã SKU",value:z?M.sku||"":Q?.sku||"",onChange:e=>O("sku",e.target.value),disabled:!z,margin:"normal"}),z&&E&&e.jsx(r,{variant:"outlined",size:"small",onClick:()=>{const e=(s=M.name||"")?`${s.toUpperCase().replace(/[^A-Z0-9\s]/g,"").split(" ").slice(0,3).join("-")}-${Date.now().toString().slice(-4)}`:"";var s;O("sku",e)},disabled:!M.name,sx:{mb:1,minWidth:"auto",px:2},children:"Tự động"})]})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Mô tả",value:z?M.description||"":Q?.description||"",onChange:e=>O("description",e.target.value),disabled:!z,multiline:!0,rows:3,margin:"normal"})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Mã vạch",value:z?M.barcode||"":Q?.barcode||"",onChange:e=>O("barcode",e.target.value),disabled:!z,margin:"normal"})}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(x,{fullWidth:!0,margin:"normal",disabled:!z,required:!0,children:[e.jsx(m,{children:"Danh mục *"}),e.jsx(u,{value:z?M.categoryId||"":Q?.categoryId||"",onChange:e=>O("categoryId",e.target.value),label:"Danh mục *",children:Array.isArray(F)&&F.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))})]})})]})]})})}),e.jsxs(l,{item:!0,xs:12,md:6,children:[e.jsx(c,{sx:{mb:3},children:e.jsxs(o,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Giá cả & Tồn kho"}),e.jsx(d,{sx:{mb:2}}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Giá bán",type:"number",value:z?M.price||"":Q?.price||"",onChange:e=>O("price",parseFloat(e.target.value)),disabled:!z,margin:"normal",InputProps:{startAdornment:e.jsx(K,{})}})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Giá nhập",type:"number",value:z?M.costPrice||"":Q?.costPrice||"",onChange:e=>O("costPrice",parseFloat(e.target.value)),disabled:!z,margin:"normal",InputProps:{startAdornment:e.jsx(K,{})}})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Thuế suất (%)",type:"number",value:z?100*(M.taxRate||0):100*(Q?.taxRate||0),onChange:e=>O("taxRate",parseFloat(e.target.value)/100),disabled:!z,margin:"normal"})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Số lượng tồn kho",type:"number",value:z?M.stockQuantity||"":Q?.stockQuantity||"",onChange:e=>O("stockQuantity",parseInt(e.target.value)),disabled:!z,margin:"normal",InputProps:{startAdornment:e.jsx(P,{})}})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Ngưỡng cảnh báo tồn kho",type:"number",value:z?M.stockAlertThreshold||"":Q?.stockAlertThreshold||"",onChange:e=>O("stockAlertThreshold",parseInt(e.target.value)),disabled:!z,margin:"normal"})})]})]})}),e.jsx(c,{children:e.jsxs(o,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Trạng thái"}),e.jsx(d,{sx:{mb:2}}),e.jsx(s,{display:"flex",flexDirection:"column",gap:2,children:!E&&e.jsxs(e.Fragment,{children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{children:"Trạng thái:"}),e.jsx(g,{label:Q?.isActive?"Hoạt động":"Không hoạt động",color:Q?.isActive?"success":"default",size:"small"})]}),e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{children:"Tồn kho:"}),e.jsx(g,{label:(Q?.stockQuantity||0)>0?"Còn hàng":"Hết hàng",color:(Q?.stockQuantity||0)>0?"success":"error",size:"small"})]}),e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{children:"Ngày tạo:"}),e.jsx(i,{variant:"body2",children:Q?.createdAt?Y(Q.createdAt):"-"})]}),e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{children:"Cập nhật lần cuối:"}),e.jsx(i,{variant:"body2",children:Q?.updatedAt?Y(Q.updatedAt):"-"})]})]})})]})})]})]}),e.jsxs(p,{open:X,onClose:()=>q(!1),children:[e.jsx(y,{children:"Xác nhận xóa"}),e.jsx(v,{children:e.jsxs(i,{children:['Bạn có chắc chắn muốn xóa sản phẩm "',Q?.name,'"? Hành động này không thể hoàn tác.']})}),e.jsxs(b,{children:[e.jsx(r,{onClick:()=>q(!1),children:"Hủy"}),e.jsx(r,{onClick:async()=>{try{await I.delete(`/products/${_}`),H("/products")}catch(e){U("Không thể xóa sản phẩm")}},color:"error",variant:"contained",children:"Xóa"})]})]})]}):e.jsx(s,{p:3,children:e.jsx(n,{severity:"warning",children:"Không tìm thấy sản phẩm"})})};export{_ as default};
