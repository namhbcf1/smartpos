import{j as e,E as s,i as n,B as a,l as r,K as t,N as i,G as o,y as c,z as l,W as h,X as d,Y as x,n as j,m as u,h as m,H as p,Z as g,x as y,_ as v,$ as f,a0 as _,a1 as k,a2 as b,a4 as C,O as S}from"../chunks/mui-core-c8a509c2.js";import{u as P,r as w,L as I}from"../chunks/react-vendor-546521e5.js";import{u as L}from"../chunks/useApiData-43bfc734.js";import{a as $}from"../chunks/ui-vendor-6aa703b7.js";import{f as W}from"../assets/index-e3f8a988.js";import{I as T,w as z,a7 as N,$ as q,S as D,p as K,F as R,q as X,T as A}from"../chunks/mui-icons-38bddb39.js";import"../chunks/query-vendor-a9f5ea8b.js";import"../chunks/utils-vendor-11713830.js";const B=()=>{P(),$();const[B,G]=w.useState(""),[H,O]=w.useState(""),[U,V]=w.useState(""),[E,F]=w.useState(""),M=w.useMemo(()=>{const e={};return B.trim()&&(e.search=B.trim()),H&&(e.transaction_type=H),U&&(e.date_from=U),E&&(e.date_to=E),e},[B,H,U,E]),{data:Y,pagination:Z,isLoading:J,error:Q,refetch:ee,handlePageChange:se,handleLimitChange:ne,page:ae,limit:re}=L("/inventory/transactions",M),te=(s,n)=>{switch(s){case"stock_in":return e.jsx(S,{icon:e.jsx(A,{}),label:`Nhập kho (+${n})`,color:"success",size:"small"});case"stock_out":return e.jsx(S,{icon:e.jsx(X,{}),label:`Xuất kho (-${n})`,color:"error",size:"small"});case"transfer_in":return e.jsx(S,{icon:e.jsx(N,{}),label:`Chuyển đến (+${n})`,color:"info",size:"small"});case"transfer_out":return e.jsx(S,{icon:e.jsx(N,{}),label:`Chuyển đi (-${n})`,color:"warning",size:"small"});case"adjustment":return e.jsx(S,{icon:e.jsx(q,{}),label:`Điều chỉnh (${n>0?"+":""}${n})`,color:"secondary",size:"small"});default:return e.jsx(S,{label:s,size:"small"})}};return e.jsxs(s,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(n,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(T,{}),"Lịch sử giao dịch kho"]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(n,{variant:"h6",color:"text.secondary",children:"Theo dõi mọi thay đổi tồn kho"}),e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(r,{variant:"outlined",startIcon:e.jsx(z,{}),component:I,to:"/inventory/stock-in",children:"Nhập kho"}),e.jsx(r,{variant:"outlined",startIcon:e.jsx(N,{}),component:I,to:"/inventory/transfer",children:"Chuyển kho"}),e.jsx(r,{variant:"outlined",startIcon:e.jsx(q,{}),component:I,to:"/inventory/check",children:"Kiểm kê"})]})]}),e.jsx(t,{sx:{mb:3},children:e.jsx(i,{children:e.jsxs(o,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(c,{fullWidth:!0,label:"Tìm kiếm",placeholder:"Tên sản phẩm, SKU, số tham chiếu...",value:B,onChange:e=>G(e.target.value),InputProps:{startAdornment:e.jsx(l,{position:"start",children:e.jsx(D,{})})}})}),e.jsx(o,{item:!0,xs:12,md:2,children:e.jsxs(h,{fullWidth:!0,children:[e.jsx(d,{children:"Loại giao dịch"}),e.jsxs(x,{value:H,label:"Loại giao dịch",onChange:e=>O(e.target.value),children:[e.jsx(j,{value:"",children:"Tất cả"}),e.jsx(j,{value:"stock_in",children:"Nhập kho"}),e.jsx(j,{value:"stock_out",children:"Xuất kho"}),e.jsx(j,{value:"transfer_in",children:"Chuyển đến"}),e.jsx(j,{value:"transfer_out",children:"Chuyển đi"}),e.jsx(j,{value:"adjustment",children:"Điều chỉnh"})]})]})}),e.jsx(o,{item:!0,xs:12,md:2,children:e.jsx(c,{fullWidth:!0,type:"date",label:"Từ ngày",value:U,onChange:e=>V(e.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(o,{item:!0,xs:12,md:2,children:e.jsx(c,{fullWidth:!0,type:"date",label:"Đến ngày",value:E,onChange:e=>F(e.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(u,{title:"Làm mới",children:e.jsx(m,{onClick:ee,children:e.jsx(K,{})})}),e.jsx(u,{title:"Xóa bộ lọc",children:e.jsx(m,{onClick:()=>{G(""),O(""),V(""),F("")},children:e.jsx(R,{})})})]})})]})})}),Q&&e.jsx(p,{severity:"error",sx:{mb:2},children:Q}),e.jsxs(g,{component:y,children:[e.jsxs(v,{children:[e.jsx(f,{children:e.jsxs(_,{children:[e.jsx(k,{children:"Sản phẩm"}),e.jsx(k,{children:"Loại giao dịch"}),e.jsx(k,{align:"right",children:"Số lượng"}),e.jsx(k,{align:"right",children:"Giá trị"}),e.jsx(k,{children:"Tham chiếu"}),e.jsx(k,{children:"Ngày"})]})}),e.jsx(b,{children:J?Array.from({length:re}).map((s,n)=>e.jsx(_,{children:e.jsx(k,{colSpan:6,children:e.jsx(a,{sx:{display:"flex",alignItems:"center",gap:2},children:e.jsx(a,{sx:{width:"100%",height:40,bgcolor:"grey.200",borderRadius:1}})})})},n)):Y.length>0?Y.map(s=>e.jsxs(_,{hover:!0,children:[e.jsx(k,{children:e.jsxs(a,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:s.product_name}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:["SKU: ",s.product_sku]}),s.category_name&&e.jsx(n,{variant:"caption",display:"block",color:"text.secondary",children:s.category_name})]})}),e.jsx(k,{children:te(s.transaction_type,s.quantity)}),e.jsx(k,{align:"right",children:e.jsxs(n,{variant:"body2",fontWeight:600,color:["stock_in","transfer_in"].includes(s.transaction_type)?"success.main":["stock_out","transfer_out"].includes(s.transaction_type)?"error.main":"text.primary",children:[["stock_in","transfer_in"].includes(s.transaction_type)?"+":["stock_out","transfer_out"].includes(s.transaction_type)?"-":"",s.quantity]})}),e.jsx(k,{align:"right",children:s.cost_price?e.jsx(n,{variant:"body2",color:"primary.main",children:W(s.cost_price*s.quantity)}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(k,{children:e.jsxs(a,{children:[s.reference_number&&e.jsx(n,{variant:"body2",fontWeight:500,children:s.reference_number}),s.supplier_name&&e.jsx(n,{variant:"caption",color:"text.secondary",children:s.supplier_name}),s.notes&&e.jsx(n,{variant:"caption",display:"block",color:"text.secondary",children:s.notes})]})}),e.jsxs(k,{children:[e.jsx(n,{variant:"body2",children:new Date(s.created_at).toLocaleDateString("vi-VN")}),e.jsx(n,{variant:"caption",color:"text.secondary",children:new Date(s.created_at).toLocaleTimeString("vi-VN")})]})]},s.id)):e.jsx(_,{children:e.jsx(k,{colSpan:6,align:"center",children:e.jsx(p,{severity:"info",sx:{border:"none"},children:e.jsx(n,{children:"Không tìm thấy giao dịch kho nào."})})})})})]}),Z&&e.jsx(C,{component:"div",count:Z.total,page:ae-1,onPageChange:(e,s)=>se(s+1),rowsPerPage:re,onRowsPerPageChange:e=>ne(parseInt(e.target.value)),rowsPerPageOptions:[10,25,50,100],labelRowsPerPage:"Số dòng mỗi trang:",labelDisplayedRows:({from:e,to:s,count:n})=>`${e}-${s} của ${-1!==n?n:`hơn ${s}`}`})]})]})};export{B as default};
