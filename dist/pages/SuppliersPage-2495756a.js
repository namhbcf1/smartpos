import{u as e,g as s,j as n,E as a,B as i,i as l,l as t,K as r,N as c,G as o,y as h,z as x,W as d,X as m,Y as u,n as j,H as p,Z as g,_ as v,$ as f,a0 as b,a1 as y,a2 as C,O as _,m as S,h as k,a4 as w,a5 as z,a6 as T,a7 as W,a9 as I}from"../chunks/mui-core-c8a509c2.js";import{u as P,r as $}from"../chunks/react-vendor-546521e5.js";import{a as N}from"../chunks/ui-vendor-6aa703b7.js";import{u as H}from"../chunks/useApiData-43bfc734.js";import{a as B}from"../assets/index-e3f8a988.js";import{B as D,p as q,w as E,S as G,Z as L,ag as R,ah as X,E as A,G as K}from"../chunks/mui-icons-38bddb39.js";import"../chunks/query-vendor-a9f5ea8b.js";import"../chunks/utils-vendor-11713830.js";const M=()=>{P();const{enqueueSnackbar:M}=N(),O=e(),Q=s(O.breakpoints.down("sm")),[Z,Y]=$.useState(""),[F,J]=$.useState("all"),[U,V]=$.useState(0),[ee,se]=$.useState(10),[ne,ae]=$.useState(!1),[ie,le]=$.useState(null),[te,re]=$.useState({name:"",contact_person:"",phone:"",email:"",address:"",tax_number:"",notes:"",is_active:!0}),ce={page:U+1,limit:ee,search:Z||void 0,is_active:"all"===F?void 0:"active"===F},{data:oe,loading:he,error:xe,refetch:de}=H("/suppliers",ce),me=oe?.data||[],ue=oe?.pagination,je=e=>{e?(le(e),re({name:e.name,contact_person:e.contact_person||"",phone:e.phone||"",email:e.email||"",address:e.address||"",tax_number:e.tax_number||"",notes:e.notes||"",is_active:e.is_active})):(le(null),re({name:"",contact_person:"",phone:"",email:"",address:"",tax_number:"",notes:"",is_active:!0})),ae(!0)},pe=()=>{ae(!1),le(null)},ge=(e,s)=>{re(n=>({...n,[e]:s}))};return n.jsxs(a,{maxWidth:"xl",sx:{mt:4,mb:4},children:[n.jsxs(i,{sx:{mb:4},children:[n.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[n.jsxs(i,{children:[n.jsxs(l,{variant:"h4",component:"h1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,fontSize:{xs:"1.5rem",sm:"2rem"}},children:[n.jsx(D,{sx:{fontSize:"inherit"}}),"Quản lý nhà cung cấp"]}),n.jsx(l,{variant:"body2",color:"text.secondary",children:"Quản lý thông tin nhà cung cấp và đối tác"})]}),n.jsxs(i,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[n.jsx(t,{variant:"outlined",startIcon:n.jsx(q,{}),onClick:de,size:Q?"small":"medium",children:"Làm mới"}),n.jsx(t,{variant:"contained",startIcon:n.jsx(E,{}),onClick:()=>je(),size:Q?"small":"medium",children:"Thêm nhà cung cấp"})]})]}),n.jsx(r,{sx:{mb:3},children:n.jsx(c,{children:n.jsxs(o,{container:!0,spacing:2,alignItems:"center",children:[n.jsx(o,{item:!0,xs:12,sm:6,md:4,children:n.jsx(h,{fullWidth:!0,placeholder:"Tìm kiếm nhà cung cấp...",value:Z,onChange:e=>{Y(e.target.value),V(0)},size:"small",InputProps:{startAdornment:n.jsx(x,{position:"start",children:n.jsx(G,{})})}})}),n.jsx(o,{item:!0,xs:12,sm:6,md:3,children:n.jsxs(d,{fullWidth:!0,size:"small",children:[n.jsx(m,{children:"Trạng thái"}),n.jsxs(u,{value:F,label:"Trạng thái",onChange:e=>{return s=e.target.value,J(s),void V(0);var s},children:[n.jsx(j,{value:"all",children:"Tất cả"}),n.jsx(j,{value:"active",children:"Đang hoạt động"}),n.jsx(j,{value:"inactive",children:"Ngừng hoạt động"})]})]})})]})})})]}),xe&&n.jsx(p,{severity:"error",sx:{mb:3},children:xe}),n.jsxs(r,{children:[n.jsx(g,{children:n.jsxs(v,{children:[n.jsx(f,{children:n.jsxs(b,{children:[n.jsx(y,{children:"Nhà cung cấp"}),n.jsx(y,{sx:{display:{xs:"none",sm:"table-cell"}},children:"Liên hệ"}),n.jsx(y,{sx:{display:{xs:"none",md:"table-cell"}},children:"Thông tin"}),n.jsx(y,{children:"Trạng thái"}),n.jsx(y,{align:"center",children:"Thao tác"})]})}),n.jsx(C,{children:he?n.jsx(b,{children:n.jsx(y,{colSpan:5,align:"center",children:"Đang tải..."})}):0===me.length?n.jsx(b,{children:n.jsx(y,{colSpan:5,align:"center",children:"Không có nhà cung cấp nào"})}):me.map(e=>n.jsxs(b,{hover:!0,children:[n.jsx(y,{children:n.jsxs(i,{children:[n.jsx(l,{variant:"subtitle2",fontWeight:600,children:e.name}),n.jsxs(l,{variant:"caption",color:"text.secondary",children:["ID: ",e.id,e.tax_number&&` | MST: ${e.tax_number}`]}),n.jsxs(i,{sx:{display:{xs:"block",sm:"none"},mt:.5},children:[e.contact_person&&n.jsxs(l,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:["Liên hệ: ",e.contact_person]}),e.phone&&n.jsxs(l,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:["SĐT: ",e.phone]})]})]})}),n.jsx(y,{sx:{display:{xs:"none",sm:"table-cell"}},children:n.jsxs(i,{children:[e.contact_person&&n.jsxs(l,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[n.jsx(D,{sx:{fontSize:16}}),e.contact_person]}),e.phone&&n.jsxs(l,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[n.jsx(L,{sx:{fontSize:16}}),e.phone]}),e.email&&n.jsxs(l,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(R,{sx:{fontSize:16}}),e.email]})]})}),n.jsx(y,{sx:{display:{xs:"none",md:"table-cell"}},children:e.address&&n.jsxs(l,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(X,{sx:{fontSize:16}}),e.address]})}),n.jsx(y,{children:n.jsx(_,{label:e.is_active?"Hoạt động":"Ngừng hoạt động",color:e.is_active?"success":"default",size:"small"})}),n.jsx(y,{align:"center",children:n.jsxs(i,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[n.jsx(S,{title:"Chỉnh sửa",children:n.jsx(k,{size:"small",onClick:()=>je(e),children:n.jsx(A,{fontSize:"small"})})}),n.jsx(S,{title:"Xóa",children:n.jsx(k,{size:"small",onClick:()=>(async e=>{if(window.confirm(`Bạn có chắc chắn muốn xóa nhà cung cấp "${e.name}"?`))try{const s=await B.delete(`/suppliers/${e.id}`);s.success?(M("Xóa nhà cung cấp thành công",{variant:"success"}),de()):M(s.message||"Có lỗi xảy ra",{variant:"error"})}catch(s){M("Có lỗi xảy ra khi xóa nhà cung cấp",{variant:"error"})}})(e),color:"error",children:n.jsx(K,{fontSize:"small"})})})]})})]},e.id))})]})}),ue&&n.jsx(w,{component:"div",count:ue.total,page:U,onPageChange:(e,s)=>{V(s)},rowsPerPage:ee,onRowsPerPageChange:e=>{se(parseInt(e.target.value,10)),V(0)},rowsPerPageOptions:[5,10,25,50],labelRowsPerPage:"Số dòng mỗi trang:",labelDisplayedRows:({from:e,to:s,count:n})=>`${e}-${s} của ${-1!==n?n:`hơn ${s}`}`})]}),n.jsxs(z,{open:ne,onClose:pe,maxWidth:"md",fullWidth:!0,fullScreen:Q,children:[n.jsx(T,{children:ie?"Chỉnh sửa nhà cung cấp":"Thêm nhà cung cấp mới"}),n.jsx(W,{children:n.jsxs(o,{container:!0,spacing:2,sx:{mt:1},children:[n.jsx(o,{item:!0,xs:12,sm:6,children:n.jsx(h,{fullWidth:!0,label:"Tên nhà cung cấp *",value:te.name,onChange:e=>ge("name",e.target.value),required:!0})}),n.jsx(o,{item:!0,xs:12,sm:6,children:n.jsx(h,{fullWidth:!0,label:"Người liên hệ",value:te.contact_person,onChange:e=>ge("contact_person",e.target.value)})}),n.jsx(o,{item:!0,xs:12,sm:6,children:n.jsx(h,{fullWidth:!0,label:"Số điện thoại",value:te.phone,onChange:e=>ge("phone",e.target.value)})}),n.jsx(o,{item:!0,xs:12,sm:6,children:n.jsx(h,{fullWidth:!0,label:"Email",type:"email",value:te.email,onChange:e=>ge("email",e.target.value)})}),n.jsx(o,{item:!0,xs:12,children:n.jsx(h,{fullWidth:!0,label:"Địa chỉ",value:te.address,onChange:e=>ge("address",e.target.value),multiline:!0,rows:2})}),n.jsx(o,{item:!0,xs:12,sm:6,children:n.jsx(h,{fullWidth:!0,label:"Mã số thuế",value:te.tax_number,onChange:e=>ge("tax_number",e.target.value)})}),n.jsx(o,{item:!0,xs:12,sm:6,children:n.jsxs(d,{fullWidth:!0,children:[n.jsx(m,{children:"Trạng thái"}),n.jsxs(u,{value:te.is_active,label:"Trạng thái",onChange:e=>ge("is_active",e.target.value),children:[n.jsx(j,{value:!0,children:"Hoạt động"}),n.jsx(j,{value:!1,children:"Ngừng hoạt động"})]})]})}),n.jsx(o,{item:!0,xs:12,children:n.jsx(h,{fullWidth:!0,label:"Ghi chú",value:te.notes,onChange:e=>ge("notes",e.target.value),multiline:!0,rows:3})})]})}),n.jsxs(I,{children:[n.jsx(t,{onClick:pe,children:"Hủy"}),n.jsx(t,{onClick:async()=>{try{const e=ie?`/suppliers/${ie.id}`:"/suppliers",s=ie?await B.put(e,te):await B.post(e,te);s.success?(M(ie?"Cập nhật nhà cung cấp thành công":"Tạo nhà cung cấp thành công",{variant:"success"}),pe(),de()):M(s.message||"Có lỗi xảy ra",{variant:"error"})}catch(e){M("Có lỗi xảy ra khi lưu nhà cung cấp",{variant:"error"})}},variant:"contained",disabled:!te.name.trim(),children:ie?"Cập nhật":"Tạo mới"})]})]})]})};export{M as default};
