import{u as e,g as t,j as s,E as n,x as i,J as a,B as r,i as o,l as c,G as l,K as d,N as x,y as h,W as m,X as u,Y as j,n as g,Z as p,_ as v,$ as _,a0 as y,a1 as f,a2 as b,C as S,O as w,m as k,h as T,a4 as C}from"../chunks/mui-core-c8a509c2.js";import{r as W}from"../chunks/react-vendor-546521e5.js";import{a as I}from"../chunks/ui-vendor-6aa703b7.js";import{f as P,a as D}from"../assets/index-e3f8a988.js";import{a3 as z,p as L,a0 as G,w as R,T as $,a4 as B,i as X,S as M,F as U,a1 as A,o as E,E as K,a5 as N,a6 as Y}from"../chunks/mui-icons-38bddb39.js";import"../chunks/query-vendor-a9f5ea8b.js";import"../chunks/utils-vendor-11713830.js";const q=()=>{const q=e();t(q.breakpoints.down("md"));const{enqueueSnackbar:V}=I(),[F,H]=W.useState([]),[J,O]=W.useState(!0),[Q,Z]=W.useState(0),[ee,te]=W.useState(10),[se,ne]=W.useState(0),[ie,ae]=W.useState(""),[re,oe]=W.useState(""),[ce,le]=W.useState(""),[de,xe]=W.useState(null),[he,me]=W.useState(!1),[ue,je]=W.useState(!1),[ge,pe]=W.useState(!1);W.useState(!1);const[ve,_e]=W.useState({name:"",description:"",promotion_type:"percentage",discount_value:0,minimum_amount:0,maximum_discount:0,start_date:"",end_date:"",usage_limit:0,is_active:!0,applies_to:"all"}),[ye,fe]=W.useState({totalPromotions:0,activePromotions:0,totalUsage:0,totalSavings:0}),be=async()=>{try{O(!0);const e=new URLSearchParams({page:(Q+1).toString(),limit:ee.toString()});ie&&e.append("search",ie),re&&e.append("status",re),ce&&e.append("type",ce);const t=await D.get(`/promotions?${e.toString()}`);if(t.success){H(t.data.data||[]),ne(t.data.pagination?.total||0);const e=t.data.data||[],s=new Date;fe({totalPromotions:e.length,activePromotions:e.filter(e=>e.is_active&&new Date(e.start_date)<=s&&new Date(e.end_date)>=s).length,totalUsage:e.reduce((e,t)=>e+t.usage_count,0),totalSavings:0})}}catch(e){V("Lỗi khi tải danh sách khuyến mãi",{variant:"error"})}finally{O(!1)}},Se=e=>{switch(e){case"percentage":return s.jsx(Y,{});case"fixed_amount":return s.jsx(X,{});case"buy_x_get_y":return s.jsx(B,{});case"free_shipping":return s.jsx(N,{});default:return s.jsx(z,{})}},we=e=>{switch(e){case"percentage":return"Giảm theo %";case"fixed_amount":return"Giảm cố định";case"buy_x_get_y":return"Mua X tặng Y";case"free_shipping":return"Miễn phí ship";default:return e}},ke=e=>{const t=new Date,s=new Date(e.start_date),n=new Date(e.end_date);return e.is_active?n<t?"error":s>t?"warning":"success":"default"},Te=e=>{const t=new Date,s=new Date(e.start_date),n=new Date(e.end_date);return e.is_active?n<t?"Đã hết hạn":s>t?"Sắp diễn ra":"Đang hoạt động":"Tạm dừng"};W.useEffect(()=>{be()},[Q,ee,ie,re,ce]);return s.jsxs(n,{maxWidth:"xl",sx:{py:{xs:1,sm:2},px:{xs:1,sm:2,md:3},minHeight:"100vh",bgcolor:"grey.50"},children:[s.jsx(i,{elevation:1,sx:{p:{xs:2,sm:3},mb:3,borderRadius:2,bgcolor:"white"},children:s.jsxs(a,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},spacing:2,children:[s.jsxs(r,{children:[s.jsxs(o,{variant:"h4",sx:{display:"flex",alignItems:"center",gap:1,fontSize:{xs:"1.5rem",sm:"2rem",md:"2.125rem"},fontWeight:600,color:"primary.main",mb:1},children:[s.jsx(z,{sx:{fontSize:"inherit"}}),"Khuyến mãi & Giảm giá"]}),s.jsx(o,{variant:"body1",color:"text.secondary",sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:"Quản lý các chương trình khuyến mãi và giảm giá"})]}),s.jsxs(a,{direction:"row",spacing:1,children:[s.jsx(c,{variant:"outlined",startIcon:s.jsx(L,{}),onClick:be,disabled:J,children:"Làm mới"}),s.jsx(c,{variant:"outlined",startIcon:s.jsx(G,{}),children:"Xuất dữ liệu"}),s.jsx(c,{variant:"contained",startIcon:s.jsx(R,{}),onClick:()=>{pe(!1),_e({name:"",description:"",promotion_type:"percentage",discount_value:0,minimum_amount:0,maximum_discount:0,start_date:"",end_date:"",usage_limit:0,is_active:!0,applies_to:"all"}),je(!0)},children:"Tạo khuyến mãi"})]})]})}),s.jsxs(l,{container:!0,spacing:3,sx:{mb:3},children:[s.jsx(l,{item:!0,xs:12,sm:6,md:3,children:s.jsx(d,{children:s.jsx(x,{children:s.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(r,{children:[s.jsx(o,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Tổng khuyến mãi"}),s.jsx(o,{variant:"h5",component:"div",children:ye.totalPromotions})]}),s.jsx(z,{color:"primary",sx:{fontSize:40}})]})})})}),s.jsx(l,{item:!0,xs:12,sm:6,md:3,children:s.jsx(d,{children:s.jsx(x,{children:s.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(r,{children:[s.jsx(o,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Đang hoạt động"}),s.jsx(o,{variant:"h5",component:"div",children:ye.activePromotions})]}),s.jsx($,{color:"success",sx:{fontSize:40}})]})})})}),s.jsx(l,{item:!0,xs:12,sm:6,md:3,children:s.jsx(d,{children:s.jsx(x,{children:s.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(r,{children:[s.jsx(o,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Lượt sử dụng"}),s.jsx(o,{variant:"h5",component:"div",children:ye.totalUsage})]}),s.jsx(B,{color:"warning",sx:{fontSize:40}})]})})})}),s.jsx(l,{item:!0,xs:12,sm:6,md:3,children:s.jsx(d,{children:s.jsx(x,{children:s.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(r,{children:[s.jsx(o,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Tiết kiệm"}),s.jsx(o,{variant:"h5",component:"div",children:P(ye.totalSavings)})]}),s.jsx(X,{color:"success",sx:{fontSize:40}})]})})})})]}),s.jsx(i,{elevation:1,sx:{p:{xs:2,sm:3},mb:3,borderRadius:2},children:s.jsxs(l,{container:!0,spacing:2,alignItems:"center",children:[s.jsx(l,{item:!0,xs:12,md:4,children:s.jsx(h,{fullWidth:!0,placeholder:"Tìm kiếm theo tên khuyến mãi...",value:ie,onChange:e=>{ae(e.target.value),Z(0)},InputProps:{startAdornment:s.jsx(M,{sx:{mr:1,color:"text.secondary"}})}})}),s.jsx(l,{item:!0,xs:12,sm:6,md:2,children:s.jsxs(m,{fullWidth:!0,children:[s.jsx(u,{children:"Trạng thái"}),s.jsxs(j,{value:re,label:"Trạng thái",onChange:e=>oe(e.target.value),children:[s.jsx(g,{value:"",children:"Tất cả"}),s.jsx(g,{value:"active",children:"Đang hoạt động"}),s.jsx(g,{value:"inactive",children:"Tạm dừng"}),s.jsx(g,{value:"expired",children:"Đã hết hạn"}),s.jsx(g,{value:"upcoming",children:"Sắp diễn ra"})]})]})}),s.jsx(l,{item:!0,xs:12,sm:6,md:2,children:s.jsxs(m,{fullWidth:!0,children:[s.jsx(u,{children:"Loại khuyến mãi"}),s.jsxs(j,{value:ce,label:"Loại khuyến mãi",onChange:e=>le(e.target.value),children:[s.jsx(g,{value:"",children:"Tất cả"}),s.jsx(g,{value:"percentage",children:"Giảm theo %"}),s.jsx(g,{value:"fixed_amount",children:"Giảm cố định"}),s.jsx(g,{value:"buy_x_get_y",children:"Mua X tặng Y"}),s.jsx(g,{value:"free_shipping",children:"Miễn phí ship"})]})]})}),s.jsx(l,{item:!0,xs:12,md:4,children:s.jsx(a,{direction:"row",spacing:1,children:s.jsx(c,{variant:"outlined",startIcon:s.jsx(U,{}),onClick:()=>{ae(""),oe(""),le(""),Z(0)},children:"Xóa bộ lọc"})})})]})}),s.jsxs(i,{elevation:1,sx:{borderRadius:2,overflow:"hidden"},children:[s.jsx(p,{children:s.jsxs(v,{children:[s.jsx(_,{children:s.jsxs(y,{sx:{bgcolor:"grey.50"},children:[s.jsx(f,{sx:{fontWeight:600},children:"Tên khuyến mãi"}),s.jsx(f,{sx:{fontWeight:600},children:"Loại"}),s.jsx(f,{sx:{fontWeight:600},children:"Giá trị"}),s.jsx(f,{sx:{fontWeight:600},children:"Điều kiện"}),s.jsx(f,{sx:{fontWeight:600},children:"Thời gian"}),s.jsx(f,{sx:{fontWeight:600},children:"Sử dụng"}),s.jsx(f,{sx:{fontWeight:600},children:"Trạng thái"}),s.jsx(f,{sx:{fontWeight:600},children:"Thao tác"})]})}),s.jsx(b,{children:J?s.jsx(y,{children:s.jsx(f,{colSpan:8,sx:{textAlign:"center",py:4},children:s.jsx(S,{})})}):0===F.length?s.jsx(y,{children:s.jsx(f,{colSpan:8,sx:{textAlign:"center",py:4},children:s.jsx(o,{color:"text.secondary",children:"Không tìm thấy khuyến mãi nào"})})}):F.map(e=>s.jsxs(y,{hover:!0,children:[s.jsx(f,{children:s.jsxs(r,{children:[s.jsx(o,{variant:"body2",sx:{fontWeight:600},children:e.name}),e.description&&s.jsx(o,{variant:"caption",color:"text.secondary",children:e.description})]})}),s.jsx(f,{children:s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[Se(e.promotion_type),s.jsx(o,{variant:"body2",children:we(e.promotion_type)})]})}),s.jsx(f,{children:"percentage"===e.promotion_type?s.jsxs(o,{variant:"body2",sx:{fontWeight:600},children:[e.discount_value,"%"]}):"fixed_amount"===e.promotion_type?s.jsx(o,{variant:"body2",sx:{fontWeight:600},children:P(e.discount_value)}):s.jsx(o,{variant:"body2",color:"text.secondary",children:"Theo điều kiện"})}),s.jsxs(f,{children:[s.jsxs(o,{variant:"body2",children:["Tối thiểu: ",P(e.minimum_amount)]}),e.maximum_discount>0&&s.jsxs(o,{variant:"caption",color:"text.secondary",children:["Tối đa: ",P(e.maximum_discount)]})]}),s.jsx(f,{children:s.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(A,{sx:{fontSize:16,color:"text.secondary"}}),s.jsxs(r,{children:[s.jsx(o,{variant:"body2",children:new Date(e.start_date).toLocaleDateString("vi-VN")}),s.jsxs(o,{variant:"caption",color:"text.secondary",children:["đến ",new Date(e.end_date).toLocaleDateString("vi-VN")]})]})]})}),s.jsx(f,{children:s.jsxs(o,{variant:"body2",children:[e.usage_count,e.usage_limit>0&&` / ${e.usage_limit}`]})}),s.jsx(f,{children:s.jsx(w,{label:Te(e),size:"small",color:ke(e)})}),s.jsx(f,{children:s.jsxs(a,{direction:"row",spacing:1,children:[s.jsx(k,{title:"Xem chi tiết",children:s.jsx(T,{size:"small",onClick:()=>{xe(e),me(!0)},children:s.jsx(E,{})})}),s.jsx(k,{title:"Chỉnh sửa",children:s.jsx(T,{size:"small",onClick:()=>{xe(e),pe(!0),_e({name:e.name,description:e.description||"",promotion_type:e.promotion_type,discount_value:e.discount_value,minimum_amount:e.minimum_amount,maximum_discount:e.maximum_discount,start_date:e.start_date.split("T")[0],end_date:e.end_date.split("T")[0],usage_limit:e.usage_limit,is_active:Boolean(e.is_active),applies_to:e.applies_to}),je(!0)},children:s.jsx(K,{})})})]})})]},e.id))})]})}),s.jsx(C,{component:"div",count:se,page:Q,onPageChange:(e,t)=>{Z(t)},rowsPerPage:ee,onRowsPerPageChange:e=>{te(parseInt(e.target.value,10)),Z(0)},labelRowsPerPage:"Số hàng mỗi trang:",labelDisplayedRows:({from:e,to:t,count:s})=>`${e}-${t} của ${-1!==s?s:`hơn ${t}`}`})]})]})};export{q as default};
