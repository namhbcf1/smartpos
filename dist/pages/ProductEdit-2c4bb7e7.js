import{j as e,B as t,C as s,E as a,H as i,aa as r,a3 as n,i as c,l,K as o,N as d,G as h,y as u,W as x,X as m,Y as j,n as p,ab as g,ac as v}from"../chunks/mui-core-c8a509c2.js";import{j as y,u as k,r as b}from"../chunks/react-vendor-546521e5.js";import{u as f,b as C}from"../chunks/useApiData-43bfc734.js";import{a as S}from"../assets/index-e3f8a988.js";import{J as I,z as A,K as W}from"../chunks/mui-icons-38bddb39.js";import"../chunks/query-vendor-a9f5ea8b.js";import"../chunks/ui-vendor-6aa703b7.js";import"../chunks/utils-vendor-11713830.js";const T=()=>{const{id:T}=y(),_=k(),[q,Q]=b.useState(!0),[P,R]=b.useState(null),[B,D]=b.useState(null),[K,w]=b.useState({name:"",description:"",sku:"",barcode:"",categoryId:"",price:"",costPrice:"",taxRate:"",stockQuantity:"",stockAlertThreshold:"",isActive:!0}),{data:G=[]}=f("/categories",{limit:100,is_active:!0}),{update:F,loading:H,error:E}=C();b.useEffect(()=>{(async()=>{if(T)try{Q(!0);const e=await S.get(`/products/${T}`),t=e.data||e;t?(D(t),w({name:t.name||"",description:t.description||"",sku:t.sku||"",barcode:t.barcode||"",categoryId:t.categoryId?.toString()||"",price:t.price?.toString()||"",costPrice:t.costPrice?.toString()||"",taxRate:t.taxRate?.toString()||"",stockQuantity:t.stockQuantity?.toString()||"",stockAlertThreshold:t.stockAlertThreshold?.toString()||"",isActive:t.isActive??!0})):R("Không thể tải thông tin sản phẩm")}catch(e){R("Lỗi khi tải dữ liệu")}finally{Q(!1)}})()},[T]);const L=(e,t)=>{w(s=>({...s,[e]:t}))},N=()=>{_("/products")};return q?e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(s,{})}):P?e.jsx(a,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsx(i,{severity:"error",children:P})}):e.jsxs(a,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(r,{sx:{mb:3},children:[e.jsx(n,{color:"inherit",href:"/products",onClick:e=>{e.preventDefault(),_("/products")},children:"Sản phẩm"}),e.jsx(c,{color:"text.primary",children:"Chỉnh sửa sản phẩm"})]}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(c,{variant:"h4",component:"h1",children:"Chỉnh sửa sản phẩm"}),e.jsx(l,{variant:"outlined",startIcon:e.jsx(I,{}),onClick:N,children:"Quay lại"})]}),e.jsx(o,{children:e.jsx(d,{children:e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),T)try{const e={name:K.name,description:K.description,sku:K.sku,barcode:K.barcode||null,category_id:parseInt(K.categoryId),price:parseFloat(K.price),cost_price:parseFloat(K.costPrice),tax_rate:parseFloat(K.taxRate),stock_quantity:parseInt(K.stockQuantity),stock_alert_threshold:parseInt(K.stockAlertThreshold),is_active:K.isActive};await F(`/products/${T}`,e)&&_("/products")}catch(t){}},children:e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Thông tin cơ bản"})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(u,{fullWidth:!0,label:"Tên sản phẩm",value:K.name,onChange:e=>L("name",e.target.value),required:!0})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(u,{fullWidth:!0,label:"SKU",value:K.sku,onChange:e=>L("sku",e.target.value),required:!0})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(u,{fullWidth:!0,label:"Mô tả",value:K.description,onChange:e=>L("description",e.target.value),multiline:!0,rows:3})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(u,{fullWidth:!0,label:"Barcode",value:K.barcode,onChange:e=>L("barcode",e.target.value)})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsxs(x,{fullWidth:!0,children:[e.jsx(m,{children:"Danh mục"}),e.jsx(j,{value:K.categoryId,onChange:e=>L("categoryId",e.target.value),label:"Danh mục",required:!0,children:G.map(t=>e.jsx(p,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(c,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Giá cả"})}),e.jsx(h,{item:!0,xs:12,md:4,children:e.jsx(u,{fullWidth:!0,label:"Giá bán",type:"number",value:K.price,onChange:e=>L("price",e.target.value),required:!0})}),e.jsx(h,{item:!0,xs:12,md:4,children:e.jsx(u,{fullWidth:!0,label:"Giá vốn",type:"number",value:K.costPrice,onChange:e=>L("costPrice",e.target.value),required:!0})}),e.jsx(h,{item:!0,xs:12,md:4,children:e.jsx(u,{fullWidth:!0,label:"Thuế (%)",type:"number",value:K.taxRate,onChange:e=>L("taxRate",e.target.value)})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(c,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Tồn kho"})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(u,{fullWidth:!0,label:"Số lượng tồn kho",type:"number",value:K.stockQuantity,onChange:e=>L("stockQuantity",e.target.value)})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(u,{fullWidth:!0,label:"Ngưỡng cảnh báo tồn kho",type:"number",value:K.stockAlertThreshold,onChange:e=>L("stockAlertThreshold",e.target.value)})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(g,{control:e.jsx(v,{checked:K.isActive,onChange:e=>L("isActive",e.target.checked)}),label:"Kích hoạt sản phẩm"})}),E&&e.jsx(h,{item:!0,xs:12,children:e.jsx(i,{severity:"error",children:E})}),e.jsx(h,{item:!0,xs:12,children:e.jsxs(t,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:3},children:[e.jsx(l,{variant:"outlined",onClick:N,startIcon:e.jsx(A,{}),children:"Hủy"}),e.jsx(l,{type:"submit",variant:"contained",startIcon:e.jsx(W,{}),disabled:H,children:H?"Đang lưu...":"Lưu thay đổi"})]})})]})})})})]})};export{T as default};
