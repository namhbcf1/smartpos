import{j as n,E as s,i as e,B as i,l as t,K as a,N as r,G as h,ad as l,y as c,z as d,H as o,W as x,X as u,Y as m,n as j}from"../chunks/mui-core-c8a509c2.js";import{u as p,r as y}from"../chunks/react-vendor-546521e5.js";import{f as g,a as v}from"../assets/index-e3f8a988.js";import{a as f}from"../chunks/ui-vendor-6aa703b7.js";import{u as k}from"../chunks/useApiData-43bfc734.js";import{a7 as b,J as C,S,l as T,K as I}from"../chunks/mui-icons-38bddb39.js";import"../chunks/query-vendor-a9f5ea8b.js";import"../chunks/utils-vendor-11713830.js";const W=()=>{const W=p(),{enqueueSnackbar:$}=f(),[Q,_]=y.useState(null),[w,H]=y.useState(1),[K,P]=y.useState(1),[z,B]=y.useState(2),[G,L]=y.useState(""),[N,O]=y.useState(!1),{data:q,isLoading:D}=k("/products",{limit:100,is_active:!0}),X=[{id:1,name:"Chi nhánh chính",address:"Hà Nội"},{id:2,name:"Chi nhánh 2",address:"TP.HCM"},{id:3,name:"Chi nhánh 3",address:"Đà Nẵng"}];return n.jsxs(s,{maxWidth:"md",sx:{py:3},children:[n.jsxs(e,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(b,{}),"Chuyển kho"]}),n.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[n.jsx(e,{variant:"h6",color:"text.secondary",children:"Chuyển sản phẩm giữa các chi nhánh"}),n.jsx(t,{variant:"outlined",startIcon:n.jsx(C,{}),onClick:()=>W("/inventory"),children:"Quay lại"})]}),n.jsx(a,{children:n.jsx(r,{children:n.jsxs(h,{container:!0,spacing:3,children:[n.jsxs(h,{item:!0,xs:12,children:[n.jsx(e,{variant:"h6",gutterBottom:!0,children:"Chọn sản phẩm"}),n.jsx(l,{options:q||[],getOptionLabel:n=>`${n.name} (${n.sku})`,value:Q,onChange:(n,s)=>_(s),renderInput:s=>n.jsx(c,{...s,label:"Chọn sản phẩm cần chuyển",placeholder:"Tìm kiếm sản phẩm...",InputProps:{...s.InputProps,startAdornment:n.jsx(d,{position:"start",children:n.jsx(S,{})})}}),renderOption:(s,t)=>n.jsx(i,{component:"li",...s,children:n.jsxs(i,{children:[n.jsx(e,{variant:"body2",fontWeight:500,children:t.name}),n.jsxs(e,{variant:"caption",color:"text.secondary",children:["SKU: ",t.sku," | Danh mục: ",t.categoryName]}),n.jsxs(e,{variant:"caption",display:"block",color:"text.secondary",children:["Tồn kho: ",t.stockQuantity," | Giá: ",g(t.price)]})]})}),loading:D,noOptionsText:"Không tìm thấy sản phẩm"})]}),Q&&n.jsxs(n.Fragment,{children:[n.jsx(h,{item:!0,xs:12,children:n.jsxs(o,{severity:"info",children:[n.jsxs(e,{variant:"body2",children:[n.jsx("strong",{children:"Sản phẩm:"})," ",Q.name," (",Q.sku,")"]}),n.jsxs(e,{variant:"body2",children:[n.jsx("strong",{children:"Tồn kho hiện tại:"})," ",Q.stockQuantity]}),n.jsxs(e,{variant:"body2",children:[n.jsx("strong",{children:"Giá:"})," ",g(Q.price)]})]})}),n.jsx(h,{item:!0,xs:12,sm:6,children:n.jsxs(x,{fullWidth:!0,children:[n.jsx(u,{children:"Từ chi nhánh"}),n.jsx(m,{value:K,label:"Từ chi nhánh",onChange:n=>P(n.target.value),children:X.map(s=>n.jsx(j,{value:s.id,children:n.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(T,{fontSize:"small"}),n.jsxs(i,{children:[n.jsx(e,{variant:"body2",children:s.name}),n.jsx(e,{variant:"caption",color:"text.secondary",children:s.address})]})]})},s.id))})]})}),n.jsx(h,{item:!0,xs:12,sm:6,children:n.jsxs(x,{fullWidth:!0,children:[n.jsx(u,{children:"Đến chi nhánh"}),n.jsx(m,{value:z,label:"Đến chi nhánh",onChange:n=>B(n.target.value),children:X.filter(n=>n.id!==K).map(s=>n.jsx(j,{value:s.id,children:n.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(T,{fontSize:"small"}),n.jsxs(i,{children:[n.jsx(e,{variant:"body2",children:s.name}),n.jsx(e,{variant:"caption",color:"text.secondary",children:s.address})]})]})},s.id))})]})}),n.jsx(h,{item:!0,xs:12,sm:6,children:n.jsx(c,{fullWidth:!0,type:"number",label:"Số lượng chuyển",value:w,onChange:n=>H(parseInt(n.target.value)||0),inputProps:{min:1,max:Q.stockQuantity},helperText:`Tối đa: ${Q.stockQuantity}`})}),n.jsx(h,{item:!0,xs:12,sm:6,children:n.jsx(c,{fullWidth:!0,label:"Tổng giá trị",value:g(w*Q.price),InputProps:{readOnly:!0},variant:"filled"})}),n.jsx(h,{item:!0,xs:12,children:n.jsx(c,{fullWidth:!0,label:"Ghi chú",value:G,onChange:n=>L(n.target.value),multiline:!0,rows:3,placeholder:"Lý do chuyển kho, ghi chú đặc biệt..."})}),n.jsx(h,{item:!0,xs:12,children:n.jsxs(o,{severity:"warning",children:[n.jsx(e,{variant:"body2",gutterBottom:!0,children:n.jsx("strong",{children:"Xác nhận chuyển kho:"})}),n.jsxs(e,{variant:"body2",children:["• Chuyển ",w," ",Q.name," từ ",X.find(n=>n.id===K)?.name,"đến ",X.find(n=>n.id===z)?.name]}),n.jsxs(e,{variant:"body2",children:["• Tổng giá trị: ",g(w*Q.price)]})]})}),n.jsx(h,{item:!0,xs:12,children:n.jsx(i,{sx:{display:"flex",justifyContent:"flex-end"},children:n.jsx(t,{variant:"contained",size:"large",startIcon:n.jsx(I,{}),onClick:async()=>{if(!Q||w<=0||K===z)$("Vui lòng kiểm tra lại thông tin chuyển kho",{variant:"warning"});else if(Q.stockQuantity<w)$(`Không đủ tồn kho. Còn lại: ${Q.stockQuantity}`,{variant:"error"});else{O(!0);try{await v.post("/inventory/stock-transfer",{product_id:Q.id,quantity:w,from_store_id:K,to_store_id:z,notes:G});$(`Chuyển kho thành công! ${w} ${Q.name} đã được chuyển từ ${X.find(n=>n.id===K)?.name} đến ${X.find(n=>n.id===z)?.name}`,{variant:"success",autoHideDuration:5e3}),_(null),H(1),L(""),setTimeout(()=>{W("/inventory")},2e3)}catch(n){$(n instanceof Error?n.message:"Lỗi khi chuyển kho",{variant:"error"})}finally{O(!1)}}},disabled:N||w<=0||K===z,sx:{minWidth:200},children:N?"Đang xử lý...":"Xác nhận chuyển kho"})})})]})]})})})]})};export{W as default};
