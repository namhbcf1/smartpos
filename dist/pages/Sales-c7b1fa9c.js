import{j as e,E as s,i as n,B as a,l as t,K as r,N as i,G as l,y as h,z as c,W as o,X as d,Y as x,n as j,m,h as u,H as g,Z as p,x as v,_ as y,$ as f,a0 as b,a1 as _,a2 as T,S as C,a4 as k,O as P}from"../chunks/mui-core-c8a509c2.js";import{u as S,r as w,L as I}from"../chunks/react-vendor-546521e5.js";import{u as W}from"../chunks/useApiData-43bfc734.js";import{a as L}from"../chunks/ui-vendor-6aa703b7.js";import{f as z}from"../assets/index-e3f8a988.js";import{O as D,w as $,S as R,p as q,F as K,o as N,r as Q,Q as A,j as H,U as O,z as X,W as B,y as G}from"../chunks/mui-icons-38bddb39.js";import"../chunks/query-vendor-a9f5ea8b.js";import"../chunks/utils-vendor-11713830.js";const V=()=>{const V=S();L();const[E,F]=w.useState(""),[M,U]=w.useState(""),[Y,Z]=w.useState(""),[J,ee]=w.useState(""),[se,ne]=w.useState(""),ae=w.useMemo(()=>{const e={};return E.trim()&&(e.search=E.trim()),M&&(e.payment_method=M),Y&&(e.payment_status=Y),J&&(e.date_from=J),se&&(e.date_to=se),e},[E,M,Y,J,se]),{data:te,pagination:re,isLoading:ie,error:le,refetch:he,handlePageChange:ce,handleLimitChange:oe,page:de,limit:xe}=W("/sales",ae),je=s=>{switch(s){case"cash":default:return e.jsx(Q,{});case"card":return e.jsx(O,{});case"transfer":return e.jsx(H,{});case"qr":return e.jsx(A,{})}},me=s=>{switch(s){case"paid":return e.jsx(P,{icon:e.jsx(G,{}),label:"Đã thanh toán",color:"success",size:"small"});case"pending":return e.jsx(P,{icon:e.jsx(B,{}),label:"Chờ thanh toán",color:"warning",size:"small"});case"cancelled":return e.jsx(P,{icon:e.jsx(X,{}),label:"Đã hủy",color:"error",size:"small"});default:return e.jsx(P,{label:s,size:"small"})}};return e.jsxs(s,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(n,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(D,{}),"Lịch sử bán hàng"]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(n,{variant:"h6",color:"text.secondary",children:"Quản lý lịch sử bán hàng"}),e.jsx(t,{variant:"contained",startIcon:e.jsx($,{}),component:I,to:"/pos",children:"Tạo đơn hàng mới"})]}),e.jsx(r,{sx:{mb:3},children:e.jsx(i,{children:e.jsxs(l,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,label:"Tìm kiếm",placeholder:"Tên khách hàng, SĐT, email...",value:E,onChange:e=>F(e.target.value),InputProps:{startAdornment:e.jsx(c,{position:"start",children:e.jsx(R,{})})}})}),e.jsx(l,{item:!0,xs:12,md:2,children:e.jsxs(o,{fullWidth:!0,children:[e.jsx(d,{children:"Phương thức thanh toán"}),e.jsxs(x,{value:M,label:"Phương thức thanh toán",onChange:e=>U(e.target.value),children:[e.jsx(j,{value:"",children:"Tất cả"}),e.jsx(j,{value:"cash",children:"Tiền mặt"}),e.jsx(j,{value:"card",children:"Thẻ"}),e.jsx(j,{value:"transfer",children:"Chuyển khoản"}),e.jsx(j,{value:"qr",children:"QR Code"})]})]})}),e.jsx(l,{item:!0,xs:12,md:2,children:e.jsxs(o,{fullWidth:!0,children:[e.jsx(d,{children:"Trạng thái thanh toán"}),e.jsxs(x,{value:Y,label:"Trạng thái thanh toán",onChange:e=>Z(e.target.value),children:[e.jsx(j,{value:"",children:"Tất cả"}),e.jsx(j,{value:"paid",children:"Đã thanh toán"}),e.jsx(j,{value:"pending",children:"Chờ thanh toán"}),e.jsx(j,{value:"cancelled",children:"Đã hủy"})]})]})}),e.jsx(l,{item:!0,xs:12,md:2,children:e.jsx(h,{fullWidth:!0,type:"date",label:"Từ ngày",value:J,onChange:e=>ee(e.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(l,{item:!0,xs:12,md:2,children:e.jsx(h,{fullWidth:!0,type:"date",label:"Đến ngày",value:se,onChange:e=>ne(e.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(l,{item:!0,xs:12,md:1,children:e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(m,{title:"Làm mới",children:e.jsx(u,{onClick:he,children:e.jsx(q,{})})}),e.jsx(m,{title:"Xóa bộ lọc",children:e.jsx(u,{onClick:()=>{F(""),U(""),Z(""),ee(""),ne("")},children:e.jsx(K,{})})})]})})]})})}),le&&e.jsx(g,{severity:"error",sx:{mb:2},children:le}),e.jsxs(p,{component:v,children:[e.jsxs(y,{children:[e.jsx(f,{children:e.jsxs(b,{children:[e.jsx(_,{children:"ID"}),e.jsx(_,{children:"Khách hàng"}),e.jsx(_,{children:"Số điện thoại"}),e.jsx(_,{align:"right",children:"Tổng tiền"}),e.jsx(_,{children:"Phương thức TT"}),e.jsx(_,{children:"Trạng thái"}),e.jsx(_,{children:"Ngày tạo"}),e.jsx(_,{align:"center",children:"Thao tác"})]})}),e.jsx(T,{children:ie?Array.from({length:xe}).map((s,n)=>e.jsxs(b,{children:[e.jsx(_,{children:e.jsx(C,{})}),e.jsx(_,{children:e.jsx(C,{})}),e.jsx(_,{children:e.jsx(C,{})}),e.jsx(_,{children:e.jsx(C,{})}),e.jsx(_,{children:e.jsx(C,{})}),e.jsx(_,{children:e.jsx(C,{})}),e.jsx(_,{children:e.jsx(C,{})}),e.jsx(_,{children:e.jsx(C,{})})]},n)):te.length>0?te.map(s=>e.jsxs(b,{hover:!0,children:[e.jsxs(_,{children:["#",s.id]}),e.jsx(_,{children:e.jsxs(a,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:s.customer_name||"Khách vãng lai"}),s.customer_email&&e.jsx(n,{variant:"caption",color:"text.secondary",children:s.customer_email})]})}),e.jsx(_,{children:s.customer_phone||"-"}),e.jsxs(_,{align:"right",children:[e.jsx(n,{variant:"body2",fontWeight:600,color:"primary.main",children:z(s.total_amount)}),s.discount_amount>0&&e.jsxs(n,{variant:"caption",color:"text.secondary",children:["Giảm: ",z(s.discount_amount)]})]}),e.jsx(_,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[je(s.payment_method),e.jsx(n,{variant:"body2",sx:{textTransform:"capitalize"},children:"cash"===s.payment_method?"Tiền mặt":"card"===s.payment_method?"Thẻ":"transfer"===s.payment_method?"Chuyển khoản":"qr"===s.payment_method?"QR Code":s.payment_method})]})}),e.jsx(_,{children:me(s.payment_status)}),e.jsxs(_,{children:[e.jsx(n,{variant:"body2",children:new Date(s.created_at).toLocaleDateString("vi-VN")}),e.jsx(n,{variant:"caption",color:"text.secondary",children:new Date(s.created_at).toLocaleTimeString("vi-VN")})]}),e.jsx(_,{align:"center",children:e.jsx(m,{title:"Xem chi tiết",children:e.jsx(u,{size:"small",onClick:()=>{return e=s.id,void V(`/sales/${e}`);var e},children:e.jsx(N,{})})})})]},s.id)):e.jsx(b,{children:e.jsx(_,{colSpan:8,align:"center",children:e.jsx(g,{severity:"info",sx:{border:"none"},children:e.jsx(n,{children:"Không tìm thấy đơn hàng nào. Hãy tạo đơn hàng đầu tiên!"})})})})})]}),re&&e.jsx(k,{component:"div",count:re.total,page:de-1,onPageChange:(e,s)=>ce(s+1),rowsPerPage:xe,onRowsPerPageChange:e=>oe(parseInt(e.target.value)),rowsPerPageOptions:[10,25,50,100],labelRowsPerPage:"Số dòng mỗi trang:",labelDisplayedRows:({from:e,to:s,count:n})=>`${e}-${s} của ${-1!==n?n:`hơn ${s}`}`})]})]})};export{V as default};
