import{j as s,E as e,B as n,G as i,i as a,l as t,x as r,y as l,z as c,W as h,X as o,Y as d,n as x,m as j,O as m,h as u,K as g,N as p,Z as v,_ as f,$ as y,a0 as b,a1 as k,a2 as S,S as w,a3 as C,a4 as z,a5 as T,a6 as P,a7 as I,a8 as D,a9 as H}from"../chunks/mui-core-c8a509c2.js";import{r as $,b as A,L as W}from"../chunks/react-vendor-546521e5.js";import{u as K,a as N}from"../chunks/useApiData-43bfc734.js";import{w as X,S as _,t as B,p as L,F as R,x as E,y as F,z as G,E as U,G as O}from"../chunks/mui-icons-38bddb39.js";import"../assets/index-e3f8a988.js";import"../chunks/query-vendor-a9f5ea8b.js";import"../chunks/ui-vendor-6aa703b7.js";import"../chunks/utils-vendor-11713830.js";const Q=()=>{const[Q,V]=$.useState(""),[q,M]=$.useState(""),[Y,Z]=$.useState(""),[J,ss]=$.useState(""),[es,ns]=$.useState(!1),[is,as]=$.useState(!1),[ts,rs]=$.useState(null);A.useEffect(()=>{const s=setTimeout(()=>{M(Q)},500);return()=>clearTimeout(s)},[Q]);const{data:ls=[]}=K("/categories",{limit:100,is_active:!0}),cs=$.useMemo(()=>({search:q,category_id:Y||void 0,is_active:""===J?void 0:J,low_stock:es||void 0,sortBy:"name",sortDirection:"asc"}),[q,Y,J,es]),{data:hs,pagination:os,isLoading:ds,refetch:xs,handlePageChange:js,handleLimitChange:ms,page:us,limit:gs}=K("/products",cs),{deleteItem:ps,loading:vs,error:fs}=N();return s.jsxs(e,{maxWidth:"lg",children:[s.jsxs(n,{sx:{py:3},children:[s.jsxs(i,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[s.jsx(i,{item:!0,children:s.jsx(a,{variant:"h4",gutterBottom:!0,children:"Danh sách sản phẩm"})}),s.jsx(i,{item:!0,children:s.jsx(t,{variant:"contained",color:"primary",startIcon:s.jsx(X,{}),component:W,to:"/products/new",children:"Thêm sản phẩm"})})]}),s.jsx(r,{sx:{p:2,mb:3},children:s.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[s.jsx(i,{item:!0,xs:12,sm:4,children:s.jsx(l,{fullWidth:!0,label:"Tìm kiếm",variant:"outlined",size:"small",value:Q,onChange:s=>V(s.target.value),InputProps:{startAdornment:s.jsx(c,{position:"start",children:s.jsx(_,{fontSize:"small"})})}})}),s.jsx(i,{item:!0,xs:12,sm:3,children:s.jsxs(h,{fullWidth:!0,size:"small",variant:"outlined",children:[s.jsx(o,{id:"category-filter-label",children:"Danh mục"}),s.jsxs(d,{labelId:"category-filter-label",value:Y,onChange:s=>Z(s.target.value),label:"Danh mục",children:[s.jsx(x,{value:"",children:"Tất cả"}),ls.map(e=>s.jsx(x,{value:e.id,children:e.name},e.id))]})]})}),s.jsx(i,{item:!0,xs:12,sm:2,children:s.jsxs(h,{fullWidth:!0,size:"small",variant:"outlined",children:[s.jsx(o,{id:"status-filter-label",children:"Trạng thái"}),s.jsxs(d,{labelId:"status-filter-label",value:J,onChange:s=>ss(s.target.value),label:"Trạng thái",children:[s.jsx(x,{value:"",children:"Tất cả"}),s.jsx(x,{value:!0,children:"Hoạt động"}),s.jsx(x,{value:!1,children:"Không hoạt động"})]})]})}),s.jsx(i,{item:!0,xs:12,sm:1,children:s.jsx(h,{fullWidth:!0,children:s.jsx(j,{title:"Chỉ hiển thị hàng tồn kho thấp",children:s.jsx(m,{icon:s.jsx(B,{}),label:"Tồn thấp",clickable:!0,color:es?"warning":"default",onClick:()=>ns(!es)})})})}),s.jsx(i,{item:!0,xs:12,sm:2,children:s.jsxs(i,{container:!0,spacing:1,children:[s.jsx(i,{item:!0,children:s.jsx(j,{title:"Làm mới",children:s.jsx(u,{onClick:()=>xs(),children:s.jsx(L,{})})})}),s.jsx(i,{item:!0,children:s.jsx(j,{title:"Xóa bộ lọc",children:s.jsx(u,{onClick:()=>{V(""),M(""),Z(""),ss(""),ns(!1)},children:s.jsx(R,{})})})})]})})]})}),s.jsx(g,{children:s.jsxs(p,{sx:{p:0},children:[s.jsx(v,{children:s.jsxs(f,{children:[s.jsx(y,{children:s.jsxs(b,{children:[s.jsx(k,{children:"Hình ảnh"}),s.jsx(k,{children:"Tên sản phẩm"}),s.jsx(k,{children:"SKU"}),s.jsx(k,{children:"Danh mục"}),s.jsx(k,{children:"Giá bán"}),s.jsx(k,{children:"Tồn kho"}),s.jsx(k,{children:"Trạng thái"}),s.jsx(k,{align:"center",children:"Thao tác"})]})}),s.jsx(S,{children:ds?Array.from(Array(gs)).map((e,n)=>s.jsxs(b,{children:[s.jsx(k,{children:s.jsx(w,{variant:"rectangular",width:40,height:40})}),s.jsx(k,{children:s.jsx(w,{variant:"text"})}),s.jsx(k,{children:s.jsx(w,{variant:"text"})}),s.jsx(k,{children:s.jsx(w,{variant:"text"})}),s.jsx(k,{children:s.jsx(w,{variant:"text"})}),s.jsx(k,{children:s.jsx(w,{variant:"text"})}),s.jsx(k,{children:s.jsx(w,{variant:"circular",width:80,height:24})}),s.jsx(k,{children:s.jsx(w,{variant:"rectangular",width:80,height:32})})]},n)):0===hs.length?s.jsx(b,{children:s.jsx(k,{colSpan:8,align:"center",children:s.jsx(a,{variant:"body2",sx:{py:2},children:"Không tìm thấy sản phẩm nào"})})}):hs.map(e=>{return s.jsxs(b,{hover:!0,children:[s.jsx(k,{children:e.imageUrl?s.jsx(n,{component:"img",src:e.imageUrl,alt:e.name,sx:{width:40,height:40,objectFit:"cover",borderRadius:1}}):s.jsx(E,{color:"disabled"})}),s.jsx(k,{children:s.jsx(C,{component:W,to:`/products/${e.id}`,underline:"hover",children:e.name})}),s.jsx(k,{children:e.sku}),s.jsx(k,{children:e.categoryName}),s.jsx(k,{children:(i=e.price,new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(i))}),s.jsx(k,{children:s.jsxs(n,{display:"flex",alignItems:"center",children:[s.jsx(a,{variant:"body2",children:e.stockQuantity}),e.stockQuantity<=e.stockAlertThreshold&&s.jsx(j,{title:"Tồn kho thấp",children:s.jsx(B,{fontSize:"small",color:"warning",sx:{ml:1}})})]})}),s.jsx(k,{children:e.isActive?s.jsx(m,{size:"small",icon:s.jsx(F,{fontSize:"small"}),label:"Hoạt động",color:"success"}):s.jsx(m,{size:"small",icon:s.jsx(G,{fontSize:"small"}),label:"Không hoạt động",color:"default"})}),s.jsxs(k,{align:"center",children:[s.jsx(j,{title:"Sửa",children:s.jsx(u,{component:W,to:`/products/${e.id}/edit`,size:"small",color:"primary",children:s.jsx(U,{fontSize:"small"})})}),s.jsx(j,{title:"Xóa",children:s.jsx(u,{size:"small",color:"error",onClick:()=>{return s=e.id,rs(s),void as(!0);var s},children:s.jsx(O,{fontSize:"small"})})})]})]},e.id);var i})})]})}),os&&s.jsx(z,{component:"div",count:os.total,page:us-1,rowsPerPage:gs,onPageChange:(s,e)=>js(e+1),onRowsPerPageChange:s=>ms(parseInt(s.target.value,10)),labelRowsPerPage:"Hiển thị:",labelDisplayedRows:({from:s,to:e,count:n})=>`${s}-${e} của ${n}`,rowsPerPageOptions:[10,25,50,100]})]})})]}),s.jsxs(T,{open:is,onClose:()=>as(!1),children:[s.jsx(P,{children:"Xác nhận xóa"}),s.jsx(I,{children:s.jsx(D,{children:"Bạn có chắc chắn muốn xóa sản phẩm này không? Hành động này không thể hoàn tác."})}),s.jsxs(H,{children:[s.jsx(t,{onClick:()=>as(!1),children:"Hủy"}),s.jsx(t,{onClick:async()=>{if(ts){await ps(`/products/${ts}`)&&(xs(),as(!1))}},color:"error",variant:"contained",disabled:ps.isPending,children:ps.isPending?"Đang xử lý...":"Xóa"})]})]})]})};export{Q as default};
