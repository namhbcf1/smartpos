# üìä DANH S√ÅCH ƒê·∫¶Y ƒê·ª¶ C√ÅC B·∫¢NG DATABASE SMARTPOS - CHI TI·∫æT

## üîê **1. USERS & AUTHENTICATION**

### üë§ **users** - T√†i kho·∫£n ng∆∞·ªùi d√πng
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| username | TEXT UNIQUE NOT NULL | T√™n ƒëƒÉng nh·∫≠p |
| email | TEXT UNIQUE NOT NULL | Email ƒëƒÉng nh·∫≠p |
| password_hash | TEXT NOT NULL | M·∫≠t kh·∫©u ƒë√£ hash |
| full_name | TEXT NOT NULL | H·ªç t√™n ƒë·∫ßy ƒë·ªß |
| role | TEXT NOT NULL DEFAULT 'employee' | admin/manager/cashier/employee |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| last_login | TEXT | L·∫ßn ƒëƒÉng nh·∫≠p cu·ªëi (ISO 8601) |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üé≠ **roles** - Vai tr√≤ h·ªá th·ªëng (Optional)
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT UNIQUE NOT NULL | T√™n role |
| description | TEXT | M√¥ t·∫£ role |
| permissions | TEXT | JSON array permissions |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |

### üîó **user_roles** - Mapping user-role
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| user_id | TEXT NOT NULL | FK ‚Üí users.id |
| role_id | TEXT NOT NULL | FK ‚Üí roles.id |
| assigned_at | TEXT DEFAULT (datetime('now')) | Ng√†y g√°n role |
| PRIMARY KEY | (user_id, role_id) | Composite key |

---

## üè™ **2. STORES & BUSINESS**

### üè¢ **stores** - Th√¥ng tin c·ª≠a h√†ng
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT NOT NULL | T√™n c·ª≠a h√†ng |
| address | TEXT NOT NULL | ƒê·ªãa ch·ªâ |
| phone | TEXT NOT NULL | S·ªë ƒëi·ªán tho·∫°i |
| email | TEXT NOT NULL | Email li√™n h·ªá |
| tax_number | TEXT | M√£ s·ªë thu·∫ø |
| business_license | TEXT | Gi·∫•y ph√©p kinh doanh |
| logo_url | TEXT | URL logo (R2 storage) |
| timezone | TEXT DEFAULT 'Asia/Ho_Chi_Minh' | M√∫i gi·ªù |
| currency | TEXT DEFAULT 'VND' | ƒê∆°n v·ªã ti·ªÅn t·ªá |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

---

## üì¶ **3. PRODUCT MANAGEMENT**

### üìÇ **categories** - Danh m·ª•c s·∫£n ph·∫©m
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT NOT NULL | T√™n danh m·ª•c |
| description | TEXT | M√¥ t·∫£ danh m·ª•c |
| parent_id | TEXT | FK ‚Üí categories.id (n·∫øu ph√¢n c·∫•p) |
| image_url | TEXT | URL h√¨nh ·∫£nh (R2 storage) |
| sort_order | INTEGER DEFAULT 0 | Th·ª© t·ª± s·∫Øp x·∫øp |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üè∑Ô∏è **brands** - Th∆∞∆°ng hi·ªáu
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT NOT NULL | T√™n th∆∞∆°ng hi·ªáu |
| description | TEXT | M√¥ t·∫£ th∆∞∆°ng hi·ªáu |
| website | TEXT | Website ch√≠nh th·ª©c |
| logo_url | TEXT | URL logo (R2 storage) |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üöõ **suppliers** - Nh√† cung c·∫•p
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT NOT NULL | T√™n nh√† cung c·∫•p |
| contact_person | TEXT | Ng∆∞·ªùi li√™n h·ªá |
| email | TEXT | Email li√™n h·ªá |
| phone | TEXT | S·ªë ƒëi·ªán tho·∫°i |
| address | TEXT | ƒê·ªãa ch·ªâ |
| tax_number | TEXT | M√£ s·ªë thu·∫ø |
| payment_terms | TEXT | ƒêi·ªÅu ki·ªán thanh to√°n |
| credit_limit_cents | INTEGER DEFAULT 0 | H·∫°n m·ª©c t√≠n d·ª•ng (VND cents) |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üì¶ **products** - S·∫£n ph·∫©m ch√≠nh
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT NOT NULL | T√™n s·∫£n ph·∫©m |
| sku | TEXT UNIQUE NOT NULL | M√£ SKU |
| barcode | TEXT UNIQUE | M√£ v·∫°ch |
| description | TEXT | M√¥ t·∫£ s·∫£n ph·∫©m |
| price_cents | INTEGER NOT NULL CHECK (price_cents >= 0) | Gi√° b√°n (VND x 100) |
| cost_price_cents | INTEGER NOT NULL CHECK (cost_price_cents >= 0) | Gi√° nh·∫≠p (VND x 100) |
| stock | INTEGER DEFAULT 0 CHECK (stock >= 0) | T·ªìn kho hi·ªán t·∫°i |
| min_stock | INTEGER DEFAULT 0 CHECK (min_stock >= 0) | T·ªìn kho t·ªëi thi·ªÉu |
| max_stock | INTEGER DEFAULT 1000 CHECK (max_stock >= min_stock) | T·ªìn kho t·ªëi ƒëa |
| unit | TEXT DEFAULT 'piece' | ƒê∆°n v·ªã t√≠nh |
| weight_grams | INTEGER | Tr·ªçng l∆∞·ª£ng (gram) |
| dimensions | TEXT | K√≠ch th∆∞·ªõc JSON {"length":100,"width":50,"height":20} |
| category_id | TEXT | FK ‚Üí categories.id |
| brand_id | TEXT | FK ‚Üí brands.id |
| supplier_id | TEXT | FK ‚Üí suppliers.id |
| store_id | TEXT DEFAULT 'store-1' | FK ‚Üí stores.id |
| image_url | TEXT | URL h√¨nh ch√≠nh (R2 storage) |
| images | TEXT | JSON array URLs h√¨nh ph·ª• |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| is_serialized | INTEGER DEFAULT 0 | 0=kh√¥ng, 1=c√≥ serial number |
| category_name | TEXT | Denormalized t·ª´ categories.name |
| brand_name | TEXT | Denormalized t·ª´ brands.name |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üé® **product_variants** - Bi·∫øn th·ªÉ s·∫£n ph·∫©m
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| product_id | TEXT NOT NULL | FK ‚Üí products.id |
| variant_name | TEXT NOT NULL | T√™n bi·∫øn th·ªÉ |
| sku | TEXT UNIQUE NOT NULL | M√£ SKU ri√™ng |
| price_cents | INTEGER NOT NULL CHECK (price_cents >= 0) | Gi√° b√°n (VND x 100) |
| cost_price_cents | INTEGER NOT NULL CHECK (cost_price_cents >= 0) | Gi√° nh·∫≠p (VND x 100) |
| stock | INTEGER DEFAULT 0 CHECK (stock >= 0) | T·ªìn kho |
| attributes | TEXT | JSON {"color":"red","size":"L"} |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üè∑Ô∏è **serial_numbers** - S·ªë serial b·∫£o h√†nh
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| product_id | TEXT NOT NULL | FK ‚Üí products.id |
| variant_id | TEXT | FK ‚Üí product_variants.id |
| serial_number | TEXT UNIQUE NOT NULL | S·ªë serial |
| status | TEXT DEFAULT 'available' | available/sold/returned/defective |
| batch_number | TEXT | S·ªë l√¥ |
| purchase_date | TEXT | Ng√†y nh·∫≠p (ISO 8601) |
| sale_date | TEXT | Ng√†y b√°n (ISO 8601) |
| customer_id | TEXT | FK ‚Üí customers.id |
| warranty_start_date | TEXT | Ng√†y b·∫Øt ƒë·∫ßu b·∫£o h√†nh |
| warranty_end_date | TEXT | Ng√†y k·∫øt th√∫c b·∫£o h√†nh |
| notes | TEXT | Ghi ch√∫ |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

---

## üë• **4. CUSTOMERS & LOYALTY**

### üë§ **customers** - Kh√°ch h√†ng
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT NOT NULL | H·ªç t√™n kh√°ch h√†ng |
| email | TEXT | Email |
| phone | TEXT | S·ªë ƒëi·ªán tho·∫°i |
| address | TEXT | ƒê·ªãa ch·ªâ |
| date_of_birth | TEXT | Ng√†y sinh (ISO 8601: '1990-05-15') |
| gender | TEXT | male/female/other |
| customer_type | TEXT DEFAULT 'regular' | regular/vip/wholesale |
| loyalty_points | INTEGER DEFAULT 0 CHECK (loyalty_points >= 0) | ƒêi·ªÉm t√≠ch l≈©y |
| total_spent_cents | INTEGER DEFAULT 0 CHECK (total_spent_cents >= 0) | T·ªïng chi ti√™u (VND x 100) |
| visit_count | INTEGER DEFAULT 0 CHECK (visit_count >= 0) | S·ªë l·∫ßn mua |
| last_visit | TEXT | L·∫ßn mua cu·ªëi (ISO 8601) |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üéÅ **loyalty_points_history** - L·ªãch s·ª≠ ƒëi·ªÉm th∆∞·ªüng
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| customer_id | TEXT NOT NULL | FK ‚Üí customers.id |
| points | INTEGER NOT NULL | S·ªë ƒëi·ªÉm (+/-) |
| type | TEXT NOT NULL | earned/redeemed/expired/adjustment |
| reference_id | TEXT | order_id ho·∫∑c transaction_id |
| reference_type | TEXT | Lo·∫°i reference |
| description | TEXT | M√¥ t·∫£ giao d·ªãch |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |

---

## üõí **5. ORDERS & SALES**

### üí≥ **payment_methods** - Ph∆∞∆°ng th·ª©c thanh to√°n
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT NOT NULL | T√™n ph∆∞∆°ng th·ª©c |
| code | TEXT UNIQUE NOT NULL | M√£ code |
| description | TEXT | M√¥ t·∫£ |
| fee_percentage | REAL DEFAULT 0 | Ph√≠ x·ª≠ l√Ω (%) |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |

### üõí **orders** - ƒê∆°n h√†ng/H√≥a ƒë∆°n
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| order_number | TEXT UNIQUE NOT NULL | S·ªë ƒë∆°n h√†ng |
| customer_id | TEXT | FK ‚Üí customers.id |
| user_id | TEXT NOT NULL | FK ‚Üí users.id (cashier) |
| store_id | TEXT NOT NULL | FK ‚Üí stores.id |
| status | TEXT NOT NULL DEFAULT 'pending' | draft/pending/completed/cancelled/refunded |
| subtotal_cents | INTEGER NOT NULL DEFAULT 0 CHECK (subtotal_cents >= 0) | T·∫°m t√≠nh (VND x 100) |
| discount_cents | INTEGER DEFAULT 0 CHECK (discount_cents >= 0) | Gi·∫£m gi√° (VND x 100) |
| tax_cents | INTEGER DEFAULT 0 CHECK (tax_cents >= 0) | Thu·∫ø (VND x 100) |
| total_cents | INTEGER NOT NULL DEFAULT 0 CHECK (total_cents >= 0) | T·ªïng c·ªông (VND x 100) |
| notes | TEXT | Ghi ch√∫ |
| receipt_printed | INTEGER DEFAULT 0 | 0=ch∆∞a in, 1=ƒë√£ in |
| customer_name | TEXT | Denormalized t·ª´ customers.name |
| customer_phone | TEXT | Denormalized t·ª´ customers.phone |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üìã **order_items** - Chi ti·∫øt ƒë∆°n h√†ng
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| order_id | TEXT NOT NULL | FK ‚Üí orders.id |
| product_id | TEXT NOT NULL | FK ‚Üí products.id |
| variant_id | TEXT | FK ‚Üí product_variants.id |
| quantity | INTEGER NOT NULL CHECK (quantity > 0) | S·ªë l∆∞·ª£ng |
| unit_price_cents | INTEGER NOT NULL CHECK (unit_price_cents >= 0) | ƒê∆°n gi√° (VND x 100) |
| total_price_cents | INTEGER NOT NULL CHECK (total_price_cents >= 0) | Th√†nh ti·ªÅn (VND x 100) |
| discount_cents | INTEGER DEFAULT 0 CHECK (discount_cents >= 0) | Gi·∫£m gi√° (VND x 100) |
| product_name | TEXT | Denormalized t·ª´ products.name |
| product_sku | TEXT | Denormalized t·ª´ products.sku |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |

### üí∞ **payments** - Thanh to√°n
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| order_id | TEXT NOT NULL | FK ‚Üí orders.id |
| payment_method_id | TEXT NOT NULL | FK ‚Üí payment_methods.id |
| amount_cents | INTEGER NOT NULL CHECK (amount_cents > 0) | S·ªë ti·ªÅn (VND x 100) |
| reference | TEXT | M√£ giao d·ªãch t·ª´ gateway |
| status | TEXT NOT NULL DEFAULT 'completed' | pending/completed/failed/refunded |
| processed_at | TEXT DEFAULT (datetime('now')) | Th·ªùi gian x·ª≠ l√Ω |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |

---

## üìä **6. INVENTORY MANAGEMENT**

### üì¶ **inventory_movements** - Xu·∫•t nh·∫≠p kho
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| product_id | TEXT NOT NULL | FK ‚Üí products.id |
| variant_id | TEXT | FK ‚Üí product_variants.id |
| transaction_type | TEXT NOT NULL | in/out/adjustment/transfer |
| quantity | INTEGER NOT NULL | S·ªë l∆∞·ª£ng (+/-) |
| unit_cost_cents | INTEGER | Gi√° nh·∫≠p/xu·∫•t per unit (VND x 100) |
| reference_id | TEXT | order_id, purchase_id, etc. |
| reference_type | TEXT | order/purchase/adjustment/transfer |
| reason | TEXT | L√Ω do |
| notes | TEXT | Ghi ch√∫ |
| user_id | TEXT | FK ‚Üí users.id |
| store_id | TEXT | FK ‚Üí stores.id |
| product_name | TEXT | Denormalized t·ª´ products.name |
| product_sku | TEXT | Denormalized t·ª´ products.sku |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |

### üìã **stock_check_sessions** - Phi√™n ki·ªÉm k√™
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| session_name | TEXT NOT NULL | T√™n phi√™n ki·ªÉm k√™ |
| status | TEXT NOT NULL DEFAULT 'in_progress' | in_progress/completed/cancelled |
| store_id | TEXT | FK ‚Üí stores.id |
| started_at | TEXT DEFAULT (datetime('now')) | Th·ªùi gian b·∫Øt ƒë·∫ßu |
| ended_at | TEXT | Th·ªùi gian k·∫øt th√∫c |
| items_count | INTEGER DEFAULT 0 | T·ªïng s·ªë items |
| items_checked | INTEGER DEFAULT 0 | S·ªë items ƒë√£ ki·ªÉm |
| discrepancies_found | INTEGER DEFAULT 0 | S·ªë ch√™nh l·ªách t√¨m th·∫•y |
| created_by | TEXT | FK ‚Üí users.id |
| notes | TEXT | Ghi ch√∫ |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üìù **stock_check_items** - Chi ti·∫øt ki·ªÉm k√™
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| session_id | TEXT NOT NULL | FK ‚Üí stock_check_sessions.id |
| product_id | TEXT NOT NULL | FK ‚Üí products.id |
| variant_id | TEXT | FK ‚Üí product_variants.id |
| expected_quantity | INTEGER NOT NULL DEFAULT 0 | S·ªë l∆∞·ª£ng d·ª± ki·∫øn |
| actual_quantity | INTEGER | S·ªë l∆∞·ª£ng th·ª±c t·∫ø |
| discrepancy | INTEGER DEFAULT 0 | Ch√™nh l·ªách |
| notes | TEXT | Ghi ch√∫ |
| checked_at | TEXT | Th·ªùi gian ki·ªÉm tra |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

---

## üéØ **7. PROMOTIONS & MARKETING**

### üè∑Ô∏è **promotions** - Khuy·∫øn m√£i
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT NOT NULL | T√™n ch∆∞∆°ng tr√¨nh |
| description | TEXT | M√¥ t·∫£ |
| type | TEXT NOT NULL | percentage/fixed_amount/buy_x_get_y |
| value_cents | INTEGER NOT NULL CHECK (value_cents >= 0) | Gi√° tr·ªã (VND x 100 cho fixed_amount) |
| value_percentage | REAL | Gi√° tr·ªã % (0-100 cho percentage) |
| min_amount_cents | INTEGER DEFAULT 0 CHECK (min_amount_cents >= 0) | Gi√° tr·ªã t·ªëi thi·ªÉu (VND x 100) |
| max_discount_cents | INTEGER | Gi·∫£m t·ªëi ƒëa (VND x 100) |
| start_date | TEXT | Ng√†y b·∫Øt ƒë·∫ßu (ISO 8601) |
| end_date | TEXT | Ng√†y k·∫øt th√∫c (ISO 8601) |
| usage_limit | INTEGER | Gi·ªõi h·∫°n s·ª≠ d·ª•ng |
| usage_count | INTEGER DEFAULT 0 | S·ªë l·∫ßn ƒë√£ d√πng |
| applicable_to | TEXT DEFAULT 'all' | all/categories/products/customers |
| conditions | TEXT | JSON ƒëi·ªÅu ki·ªán ph·ª©c t·∫°p |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üìä **promotion_usage** - L·ªãch s·ª≠ s·ª≠ d·ª•ng khuy·∫øn m√£i
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| promotion_id | TEXT NOT NULL | FK ‚Üí promotions.id |
| order_id | TEXT NOT NULL | FK ‚Üí orders.id |
| customer_id | TEXT | FK ‚Üí customers.id |
| discount_cents | INTEGER NOT NULL CHECK (discount_cents >= 0) | S·ªë ti·ªÅn gi·∫£m (VND x 100) |
| used_at | TEXT DEFAULT (datetime('now')) | Th·ªùi gian s·ª≠ d·ª•ng |

---

## üí∞ **8. TAX & FINANCE**

### üßæ **tax_rates** - Thu·∫ø
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| name | TEXT NOT NULL | T√™n lo·∫°i thu·∫ø |
| rate_percentage | REAL NOT NULL CHECK (rate_percentage >= 0 AND rate_percentage <= 100) | Thu·∫ø su·∫•t (%) |
| description | TEXT | M√¥ t·∫£ |
| is_active | INTEGER DEFAULT 1 | 0=v√¥ hi·ªáu, 1=ho·∫°t ƒë·ªông |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

---

## ‚öôÔ∏è **9. SYSTEM & CONFIGURATION**

### üîß **settings** - C√†i ƒë·∫∑t h·ªá th·ªëng
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| key | TEXT UNIQUE NOT NULL | Kh√≥a setting |
| value | TEXT NOT NULL | Gi√° tr·ªã |
| description | TEXT | M√¥ t·∫£ |
| category | TEXT DEFAULT 'general' | Nh√≥m setting |
| data_type | TEXT DEFAULT 'string' | string/number/boolean/json |
| is_public | INTEGER DEFAULT 0 | 0=admin only, 1=public |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |
| updated_at | TEXT DEFAULT (datetime('now')) | Ng√†y c·∫≠p nh·∫≠t |

### üîê **user_sessions** - Phi√™n ƒëƒÉng nh·∫≠p
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| user_id | TEXT NOT NULL | FK ‚Üí users.id |
| token_hash | TEXT UNIQUE NOT NULL | Hash c·ªßa token |
| device_info | TEXT | JSON th√¥ng tin device |
| ip_address | TEXT | ƒê·ªãa ch·ªâ IP |
| expires_at | TEXT NOT NULL | Th·ªùi gian h·∫øt h·∫°n (ISO 8601) |
| last_activity | TEXT DEFAULT (datetime('now')) | Ho·∫°t ƒë·ªông cu·ªëi |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |

---

## üìù **10. AUDIT & LOGGING**

### üìã **audit_logs** - Log audit
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT PK | Primary key |
| user_id | TEXT | FK ‚Üí users.id |
| action | TEXT NOT NULL | H√†nh ƒë·ªông |
| table_name | TEXT | T√™n b·∫£ng |
| record_id | TEXT | ID b·∫£n ghi |
| old_values | TEXT | Gi√° tr·ªã c≈© (JSON) |
| new_values | TEXT | Gi√° tr·ªã m·ªõi (JSON) |
| ip_address | TEXT | ƒê·ªãa ch·ªâ IP |
| user_agent | TEXT | User agent |
| created_at | TEXT DEFAULT (datetime('now')) | Ng√†y t·∫°o |

---

## üëÅÔ∏è **11. PERFORMANCE VIEWS**

### üìä **v_products_summary** - T·ªïng h·ª£p s·∫£n ph·∫©m
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT | Product ID |
| name | TEXT | T√™n s·∫£n ph·∫©m |
| sku | TEXT | M√£ SKU |
| barcode | TEXT | M√£ v·∫°ch |
| price_cents | INTEGER | Gi√° b√°n (VND x 100) |
| cost_price_cents | INTEGER | Gi√° nh·∫≠p (VND x 100) |
| stock | INTEGER | T·ªìn kho |
| min_stock | INTEGER | T·ªìn kho t·ªëi thi·ªÉu |
| category_name | TEXT | T√™n danh m·ª•c (denormalized) |
| brand_name | TEXT | T√™n th∆∞∆°ng hi·ªáu (denormalized) |
| is_active | INTEGER | Tr·∫°ng th√°i |
| category_full_name | TEXT | T√™n danh m·ª•c ƒë·∫ßy ƒë·ªß |
| brand_full_name | TEXT | T√™n th∆∞∆°ng hi·ªáu ƒë·∫ßy ƒë·ªß |
| supplier_name | TEXT | T√™n nh√† cung c·∫•p |

### üßæ **v_orders_summary** - T·ªïng h·ª£p ƒë∆°n h√†ng
| C·ªôt | Ki·ªÉu | Ghi ch√∫ |
|-----|------|---------|
| id | TEXT | Order ID |
| order_number | TEXT | S·ªë ƒë∆°n h√†ng |
| customer_name | TEXT | T√™n kh√°ch h√†ng (denormalized) |
| customer_phone | TEXT | SƒêT kh√°ch h√†ng (denormalized) |
| total_cents | INTEGER | T·ªïng ti·ªÅn (VND x 100) |
| status | TEXT | Tr·∫°ng th√°i ƒë∆°n h√†ng |
| created_at | TEXT | Ng√†y t·∫°o |
| cashier_name | TEXT | T√™n thu ng√¢n |
| store_name | TEXT | T√™n c·ª≠a h√†ng |

---

## ‚ö° **12. DATABASE TRIGGERS**

### üîÑ **update_stock_on_inventory_movement**
- **Trigger**: AFTER INSERT ON inventory_movements
- **Ch·ª©c nƒÉng**: T·ª± ƒë·ªông c·∫≠p nh·∫≠t stock trong b·∫£ng products v√† product_variants

### üë§ **update_customer_stats_on_order**
- **Trigger**: AFTER UPDATE ON orders
- **Ch·ª©c nƒÉng**: C·∫≠p nh·∫≠t total_spent_cents, visit_count, last_visit khi ƒë∆°n h√†ng completed

### üî¢ **generate_order_number**
- **Trigger**: AFTER INSERT ON orders
- **Ch·ª©c nƒÉng**: T·ª± ƒë·ªông t·∫°o order_number theo format 'ORD-YYYYMMDD-XXXXXX'

### ‚ö° **update_product_denormalized_fields**
- **Trigger**: AFTER UPDATE ON products
- **Ch·ª©c nƒÉng**: C·∫≠p nh·∫≠t category_name, brand_name khi category_id ho·∫∑c brand_id thay ƒë·ªïi

---

## üìä **T·ªîNG K·∫æT**

### üìà **Th·ªëng k√™ c∆° s·ªü d·ªØ li·ªáu:**
- **20 b·∫£ng ch√≠nh** v·ªõi ƒë·∫ßy ƒë·ªß ch·ª©c nƒÉng POS
- **2 performance views** cho b√°o c√°o nhanh
- **4 triggers** t·ª± ƒë·ªông x·ª≠ l√Ω d·ªØ li·ªáu
- **30+ indexes** t·ªëi ∆∞u hi·ªáu nƒÉng
- **Foreign keys** ƒë·∫ßy ƒë·ªß ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn
- **CHECK constraints** validate d·ªØ li·ªáu

### üí∞ **Chi·∫øn l∆∞·ª£c gi√° c·∫£:**
- **T·∫•t c·∫£ gi√° ti·ªÅn** l∆∞u b·∫±ng **INTEGER cents**
- **50,000 VND** = **5,000,000 cents**
- **ƒê·ªô ch√≠nh x√°c 100%**, kh√¥ng m·∫•t precision

### ‚ö° **T·ªëi ∆∞u hi·ªáu nƒÉng:**
- **Denormalized fields** gi·∫£m JOIN queries
- **Strategic indexes** cho c√°c truy v·∫•n th∆∞·ªùng xuy√™n
- **Composite indexes** cho queries ph·ª©c t·∫°p
- **Views** s·∫µn s√†ng cho reporting

### üöÄ **D1 Ready:**
- **SQLite syntax** 100% t∆∞∆°ng th√≠ch
- **Serverless optimized** cho Cloudflare D1
- **Global replication** ready
- **Production deployment** s·∫µn s√†ng

**‚úÖ C∆° s·ªü d·ªØ li·ªáu ho√†n ch·ªânh, chi ti·∫øt, production-ready cho SmartPOS!**