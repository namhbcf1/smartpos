import{j as e,af as M,W as t,ad as ve,T as n,a8 as u,$ as O,t as g,ae as fe,aj as o,Y as C,Z as T,P as w,aK as Se,aL as B,X as K,E as Ce,ak as Y,al as U,am as X,ab as c,ap as Te,aq as _e,ar as Ie,as as q,at as i,au as we,C as G,V as D,I as Q,ax as Be,D as De,ay as ke,o as We,v as Fe}from"../chunks/mui-core-cd9e8750.js";import{r}from"../chunks/react-vendor-9ee90314.js";import{a as k}from"../assets/index-fad1ea34.js";import{n as W,t as Le,ar as Pe,T as He,a as F,W as Z,aU as J,r as Ee,al as ee,x as Re,e as Ne,l as Ve,w as ze,Y as Ae}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/ui-vendor-11834b8a.js";import"../chunks/utils-vendor-8faa4a85.js";const Qe=()=>{const[d,se]=r.useState(0),[L,ne]=r.useState([]),[te,re]=r.useState([]),[h,ae]=r.useState(null),[P,p]=r.useState(!1),[H,x]=r.useState(null),[b,_]=r.useState(0),[y,ie]=r.useState(10),[le,E]=r.useState(0),[j,ce]=r.useState(""),[m,oe]=r.useState("all"),[v,de]=r.useState("all"),[l,R]=r.useState(null),[he,f]=r.useState(!1),[$e,xe]=r.useState(!1),[Me,N]=r.useState(!1);r.useEffect(()=>{V(),d===0?z():d===1&&A()},[d,b,y,j,m,v]);const V=async()=>{try{const s=await k.get("/warranty/dashboard");s.success&&ae(s.data)}catch(s){console.error("Error loading warranty stats:",s)}},z=async()=>{p(!0),x(null);try{const s=new URLSearchParams({page:(b+1).toString(),limit:y.toString(),...j&&{search:j},...m!=="all"&&{status:m},...v!=="all"&&{warranty_type:v}}),a=await k.get(`/warranty/registrations?${s}`);a.success?(ne(a.data),E(a.pagination.total)):x("Không thể tải danh sách bảo hành")}catch(s){console.error("Error loading warranties:",s),x("Lỗi khi tải danh sách bảo hành")}finally{p(!1)}},A=async()=>{p(!0),x(null);try{const s=new URLSearchParams({page:(b+1).toString(),limit:y.toString(),...j&&{search:j},...m!=="all"&&{status:m}}),a=await k.get(`/warranty/claims?${s}`);a.success?(re(a.data),E(a.pagination.total)):x("Không thể tải danh sách yêu cầu bảo hành")}catch(s){console.error("Error loading warranty claims:",s),x("Lỗi khi tải danh sách yêu cầu bảo hành")}finally{p(!1)}},je=s=>{switch(s){case"active":return e.jsx(F,{sx:{color:"#4CAF50"}});case"expired":return e.jsx(Ae,{sx:{color:"#f44336"}});case"claimed":return e.jsx(J,{sx:{color:"#FF9800"}});case"completed":return e.jsx(F,{sx:{color:"#2196F3"}});default:return e.jsx(W,{})}},me=s=>{switch(s){case"active":return"success";case"expired":return"error";case"claimed":return"warning";case"completed":return"primary";default:return"default"}},ue=s=>{switch(s){case"active":return"Đang hiệu lực";case"expired":return"Đã hết hạn";case"claimed":return"Đang bảo hành";case"completed":return"Hoàn thành";default:return s}},ge=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s),I=s=>new Date(s).toLocaleDateString("vi-VN"),pe=s=>{R(s),f(!0)},be=s=>{const a=new Date(s),S=new Date,ye=a.getTime()-S.getTime(),$=Math.ceil(ye/(1e3*60*60*24));return $<=30&&$>0};return P&&L.length===0&&te.length===0?e.jsx(M,{maxWidth:"xl",sx:{py:4},children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:8},children:[e.jsx(ve,{size:60,sx:{mb:2}}),e.jsx(n,{variant:"h6",color:"text.secondary",children:"Đang tải dữ liệu bảo hành..."})]})}):e.jsxs(M,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(u,{sx:{bgcolor:"primary.main",mr:2,width:56,height:56},children:e.jsx(W,{fontSize:"large"})}),e.jsxs(t,{children:[e.jsx(n,{variant:"h4",component:"h1",children:"Quản lý Bảo hành"}),e.jsx(n,{variant:"subtitle1",color:"text.secondary",children:"Theo dõi và xử lý bảo hành sản phẩm"})]})]}),e.jsxs(O,{direction:"row",spacing:2,children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(Le,{}),onClick:()=>{V(),d===0?z():d===1&&A()},disabled:P,children:"Làm mới"}),e.jsx(g,{variant:"outlined",startIcon:e.jsx(Pe,{}),children:"Xuất Excel"}),e.jsx(g,{variant:"contained",startIcon:e.jsx(He,{}),onClick:()=>xe(!0),children:"Đăng ký BH"})]})]}),H&&e.jsx(fe,{severity:"error",sx:{mb:3},children:H}),h&&e.jsxs(o,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{children:e.jsx(T,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(u,{sx:{bgcolor:"#4CAF50",mr:2},children:e.jsx(F,{})}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"BH hiệu lực"}),e.jsx(n,{variant:"h6",children:h.total_active_warranties.toLocaleString("vi-VN")})]})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{children:e.jsx(T,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(u,{sx:{bgcolor:"#FF9800",mr:2},children:e.jsx(Z,{})}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Sắp hết hạn"}),e.jsx(n,{variant:"h6",children:h.expiring_soon.toLocaleString("vi-VN")})]})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{children:e.jsx(T,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(u,{sx:{bgcolor:"#2196F3",mr:2},children:e.jsx(J,{})}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Yêu cầu BH"}),e.jsx(n,{variant:"h6",children:h.pending_claims.toLocaleString("vi-VN")})]})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{children:e.jsx(T,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(u,{sx:{bgcolor:"#9C27B0",mr:2},children:e.jsx(Ee,{})}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Chi phí BH"}),e.jsx(n,{variant:"h6",children:ge(h.warranty_cost_this_month)})]})]})})})})]}),e.jsx(w,{sx:{mb:3},children:e.jsxs(Se,{value:d,onChange:(s,a)=>{se(a),_(0)},indicatorColor:"primary",textColor:"primary",children:[e.jsx(B,{label:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{}),"Đăng ký bảo hành",e.jsx(K,{badgeContent:h?.total_active_warranties||0,color:"primary"})]})}),e.jsx(B,{label:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ee,{}),"Yêu cầu bảo hành",e.jsx(K,{badgeContent:h?.pending_claims||0,color:"error"})]})}),e.jsx(B,{label:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Re,{}),"Thống kê"]})})]})}),e.jsxs(w,{sx:{p:3,mb:4},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Bộ lọc tìm kiếm"}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,md:4,children:e.jsx(Ce,{fullWidth:!0,label:"Tìm kiếm",value:j,onChange:s=>ce(s.target.value),placeholder:d===0?"Tìm theo serial, khách hàng...":"Tìm theo mã claim...",InputProps:{startAdornment:e.jsx(Ne,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(o,{item:!0,xs:12,md:4,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(U,{children:"Trạng thái"}),e.jsxs(X,{value:m,onChange:s=>oe(s.target.value),label:"Trạng thái",children:[e.jsx(c,{value:"all",children:"Tất cả"}),d===0?e.jsxs(e.Fragment,{children:[e.jsx(c,{value:"active",children:"Đang hiệu lực"}),e.jsx(c,{value:"expired",children:"Đã hết hạn"}),e.jsx(c,{value:"claimed",children:"Đang bảo hành"}),e.jsx(c,{value:"completed",children:"Hoàn thành"})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{value:"pending",children:"Chờ xử lý"}),e.jsx(c,{value:"in_progress",children:"Đang xử lý"}),e.jsx(c,{value:"completed",children:"Hoàn thành"}),e.jsx(c,{value:"rejected",children:"Từ chối"})]})]})]})}),e.jsx(o,{item:!0,xs:12,md:4,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(U,{children:"Loại"}),e.jsxs(X,{value:v,onChange:s=>de(s.target.value),label:"Loại",children:[e.jsx(c,{value:"all",children:"Tất cả"}),e.jsx(c,{value:"manufacturer",children:"Bảo hành hãng"}),e.jsx(c,{value:"store",children:"Bảo hành cửa hàng"}),e.jsx(c,{value:"extended",children:"Bảo hành mở rộng"})]})]})})]})]}),d===0&&e.jsxs(w,{children:[e.jsx(Te,{children:e.jsxs(_e,{children:[e.jsx(Ie,{children:e.jsxs(q,{children:[e.jsx(i,{children:"Mã BH"}),e.jsx(i,{children:"Serial Number"}),e.jsx(i,{children:"Sản phẩm"}),e.jsx(i,{children:"Khách hàng"}),e.jsx(i,{children:"Loại BH"}),e.jsx(i,{children:"Trạng thái"}),e.jsx(i,{children:"Hết hạn"}),e.jsx(i,{align:"center",children:"Thao tác"})]})}),e.jsx(we,{children:L.map(s=>e.jsxs(q,{hover:!0,children:[e.jsx(i,{children:e.jsx(n,{variant:"body2",fontWeight:"medium",children:s.warranty_number})}),e.jsx(i,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(u,{sx:{bgcolor:"primary.main",mr:2,width:32,height:32},children:e.jsx(Ve,{fontSize:"small"})}),e.jsx(n,{variant:"body2",children:s.serial_number})]})}),e.jsx(i,{children:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:"medium",children:s.product_name}),e.jsx(n,{variant:"caption",color:"text.secondary",children:s.product_sku})]})}),e.jsx(i,{children:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",children:s.customer_name}),e.jsx(n,{variant:"caption",color:"text.secondary",children:s.customer_phone})]})}),e.jsx(i,{children:e.jsx(G,{label:s.warranty_type,size:"small",variant:"outlined"})}),e.jsx(i,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{icon:je(s.status),label:ue(s.status),color:me(s.status),size:"small"}),be(s.end_date)&&e.jsx(D,{title:"Sắp hết hạn",children:e.jsx(Z,{color:"warning",fontSize:"small"})})]})}),e.jsxs(i,{children:[e.jsx(n,{variant:"body2",children:I(s.end_date)}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:["(",s.warranty_period_months," tháng)"]})]}),e.jsx(i,{align:"center",children:e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(D,{title:"Xem chi tiết",children:e.jsx(Q,{size:"small",onClick:()=>pe(s),children:e.jsx(ze,{})})}),e.jsx(D,{title:"Tạo yêu cầu BH",children:e.jsx(Q,{size:"small",onClick:()=>{R(s),N(!0)},children:e.jsx(ee,{})})})]})})]},s.id))})]})}),e.jsx(Be,{component:"div",count:le,page:b,onPageChange:(s,a)=>_(a),rowsPerPage:y,onRowsPerPageChange:s=>{ie(parseInt(s.target.value,10)),_(0)},labelRowsPerPage:"Số dòng mỗi trang:",labelDisplayedRows:({from:s,to:a,count:S})=>`${s}-${a} của ${S!==-1?S:`hơn ${a}`}`})]}),e.jsxs(De,{open:he,onClose:()=>f(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ke,{children:"Chi tiết bảo hành"}),e.jsx(We,{children:l&&e.jsx(t,{sx:{pt:2},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Thông tin bảo hành"}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Mã bảo hành:"}),e.jsx(n,{variant:"body1",fontWeight:"medium",children:l.warranty_number})]}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Serial Number:"}),e.jsx(n,{variant:"body1",children:l.serial_number})]}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Sản phẩm:"}),e.jsx(n,{variant:"body1",children:l.product_name})]}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Loại bảo hành:"}),e.jsx(n,{variant:"body1",children:l.warranty_type})]})]}),e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Thông tin khách hàng"}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Tên khách hàng:"}),e.jsx(n,{variant:"body1",children:l.customer_name})]}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Số điện thoại:"}),e.jsx(n,{variant:"body1",children:l.contact_phone||l.customer_phone})]}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Email:"}),e.jsx(n,{variant:"body1",children:l.contact_email||l.customer_email||"Chưa có"})]}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Thời hạn:"}),e.jsxs(n,{variant:"body1",children:[I(l.start_date)," - ",I(l.end_date)]}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:["(",l.warranty_period_months," tháng)"]})]})]})]})})}),e.jsxs(Fe,{children:[e.jsx(g,{onClick:()=>f(!1),children:"Đóng"}),l&&l.status==="active"&&e.jsx(g,{variant:"contained",onClick:()=>{f(!1),N(!0)},children:"Tạo yêu cầu BH"})]})]})]})};export{Qe as default};
