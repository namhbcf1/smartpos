import{j as e,af as b,W as a,ad as V,T as n,an as H,ae as A,t as I,a8 as p,V as X,I as Y,P as G,aj as t,ak as B,al as L,am as M,ab as u,Y as x,Z as d,C as v,L as O,w as Z,a1 as J,a2 as Q,a3 as U,ap as _,aq as ee,ar as re,as as S,at as i,au as se}from"../chunks/mui-core-cd9e8750.js";import{r as j,b as ne}from"../chunks/react-vendor-9ee90314.js";import{a as C}from"../assets/index-fad1ea34.js";import{t as E,a7 as ae,ar as te,r as ie,x as ce,at as le,p as oe,i as he,aD as xe,aF as de,W as me,n as ue,aT as je,a as pe}from"../chunks/mui-icons-f0327ae6.js";import{R as ge,d as ye,b as fe,X as be,Y as ve,T as Fe,B as P,c as R}from"../chunks/chart-vendor-c17345c1.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/ui-vendor-11834b8a.js";import"../chunks/utils-vendor-8faa4a85.js";const Le=()=>{const[s,w]=j.useState(null),[W,k]=j.useState(!1),[D,T]=j.useState(null),[h,K]=j.useState("monthly"),[F,$]=j.useState("previous");j.useEffect(()=>{g()},[]);const g=async()=>{k(!0),T(null);try{const r=await C.get(`/reports/financial?period=${h}&comparison=${F}`);w(r)}catch(r){const l=r?.response?.status;console.warn("Primary financial report failed, attempting fallback endpoints...",l);try{await C.get("/financial/summary");const m=(await C.get(`/financial/chart-data?period=${h==="weekly"?"week":h==="monthly"?"month":"year"}`)).map(c=>({period:c.period,revenue:c.income,expenses:c.expense,profit:Math.max(0,c.income-c.expense),profitMargin:c.income>0?(c.income-c.expense)/c.income*100:0,cashFlow:c.income-c.expense})),f=m[m.length-1]||{revenue:0,profit:0,profitMargin:0,cashFlow:0},z={summary:{currentRevenue:f.revenue,currentProfit:f.profit,profitMargin:f.profitMargin,cashFlow:f.cashFlow,period:h,comparison:F},periodData:m,insights:[{type:"strength",title:"B√°o c√°o t·ªïng h·ª£p",description:"D·ªØ li·ªáu t·ªïng h·ª£p t·ª´ c√°c endpoint t√†i ch√≠nh",confidence:.8,recommendation:"S·ª≠ d·ª•ng nh∆∞ ph∆∞∆°ng √°n d·ª± ph√≤ng"}],metadata:{generatedAt:new Date().toISOString(),periods:m.length,currency:"VND",aiAnalysis:!1}};w(z)}catch(y){console.error("Error loading financial report (fallback failed):",y);const m=y?.response?.data?.message||y?.message||"L·ªói khi t·∫£i b√°o c√°o t√†i ch√≠nh";T(m)}}finally{k(!1)}},o=r=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r),N=r=>{switch(r){case"strength":return e.jsx(pe,{sx:{color:"#4CAF50"}});case"opportunity":return e.jsx(je,{sx:{color:"#FF9800"}});case"risk":return e.jsx(ue,{sx:{color:"#f44336"}});case"warning":return e.jsx(me,{sx:{color:"#FF5722"}});default:return e.jsx(de,{})}},q=r=>{switch(r){case"strength":return"#E8F5E8";case"opportunity":return"#FFF3E0";case"risk":return"#FFEBEE";case"warning":return"#FFF3E0";default:return"#F5F5F5"}};return W?e.jsx(b,{maxWidth:"xl",sx:{py:4},children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:8},children:[e.jsx(V,{size:60,sx:{mb:2}}),e.jsx(n,{variant:"h6",color:"text.secondary",children:"AI ƒëang ph√¢n t√≠ch d·ªØ li·ªáu t√†i ch√≠nh..."}),e.jsx(H,{sx:{width:"300px",mt:2}})]})}):D?e.jsxs(b,{maxWidth:"xl",sx:{py:4},children:[e.jsx(A,{severity:"error",sx:{mb:3},children:D}),e.jsx(I,{variant:"contained",onClick:g,startIcon:e.jsx(E,{}),children:"Th·ª≠ l·∫°i"})]}):s?e.jsxs(b,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(p,{sx:{bgcolor:"primary.main",mr:2,width:56,height:56},children:e.jsx(ae,{fontSize:"large"})}),e.jsxs(a,{children:[e.jsx(n,{variant:"h4",component:"h1",children:"B√°o c√°o T√†i ch√≠nh Th√¥ng minh"}),e.jsxs(n,{variant:"subtitle1",color:"text.secondary",children:["Ph√¢n t√≠ch AI ‚Ä¢ ",s.summary.period," ‚Ä¢ ",s.metadata.periods," k·ª≥"]})]})]}),e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(X,{title:"L√†m m·ªõi d·ªØ li·ªáu",children:e.jsx(Y,{onClick:g,children:e.jsx(E,{})})}),e.jsx(I,{variant:"outlined",startIcon:e.jsx(te,{}),children:"Xu·∫•t b√°o c√°o"})]})]}),e.jsxs(G,{sx:{p:3,mb:4},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"C·∫•u h√¨nh b√°o c√°o"}),e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,md:4,children:e.jsxs(B,{fullWidth:!0,children:[e.jsx(L,{children:"Chu k·ª≥"}),e.jsxs(M,{value:h,onChange:r=>K(r.target.value),label:"Chu k·ª≥",children:[e.jsx(u,{value:"weekly",children:"H√†ng tu·∫ßn"}),e.jsx(u,{value:"monthly",children:"H√†ng th√°ng"}),e.jsx(u,{value:"quarterly",children:"H√†ng qu√Ω"})]})]})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsxs(B,{fullWidth:!0,children:[e.jsx(L,{children:"So s√°nh"}),e.jsxs(M,{value:F,onChange:r=>$(r.target.value),label:"So s√°nh",children:[e.jsx(u,{value:"previous",children:"K·ª≥ tr∆∞·ªõc"}),e.jsx(u,{value:"year",children:"C√πng k·ª≥ nƒÉm tr∆∞·ªõc"}),e.jsx(u,{value:"budget",children:"So v·ªõi ng√¢n s√°ch"})]})]})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(I,{fullWidth:!0,variant:"contained",onClick:g,sx:{height:"56px"},children:"C·∫≠p nh·∫≠t b√°o c√°o"})})]})]}),e.jsxs(t,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{children:e.jsx(d,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(p,{sx:{bgcolor:"#4CAF50",mr:2},children:e.jsx(ie,{})}),e.jsxs(a,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Doanh thu hi·ªán t·∫°i"}),e.jsx(n,{variant:"h6",children:o(s.summary.currentRevenue)})]})]})})})}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{children:e.jsxs(d,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(p,{sx:{bgcolor:s.summary.currentProfit>0?"#4CAF50":"#f44336",mr:2},children:s.summary.currentProfit>0?e.jsx(ce,{}):e.jsx(le,{})}),e.jsxs(a,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"L·ª£i nhu·∫≠n"}),e.jsx(n,{variant:"h6",children:o(s.summary.currentProfit)})]})]}),e.jsx(v,{label:`${s.summary.profitMargin.toFixed(1)}% margin`,color:s.summary.profitMargin>20?"success":s.summary.profitMargin>10?"warning":"error",size:"small"})]})})}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{children:e.jsxs(d,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(p,{sx:{bgcolor:"#2196F3",mr:2},children:e.jsx(oe,{})}),e.jsxs(a,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Cash Flow"}),e.jsx(n,{variant:"h6",children:o(s.summary.cashFlow)})]})]}),e.jsx(n,{variant:"body2",color:s.summary.cashFlow>0?"success.main":"error.main",children:s.summary.cashFlow>0?"D∆∞∆°ng":"√Çm"})]})})}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{children:e.jsx(d,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(p,{sx:{bgcolor:"#FF9800",mr:2},children:e.jsx(he,{})}),e.jsxs(a,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"T·ª∑ l·ªá chi ph√≠"}),e.jsxs(n,{variant:"h6",children:[((s.summary.currentRevenue-s.summary.currentProfit)/s.summary.currentRevenue*100).toFixed(1),"%"]})]})]})})})})]}),e.jsxs(t,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(t,{item:!0,xs:12,lg:8,children:e.jsx(x,{children:e.jsxs(d,{children:[e.jsxs(n,{variant:"h6",gutterBottom:!0,children:["Xu h∆∞·ªõng t√†i ch√≠nh theo ",h==="monthly"?"th√°ng":h==="quarterly"?"qu√Ω":"tu·∫ßn"]}),e.jsx(ge,{width:"100%",height:400,children:e.jsxs(ye,{data:s.periodData,children:[e.jsx(fe,{strokeDasharray:"3 3"}),e.jsx(be,{dataKey:"period"}),e.jsx(ve,{}),e.jsx(Fe,{formatter:(r,l)=>[o(Number(r)),l==="revenue"?"Doanh thu":l==="expenses"?"Chi ph√≠":l==="profit"?"L·ª£i nhu·∫≠n":"Cash Flow"]}),e.jsx(P,{dataKey:"revenue",fill:"#8884d8",name:"revenue"}),e.jsx(P,{dataKey:"expenses",fill:"#82ca9d",name:"expenses"}),e.jsx(R,{type:"monotone",dataKey:"profit",stroke:"#ff7300",strokeWidth:3,name:"profit"}),e.jsx(R,{type:"monotone",dataKey:"cashFlow",stroke:"#ff0000",strokeWidth:2,strokeDasharray:"5 5",name:"cashFlow"})]})})]})})}),e.jsx(t,{item:!0,xs:12,lg:4,children:e.jsx(x,{sx:{height:"100%"},children:e.jsxs(d,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"AI Financial Insights"}),e.jsx(O,{dense:!0,children:s.insights.map((r,l)=>e.jsxs(ne.Fragment,{children:[e.jsxs(Z,{sx:{bgcolor:q(r.type),borderRadius:1,mb:1},children:[e.jsx(J,{children:N(r.type)}),e.jsx(Q,{primary:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{variant:"subtitle2",children:r.title}),e.jsx(v,{label:`${Math.round(r.confidence*100)}%`,size:"small",color:"primary"})]}),secondary:e.jsxs(a,{children:[e.jsx(n,{variant:"body2",sx:{mb:1},children:r.description}),e.jsxs(n,{variant:"caption",color:"primary",children:["üí° ",r.recommendation]})]})})]}),l<s.insights.length-1&&e.jsx(U,{})]},l))})]})})})]}),e.jsx(x,{sx:{mb:4},children:e.jsxs(d,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Ch·ªâ s·ªë t√†i ch√≠nh chi ti·∫øt"}),e.jsx(_,{children:e.jsxs(ee,{children:[e.jsx(re,{children:e.jsxs(S,{children:[e.jsx(i,{children:"K·ª≥"}),e.jsx(i,{align:"right",children:"Doanh thu"}),e.jsx(i,{align:"right",children:"Chi ph√≠"}),e.jsx(i,{align:"right",children:"L·ª£i nhu·∫≠n"}),e.jsx(i,{align:"right",children:"Margin (%)"}),e.jsx(i,{align:"right",children:"Cash Flow"})]})}),e.jsx(se,{children:s.periodData.slice(-5).map((r,l)=>e.jsxs(S,{children:[e.jsx(i,{component:"th",scope:"row",children:r.period}),e.jsx(i,{align:"right",children:o(r.revenue)}),e.jsx(i,{align:"right",children:o(r.expenses)}),e.jsx(i,{align:"right",sx:{color:r.profit>0?"success.main":"error.main"},children:o(r.profit)}),e.jsx(i,{align:"right",children:e.jsx(v,{label:`${r.profitMargin.toFixed(1)}%`,color:r.profitMargin>20?"success":r.profitMargin>10?"warning":"error",size:"small"})}),e.jsx(i,{align:"right",sx:{color:r.cashFlow>0?"success.main":"error.main"},children:o(r.cashFlow)})]},l))})]})})]})}),e.jsx(a,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(v,{icon:e.jsx(xe,{}),label:`Ph√¢n t√≠ch t√†i ch√≠nh b·ªüi AI ‚Ä¢ C·∫≠p nh·∫≠t: ${new Date(s.metadata.generatedAt).toLocaleString("vi-VN")}`,variant:"outlined",color:"primary"})})]}):e.jsx(b,{maxWidth:"xl",sx:{py:4},children:e.jsx(A,{severity:"info",children:"Kh√¥ng c√≥ d·ªØ li·ªáu b√°o c√°o t√†i ch√≠nh"})})};export{Le as default};
