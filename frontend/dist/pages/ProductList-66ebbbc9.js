import{j as e,af as Z,W as p,aj as n,T as f,t as v,P as N,E as V,A as J,ak as b,al as R,am as W,ab as c,V as l,C as T,I as x,Y as ee,Z as se,ap as te,aq as ne,ar as ae,as as j,at as t,au as ie,av as a,aw as le,ax as re,D as ce,ay as oe,o as he,az as de,v as xe}from"../chunks/mui-core-cd9e8750.js";import{r as i,b as je,L as y}from"../chunks/react-vendor-9ee90314.js";import{u as B,a as me}from"../chunks/useApiData-60d9f817.js";import{f as ue}from"../assets/index-fad1ea34.js";import{T as ge,e as pe,W as E,t as fe,U as ve,X as be,a as Te,Y as ye,Z as Ce,_ as Ie}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/utils-vendor-8faa4a85.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/ui-vendor-11834b8a.js";const We=()=>{const[m,C]=i.useState(""),[I,S]=i.useState(""),[u,k]=i.useState(""),[o,P]=i.useState(""),[h,D]=i.useState(!1),[H,d]=i.useState(!1),[w,_]=i.useState(null);je.useEffect(()=>{const s=setTimeout(()=>{S(m)},500);return()=>clearTimeout(s)},[m]);const{data:$=[]}=B("/categories",{limit:100,is_active:!0}),X=i.useMemo(()=>({search:I,category_id:u||void 0,is_active:o===""?void 0:o,low_stock:h||void 0,sortBy:"name",sortDirection:"asc"}),[I,u,o,h]),{data:z,pagination:F,isLoading:K,refetch:L,handlePageChange:U,handleLimitChange:M,page:O,limit:A}=B("/products",X),{deleteItem:g,loading:Se,error:ke}=me(),Q=s=>{_(s),d(!0)},q=async()=>{w&&await g(`/products/${w}`)&&(L(),d(!1))},G=()=>{C(""),S(""),k(""),P(""),D(!1)};return e.jsxs(Z,{maxWidth:"lg",children:[e.jsxs(p,{sx:{py:3},children:[e.jsxs(n,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[e.jsx(n,{item:!0,children:e.jsx(f,{variant:"h4",gutterBottom:!0,children:"Danh sách sản phẩm"})}),e.jsx(n,{item:!0,children:e.jsx(v,{variant:"contained",color:"primary",startIcon:e.jsx(ge,{}),component:y,to:"/products/new",children:"Thêm sản phẩm"})})]}),e.jsx(N,{sx:{p:2,mb:3},children:e.jsxs(n,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsx(V,{fullWidth:!0,label:"Tìm kiếm",variant:"outlined",size:"small",value:m,onChange:s=>C(s.target.value),InputProps:{startAdornment:e.jsx(J,{position:"start",children:e.jsx(pe,{fontSize:"small"})})}})}),e.jsx(n,{item:!0,xs:12,sm:3,children:e.jsxs(b,{fullWidth:!0,size:"small",variant:"outlined",children:[e.jsx(R,{id:"category-filter-label",children:"Danh mục"}),e.jsxs(W,{labelId:"category-filter-label",value:u,onChange:s=>k(s.target.value),label:"Danh mục",children:[e.jsx(c,{value:"",children:"Tất cả"}),$.map(s=>e.jsx(c,{value:s.id,children:s.name},s.id))]})]})}),e.jsx(n,{item:!0,xs:12,sm:2,children:e.jsxs(b,{fullWidth:!0,size:"small",variant:"outlined",children:[e.jsx(R,{id:"status-filter-label",children:"Trạng thái"}),e.jsxs(W,{labelId:"status-filter-label",value:o,onChange:s=>P(s.target.value),label:"Trạng thái",children:[e.jsx(c,{value:"",children:"Tất cả"}),e.jsx(c,{value:!0,children:"Hoạt động"}),e.jsx(c,{value:!1,children:"Không hoạt động"})]})]})}),e.jsx(n,{item:!0,xs:12,sm:1,children:e.jsx(b,{fullWidth:!0,children:e.jsx(l,{title:"Chỉ hiển thị hàng tồn kho thấp",children:e.jsx(T,{icon:e.jsx(E,{}),label:"Tồn thấp",clickable:!0,color:h?"warning":"default",onClick:()=>D(!h)})})})}),e.jsx(n,{item:!0,xs:12,sm:2,children:e.jsxs(n,{container:!0,spacing:1,children:[e.jsx(n,{item:!0,children:e.jsx(l,{title:"Làm mới",children:e.jsx(x,{onClick:()=>L(),children:e.jsx(fe,{})})})}),e.jsx(n,{item:!0,children:e.jsx(l,{title:"Xóa bộ lọc",children:e.jsx(x,{onClick:G,children:e.jsx(ve,{})})})})]})})]})}),e.jsx(ee,{children:e.jsxs(se,{sx:{p:0},children:[e.jsx(te,{children:e.jsxs(ne,{children:[e.jsx(ae,{children:e.jsxs(j,{children:[e.jsx(t,{children:"Hình ảnh"}),e.jsx(t,{children:"Tên sản phẩm"}),e.jsx(t,{children:"SKU"}),e.jsx(t,{children:"Danh mục"}),e.jsx(t,{children:"Giá bán"}),e.jsx(t,{children:"Tồn kho"}),e.jsx(t,{children:"Trạng thái"}),e.jsx(t,{align:"center",children:"Thao tác"})]})}),e.jsx(ie,{children:K?Array.from(Array(A)).map((s,r)=>e.jsxs(j,{children:[e.jsx(t,{children:e.jsx(a,{variant:"rectangular",width:40,height:40})}),e.jsx(t,{children:e.jsx(a,{variant:"text"})}),e.jsx(t,{children:e.jsx(a,{variant:"text"})}),e.jsx(t,{children:e.jsx(a,{variant:"text"})}),e.jsx(t,{children:e.jsx(a,{variant:"text"})}),e.jsx(t,{children:e.jsx(a,{variant:"text"})}),e.jsx(t,{children:e.jsx(a,{variant:"circular",width:80,height:24})}),e.jsx(t,{children:e.jsx(a,{variant:"rectangular",width:80,height:32})})]},r)):z.length===0?e.jsx(j,{children:e.jsx(t,{colSpan:8,align:"center",children:e.jsx(f,{variant:"body2",sx:{py:2},children:"Không tìm thấy sản phẩm nào"})})}):z.map(s=>e.jsxs(j,{hover:!0,children:[e.jsx(t,{children:s.imageUrl?e.jsx(p,{component:"img",src:s.imageUrl,alt:s.name,sx:{width:40,height:40,objectFit:"cover",borderRadius:1}}):e.jsx(be,{color:"disabled"})}),e.jsx(t,{children:e.jsx(le,{component:y,to:`/products/${s.id}`,underline:"hover",children:s.name})}),e.jsx(t,{children:s.sku}),e.jsx(t,{children:s.categoryName}),e.jsx(t,{children:ue(s.price)}),e.jsx(t,{children:e.jsxs(p,{display:"flex",alignItems:"center",children:[e.jsx(f,{variant:"body2",children:s.stockQuantity}),s.stockQuantity<=s.stockAlertThreshold&&e.jsx(l,{title:"Tồn kho thấp",children:e.jsx(E,{fontSize:"small",color:"warning",sx:{ml:1}})})]})}),e.jsx(t,{children:s.isActive?e.jsx(T,{size:"small",icon:e.jsx(Te,{fontSize:"small"}),label:"Hoạt động",color:"success"}):e.jsx(T,{size:"small",icon:e.jsx(ye,{fontSize:"small"}),label:"Không hoạt động",color:"default"})}),e.jsxs(t,{align:"center",children:[e.jsx(l,{title:"Sửa",children:e.jsx(x,{component:y,to:`/products/${s.id}/edit`,size:"small",color:"primary",children:e.jsx(Ce,{fontSize:"small"})})}),e.jsx(l,{title:"Xóa",children:e.jsx(x,{size:"small",color:"error",onClick:()=>Q(s.id),children:e.jsx(Ie,{fontSize:"small"})})})]})]},s.id))})]})}),F&&e.jsx(re,{component:"div",count:F.total,page:O-1,rowsPerPage:A,onPageChange:(s,r)=>U(r+1),onRowsPerPageChange:s=>M(parseInt(s.target.value,10)),labelRowsPerPage:"Hiển thị:",labelDisplayedRows:({from:s,to:r,count:Y})=>`${s}-${r} của ${Y}`,rowsPerPageOptions:[10,25,50,100]})]})})]}),e.jsxs(ce,{open:H,onClose:()=>d(!1),children:[e.jsx(oe,{children:"Xác nhận xóa"}),e.jsx(he,{children:e.jsx(de,{children:"Bạn có chắc chắn muốn xóa sản phẩm này không? Hành động này không thể hoàn tác."})}),e.jsxs(xe,{children:[e.jsx(v,{onClick:()=>d(!1),children:"Hủy"}),e.jsx(v,{onClick:q,color:"error",variant:"contained",disabled:g.isPending,children:g.isPending?"Đang xử lý...":"Xóa"})]})]})]})};export{We as default};
