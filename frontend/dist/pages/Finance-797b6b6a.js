import{e as ce,p as le,j as e,W as a,ad as oe,af as he,P as de,$ as R,T as n,t as x,aj as c,Y as l,Z as o,aK as xe,aL as b,E as me,ak as je,al as ue,am as ge,ab as C,ap as pe,aq as ye,ar as fe,as as T,at as t,au as be,C as Ce,ax as Te,D as ve,ay as Se,o as Pe,v as we}from"../chunks/mui-core-cd9e8750.js";import{r as i}from"../chunks/react-vendor-9ee90314.js";import{a as Ie}from"../chunks/ui-vendor-11834b8a.js";import{a as F}from"../assets/index-fad1ea34.js";import{a7 as K,t as Be,ar as De,T as Le,y as ke,at as Re,x as Fe,e as Ke}from"../chunks/mui-icons-f0327ae6.js";import{R as v,L as Ee,b as E,X as z,Y as A,T as S,c as W,P as ze,a as Ae,C as We,e as Me,B as M}from"../chunks/chart-vendor-c17345c1.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/utils-vendor-8faa4a85.js";const Ye=()=>{const N=ce(),u=le(N.breakpoints.down("md")),{enqueueSnackbar:O}=Ie(),[V,H]=i.useState([]),[$,P]=i.useState(!0),[g,w]=i.useState(0),[m,q]=i.useState(10),[j,G]=i.useState(0),[p,X]=i.useState(""),[y,Y]=i.useState("all");i.useState(null),i.useState(null);const[Q,I]=i.useState(!1),[_,Z]=i.useState("income"),[h,J]=i.useState({totalIncome:0,totalExpense:0,netProfit:0,balance:0}),B=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D"];i.useEffect(()=>{D()},[]);const D=async()=>{try{P(!0);const s=await F.get("/financial/summary");s.success&&J(s.data);const r=await F.get("/financial/transactions?limit=50");r.success&&H(r.data.transactions||[])}catch(s){console.error("Error fetching financial data:",s),O("Lỗi khi tải dữ liệu tài chính",{variant:"error"})}finally{P(!1)}},U=(s,r)=>{w(r)},ee=s=>{q(parseInt(s.target.value,10)),w(0)},se=(s,r)=>{G(r)},ne=s=>{X(s.target.value)},ae=s=>{Y(s.target.value)},te=s=>{Z(s),I(!0)},f=()=>{I(!1)},d=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s),re=s=>new Date(s).toLocaleDateString("vi-VN"),L=V.filter(s=>{const r=s.description.toLowerCase().includes(p.toLowerCase())||s.reference?.toLowerCase().includes(p.toLowerCase()),ie=y==="all"||s.type===y;return r&&ie}),k=L.slice(g*m,g*m+m);return $?e.jsx(a,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(oe,{})}):e.jsxs(he,{maxWidth:"xl",sx:{py:{xs:1,sm:2},px:{xs:1,sm:2,md:3},minHeight:"100vh",bgcolor:"grey.50"},children:[e.jsx(de,{elevation:1,sx:{p:{xs:2,sm:3},mb:3,borderRadius:2,bgcolor:"white"},children:e.jsxs(R,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},spacing:2,children:[e.jsxs(a,{children:[e.jsxs(n,{variant:"h4",sx:{display:"flex",alignItems:"center",gap:1,fontSize:{xs:"1.5rem",sm:"2rem",md:"2.125rem"},fontWeight:600,color:"primary.main",mb:1},children:[e.jsx(K,{sx:{fontSize:"inherit"}}),"Quản lý tài chính"]}),e.jsx(n,{variant:"body1",color:"text.secondary",sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:"Theo dõi doanh thu, chi phí và báo cáo tài chính"})]}),e.jsxs(R,{direction:"row",spacing:1,children:[e.jsx(x,{variant:"outlined",startIcon:e.jsx(Be,{}),onClick:D,size:u?"small":"medium",children:"Làm mới"}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(De,{}),size:u?"small":"medium",children:"Xuất báo cáo"}),e.jsx(x,{variant:"contained",startIcon:e.jsx(Le,{}),onClick:()=>te("income"),size:u?"small":"medium",children:"Thêm giao dịch"})]})]})}),e.jsxs(c,{container:!0,spacing:3,mb:3,children:[e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l,{children:e.jsx(o,{children:e.jsxs(a,{display:"flex",alignItems:"center",children:[e.jsx(ke,{color:"success",sx:{mr:2}}),e.jsxs(a,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,children:"Tổng thu"}),e.jsx(n,{variant:"h5",children:d(h.totalIncome)})]})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l,{children:e.jsx(o,{children:e.jsxs(a,{display:"flex",alignItems:"center",children:[e.jsx(Re,{color:"error",sx:{mr:2}}),e.jsxs(a,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,children:"Tổng chi"}),e.jsx(n,{variant:"h5",children:d(h.totalExpense)})]})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l,{children:e.jsx(o,{children:e.jsxs(a,{display:"flex",alignItems:"center",children:[e.jsx(Fe,{color:"primary",sx:{mr:2}}),e.jsxs(a,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,children:"Lợi nhuận"}),e.jsx(n,{variant:"h5",color:h.netProfit>=0?"success.main":"error.main",children:d(h.netProfit)})]})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l,{children:e.jsx(o,{children:e.jsxs(a,{display:"flex",alignItems:"center",children:[e.jsx(K,{color:"info",sx:{mr:2}}),e.jsxs(a,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,children:"Số dư"}),e.jsx(n,{variant:"h5",children:d(h.balance)})]})]})})})})]}),e.jsx(a,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(xe,{value:j,onChange:se,children:[e.jsx(b,{label:"Tổng quan"}),e.jsx(b,{label:"Giao dịch"}),e.jsx(b,{label:"Báo cáo"})]})}),j===0&&e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,md:8,children:e.jsx(l,{children:e.jsxs(o,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Biểu đồ thu chi"}),e.jsx(a,{height:300,children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(Ee,{data:[],children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name"}),e.jsx(A,{}),e.jsx(S,{}),e.jsx(W,{type:"monotone",dataKey:"income",stroke:"#8884d8",name:"Thu"}),e.jsx(W,{type:"monotone",dataKey:"expense",stroke:"#82ca9d",name:"Chi"})]})})})]})})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(l,{children:e.jsxs(o,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Phân bổ chi tiêu"}),e.jsx(a,{height:300,children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(ze,{children:[e.jsx(Ae,{data:[],cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:r})=>`${s} ${(r*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[].map((s,r)=>e.jsx(We,{fill:B[r%B.length]},`cell-${r}`))}),e.jsx(S,{})]})})})]})})})]}),j===1&&e.jsx(l,{children:e.jsxs(o,{children:[e.jsxs(a,{display:"flex",gap:2,mb:3,children:[e.jsx(me,{placeholder:"Tìm kiếm giao dịch...",value:p,onChange:ne,InputProps:{startAdornment:e.jsx(Ke,{})},sx:{minWidth:300}}),e.jsxs(je,{sx:{minWidth:150},children:[e.jsx(ue,{children:"Loại giao dịch"}),e.jsxs(ge,{value:y,onChange:ae,label:"Loại giao dịch",children:[e.jsx(C,{value:"all",children:"Tất cả"}),e.jsx(C,{value:"income",children:"Thu"}),e.jsx(C,{value:"expense",children:"Chi"})]})]})]}),e.jsx(pe,{children:e.jsxs(ye,{children:[e.jsx(fe,{children:e.jsxs(T,{children:[e.jsx(t,{children:"Ngày"}),e.jsx(t,{children:"Mô tả"}),e.jsx(t,{children:"Loại"}),e.jsx(t,{children:"Số tiền"}),e.jsx(t,{children:"Danh mục"}),e.jsx(t,{children:"Phương thức"}),e.jsx(t,{children:"Tham chiếu"})]})}),e.jsx(be,{children:k.length===0?e.jsx(T,{children:e.jsx(t,{colSpan:7,align:"center",children:e.jsx(n,{variant:"body2",color:"textSecondary",children:"Không có giao dịch nào"})})}):k.map(s=>e.jsxs(T,{children:[e.jsx(t,{children:re(s.date)}),e.jsx(t,{children:s.description}),e.jsx(t,{children:e.jsx(Ce,{label:s.type==="income"?"Thu":"Chi",color:s.type==="income"?"success":"error",size:"small"})}),e.jsx(t,{children:d(s.amount)}),e.jsx(t,{children:s.category}),e.jsx(t,{children:s.method}),e.jsx(t,{children:s.reference})]},s.id))})]})}),e.jsx(Te,{rowsPerPageOptions:[5,10,25],component:"div",count:L.length,rowsPerPage:m,page:g,onPageChange:U,onRowsPerPageChange:ee,labelRowsPerPage:"Số dòng mỗi trang:"})]})}),j===2&&e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(l,{children:e.jsxs(o,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Thu chi theo tháng"}),e.jsx(a,{height:300,children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(Me,{data:[],children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name"}),e.jsx(A,{}),e.jsx(S,{}),e.jsx(M,{dataKey:"income",fill:"#8884d8",name:"Thu"}),e.jsx(M,{dataKey:"expense",fill:"#82ca9d",name:"Chi"})]})})})]})})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(l,{children:e.jsxs(o,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Thống kê chi tiết"}),e.jsx(a,{children:e.jsx(n,{variant:"body2",color:"textSecondary",children:"Báo cáo chi tiết sẽ được hiển thị ở đây"})})]})})})]}),e.jsxs(ve,{open:Q,onClose:f,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Se,{children:["Thêm giao dịch ",_==="income"?"thu":"chi"]}),e.jsx(Pe,{children:e.jsx(n,{variant:"body2",color:"textSecondary",children:"Tính năng thêm giao dịch đang được phát triển..."})}),e.jsxs(we,{children:[e.jsx(x,{onClick:f,children:"Hủy"}),e.jsx(x,{variant:"contained",onClick:f,children:"Lưu"})]})]})]})};export{Ye as default};
