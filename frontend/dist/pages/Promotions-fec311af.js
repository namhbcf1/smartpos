import{e as le,p as oe,j as e,af as de,P as T,$ as p,W as r,T as s,t as y,aj as l,Y as f,Z as v,E as xe,ak as G,al as M,am as $,ab as o,ap as he,aq as ue,ar as me,as as _,at as n,au as ge,ad as je,C as pe,V as U,I as X,ax as ye}from"../chunks/mui-core-cd9e8750.js";import{r as a}from"../chunks/react-vendor-9ee90314.js";import{a as fe}from"../chunks/ui-vendor-11834b8a.js";import{b,a as ve}from"../assets/index-fad1ea34.js";import{ad as I,t as _e,am as be,T as Se,x as we,ap as A,r as V,e as Te,U as Ie,an as Pe,w as Ce,Z as ke,aq as De,ak as We}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/utils-vendor-8faa4a85.js";const Ve=()=>{const q=le();oe(q.breakpoints.down("md"));const{enqueueSnackbar:O}=fe(),[P,Y]=a.useState([]),[C,k]=a.useState(!0),[S,h]=a.useState(0),[w,H]=a.useState(10),[K,N]=a.useState(0),[u,D]=a.useState(""),[m,W]=a.useState(""),[g,R]=a.useState(""),[Re,z]=a.useState(null),[ze,Q]=a.useState(!1),[Fe,F]=a.useState(!1),[Le,L]=a.useState(!1);a.useState(!1);const[Be,B]=a.useState({name:"",description:"",promotion_type:"percentage",discount_value:0,minimum_amount:0,maximum_discount:0,start_date:"",end_date:"",usage_limit:0,is_active:!0,applies_to:"all"}),[j,Z]=a.useState({totalPromotions:0,activePromotions:0,totalUsage:0,totalSavings:0}),E=async()=>{try{k(!0);const t=new URLSearchParams({page:(S+1).toString(),limit:w.toString()});u&&t.append("search",u),m&&t.append("status",m),g&&t.append("type",g);const i=await ve.get(`/promotions?${t.toString()}`);if(i.success){Y(i.data.data||[]),N(i.data.pagination?.total||0);const c=i.data.data||[],d=new Date;Z({totalPromotions:c.length,activePromotions:c.filter(x=>x.is_active&&new Date(x.start_date)<=d&&new Date(x.end_date)>=d).length,totalUsage:c.reduce((x,ce)=>x+ce.usage_count,0),totalSavings:0})}}catch(t){console.error("Error fetching promotions:",t),O("Lỗi khi tải danh sách khuyến mãi",{variant:"error"})}finally{k(!1)}},J=t=>{switch(t){case"percentage":return e.jsx(We,{});case"fixed_amount":return e.jsx(V,{});case"buy_x_get_y":return e.jsx(A,{});case"free_shipping":return e.jsx(De,{});default:return e.jsx(I,{})}},ee=t=>{switch(t){case"percentage":return"Giảm theo %";case"fixed_amount":return"Giảm cố định";case"buy_x_get_y":return"Mua X tặng Y";case"free_shipping":return"Miễn phí ship";default:return t}},te=t=>{const i=new Date,c=new Date(t.start_date),d=new Date(t.end_date);return t.is_active?d<i?"error":c>i?"warning":"success":"default"},se=t=>{const i=new Date,c=new Date(t.start_date),d=new Date(t.end_date);return t.is_active?d<i?"Đã hết hạn":c>i?"Sắp diễn ra":"Đang hoạt động":"Tạm dừng"};a.useEffect(()=>{E()},[S,w,u,m,g]);const ne=(t,i)=>{h(i)},ae=t=>{H(parseInt(t.target.value,10)),h(0)},ie=t=>{D(t.target.value),h(0)},re=()=>{D(""),W(""),R(""),h(0)};return e.jsxs(de,{maxWidth:"xl",sx:{py:{xs:1,sm:2},px:{xs:1,sm:2,md:3},minHeight:"100vh",bgcolor:"grey.50"},children:[e.jsx(T,{elevation:1,sx:{p:{xs:2,sm:3},mb:3,borderRadius:2,bgcolor:"white"},children:e.jsxs(p,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},spacing:2,children:[e.jsxs(r,{children:[e.jsxs(s,{variant:"h4",sx:{display:"flex",alignItems:"center",gap:1,fontSize:{xs:"1.5rem",sm:"2rem",md:"2.125rem"},fontWeight:600,color:"primary.main",mb:1},children:[e.jsx(I,{sx:{fontSize:"inherit"}}),"Khuyến mãi & Giảm giá"]}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:"Quản lý các chương trình khuyến mãi và giảm giá"})]}),e.jsxs(p,{direction:"row",spacing:1,children:[e.jsx(y,{variant:"outlined",startIcon:e.jsx(_e,{}),onClick:E,disabled:C,children:"Làm mới"}),e.jsx(y,{variant:"outlined",startIcon:e.jsx(be,{}),children:"Xuất dữ liệu"}),e.jsx(y,{variant:"contained",startIcon:e.jsx(Se,{}),onClick:()=>{L(!1),B({name:"",description:"",promotion_type:"percentage",discount_value:0,minimum_amount:0,maximum_discount:0,start_date:"",end_date:"",usage_limit:0,is_active:!0,applies_to:"all"}),F(!0)},children:"Tạo khuyến mãi"})]})]})}),e.jsxs(l,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(f,{children:e.jsx(v,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Tổng khuyến mãi"}),e.jsx(s,{variant:"h5",component:"div",children:j.totalPromotions})]}),e.jsx(I,{color:"primary",sx:{fontSize:40}})]})})})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(f,{children:e.jsx(v,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Đang hoạt động"}),e.jsx(s,{variant:"h5",component:"div",children:j.activePromotions})]}),e.jsx(we,{color:"success",sx:{fontSize:40}})]})})})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(f,{children:e.jsx(v,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Lượt sử dụng"}),e.jsx(s,{variant:"h5",component:"div",children:j.totalUsage})]}),e.jsx(A,{color:"warning",sx:{fontSize:40}})]})})})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(f,{children:e.jsx(v,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Tiết kiệm"}),e.jsx(s,{variant:"h5",component:"div",children:b(j.totalSavings)})]}),e.jsx(V,{color:"success",sx:{fontSize:40}})]})})})})]}),e.jsx(T,{elevation:1,sx:{p:{xs:2,sm:3},mb:3,borderRadius:2},children:e.jsxs(l,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(l,{item:!0,xs:12,md:4,children:e.jsx(xe,{fullWidth:!0,placeholder:"Tìm kiếm theo tên khuyến mãi...",value:u,onChange:ie,InputProps:{startAdornment:e.jsx(Te,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(l,{item:!0,xs:12,sm:6,md:2,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(M,{children:"Trạng thái"}),e.jsxs($,{value:m,label:"Trạng thái",onChange:t=>W(t.target.value),children:[e.jsx(o,{value:"",children:"Tất cả"}),e.jsx(o,{value:"active",children:"Đang hoạt động"}),e.jsx(o,{value:"inactive",children:"Tạm dừng"}),e.jsx(o,{value:"expired",children:"Đã hết hạn"}),e.jsx(o,{value:"upcoming",children:"Sắp diễn ra"})]})]})}),e.jsx(l,{item:!0,xs:12,sm:6,md:2,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(M,{children:"Loại khuyến mãi"}),e.jsxs($,{value:g,label:"Loại khuyến mãi",onChange:t=>R(t.target.value),children:[e.jsx(o,{value:"",children:"Tất cả"}),e.jsx(o,{value:"percentage",children:"Giảm theo %"}),e.jsx(o,{value:"fixed_amount",children:"Giảm cố định"}),e.jsx(o,{value:"buy_x_get_y",children:"Mua X tặng Y"}),e.jsx(o,{value:"free_shipping",children:"Miễn phí ship"})]})]})}),e.jsx(l,{item:!0,xs:12,md:4,children:e.jsx(p,{direction:"row",spacing:1,children:e.jsx(y,{variant:"outlined",startIcon:e.jsx(Ie,{}),onClick:re,children:"Xóa bộ lọc"})})})]})}),e.jsxs(T,{elevation:1,sx:{borderRadius:2,overflow:"hidden"},children:[e.jsx(he,{children:e.jsxs(ue,{children:[e.jsx(me,{children:e.jsxs(_,{sx:{bgcolor:"grey.50"},children:[e.jsx(n,{sx:{fontWeight:600},children:"Tên khuyến mãi"}),e.jsx(n,{sx:{fontWeight:600},children:"Loại"}),e.jsx(n,{sx:{fontWeight:600},children:"Giá trị"}),e.jsx(n,{sx:{fontWeight:600},children:"Điều kiện"}),e.jsx(n,{sx:{fontWeight:600},children:"Thời gian"}),e.jsx(n,{sx:{fontWeight:600},children:"Sử dụng"}),e.jsx(n,{sx:{fontWeight:600},children:"Trạng thái"}),e.jsx(n,{sx:{fontWeight:600},children:"Thao tác"})]})}),e.jsx(ge,{children:C?e.jsx(_,{children:e.jsx(n,{colSpan:8,sx:{textAlign:"center",py:4},children:e.jsx(je,{})})}):P.length===0?e.jsx(_,{children:e.jsx(n,{colSpan:8,sx:{textAlign:"center",py:4},children:e.jsx(s,{color:"text.secondary",children:"Không tìm thấy khuyến mãi nào"})})}):P.map(t=>e.jsxs(_,{hover:!0,children:[e.jsx(n,{children:e.jsxs(r,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:600},children:t.name}),t.description&&e.jsx(s,{variant:"caption",color:"text.secondary",children:t.description})]})}),e.jsx(n,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[J(t.promotion_type),e.jsx(s,{variant:"body2",children:ee(t.promotion_type)})]})}),e.jsx(n,{children:t.promotion_type==="percentage"?e.jsxs(s,{variant:"body2",sx:{fontWeight:600},children:[t.discount_value,"%"]}):t.promotion_type==="fixed_amount"?e.jsx(s,{variant:"body2",sx:{fontWeight:600},children:b(t.discount_value)}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"Theo điều kiện"})}),e.jsxs(n,{children:[e.jsxs(s,{variant:"body2",children:["Tối thiểu: ",b(t.minimum_amount)]}),t.maximum_discount>0&&e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Tối đa: ",b(t.maximum_discount)]})]}),e.jsx(n,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pe,{sx:{fontSize:16,color:"text.secondary"}}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",children:new Date(t.start_date).toLocaleDateString("vi-VN")}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["đến ",new Date(t.end_date).toLocaleDateString("vi-VN")]})]})]})}),e.jsx(n,{children:e.jsxs(s,{variant:"body2",children:[t.usage_count,t.usage_limit>0&&` / ${t.usage_limit}`]})}),e.jsx(n,{children:e.jsx(pe,{label:se(t),size:"small",color:te(t)})}),e.jsx(n,{children:e.jsxs(p,{direction:"row",spacing:1,children:[e.jsx(U,{title:"Xem chi tiết",children:e.jsx(X,{size:"small",onClick:()=>{z(t),Q(!0)},children:e.jsx(Ce,{})})}),e.jsx(U,{title:"Chỉnh sửa",children:e.jsx(X,{size:"small",onClick:()=>{z(t),L(!0),B({name:t.name,description:t.description||"",promotion_type:t.promotion_type,discount_value:t.discount_value,minimum_amount:t.minimum_amount,maximum_discount:t.maximum_discount,start_date:t.start_date.split("T")[0],end_date:t.end_date.split("T")[0],usage_limit:t.usage_limit,is_active:!!t.is_active,applies_to:t.applies_to}),F(!0)},children:e.jsx(ke,{})})})]})})]},t.id))})]})}),e.jsx(ye,{component:"div",count:K,page:S,onPageChange:ne,rowsPerPage:w,onRowsPerPageChange:ae,labelRowsPerPage:"Số hàng mỗi trang:",labelDisplayedRows:({from:t,to:i,count:c})=>`${t}-${i} của ${c!==-1?c:`hơn ${i}`}`})]})]})};export{Ve as default};
