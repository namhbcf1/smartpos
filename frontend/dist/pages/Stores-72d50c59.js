import{e as K,p as Q,j as e,af as G,P as C,$ as o,W as c,T as t,t as S,aj as a,Y as y,Z as f,C as J,V as I,X as Y,a8 as Z,a3 as q,aO as U,I as _,aM as ee,D as se,ay as te,o as ne,E as T,aC as ae,aD as re,v as ie,aT as oe,ae as ce}from"../chunks/mui-core-cd9e8750.js";import{r as x}from"../chunks/react-vendor-9ee90314.js";import{d as le}from"../chunks/useApiData-60d9f817.js";import{a4 as D,T as B,B as L,x as de,y as he,P as xe,W as ge,aB as F,ao as $,aj as M,w as me,Z as ue,_ as je,D as pe}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/utils-vendor-8faa4a85.js";import"../assets/index-fad1ea34.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/ui-vendor-11834b8a.js";const _e=()=>{const z=K(),O=Q(z.breakpoints.down("md")),[m,p]=x.useState([]),[u,A]=x.useState(null),[H,E]=x.useState(!1),[r,N]=x.useState("create"),[i,j]=x.useState({name:"",address:"",phone:"",email:"",is_active:!0}),[b,h]=x.useState({open:!1,message:"",severity:"success"}),[be,l]=x.useState(!0),[ye,R]=x.useState(null),{data:g,loading:fe,error:P}=le("/stores/simple");x.useEffect(()=>{(async()=>{try{l(!0);const n=await fetch("/api/v1/stores/simple");if(n.ok){const d=await n.json();d.success&&d.data&&p(d.data.data||[])}else g&&g.data&&p(g.data);l(!1)}catch(n){console.error("Error fetching stores:",n),R("Không thể tải dữ liệu cửa hàng"),l(!1)}})()},[g]),x.useEffect(()=>{g&&g.data&&(p(g.data),l(!1)),P&&(R("Không thể tải dữ liệu cửa hàng"),l(!1))},[g,P]);const V=async()=>{try{if(l(!0),r==="create"){const s=await fetch("/api/v1/stores",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(i)});if(s.ok){if((await s.json()).success){const d=await fetch("/api/v1/stores/simple");if(d.ok){const k=await d.json();k.success&&p(k.data.data||[])}h({open:!0,message:"Tạo cửa hàng thành công!",severity:"success"})}}else h({open:!0,message:"Lỗi khi tạo cửa hàng",severity:"error"})}else if(r==="edit"&&u){const s=await fetch(`/api/v1/stores/${u.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(i)});s.ok?(await s.json()).success&&(p(m.map(d=>d.id===u.id?{...d,...i}:d)),h({open:!0,message:"Cập nhật cửa hàng thành công!",severity:"success"})):h({open:!0,message:"Lỗi khi cập nhật cửa hàng",severity:"error"})}l(!1),W()}catch(s){console.error("Error submitting form:",s),h({open:!0,message:"Lỗi kết nối",severity:"error"}),l(!1)}},v=(s,n)=>{N(s),A(n||null),j(n?{name:n.name,address:n.address,phone:n.phone,email:n.email,is_active:n.is_active}:{name:"",address:"",phone:"",email:"",is_active:!0}),E(!0)},W=()=>{E(!1),A(null)},X=async s=>{try{l(!0);const n=await fetch(`/api/v1/stores/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});n.ok?(await n.json()).success&&(p(m.filter(k=>k.id!==s)),h({open:!0,message:"Xóa cửa hàng thành công!",severity:"success"})):h({open:!0,message:"Lỗi khi xóa cửa hàng",severity:"error"}),l(!1)}catch(n){console.error("Error deleting store:",n),h({open:!0,message:"Lỗi kết nối",severity:"error"}),l(!1)}},w=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s);return e.jsxs(G,{maxWidth:"xl",sx:{py:{xs:1,sm:2},px:{xs:1,sm:2,md:3},minHeight:"100vh",bgcolor:"grey.50"},children:[e.jsx(C,{elevation:1,sx:{p:{xs:2,sm:3},mb:3,borderRadius:2,bgcolor:"white",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:e.jsxs(o,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},spacing:2,children:[e.jsxs(c,{children:[e.jsxs(t,{variant:"h4",sx:{display:"flex",alignItems:"center",gap:1,fontSize:{xs:"1.5rem",sm:"2rem",md:"2.125rem"},fontWeight:600,mb:1},children:[e.jsx(D,{sx:{fontSize:"inherit"}}),"Quản lý cửa hàng"]}),e.jsx(t,{variant:"body1",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},opacity:.9},children:"Hệ thống quản lý cửa hàng thông minh với analytics và báo cáo chi tiết"})]}),e.jsx(S,{variant:"contained",startIcon:e.jsx(B,{}),onClick:()=>v("create"),sx:{bgcolor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)","&:hover":{bgcolor:"rgba(255,255,255,0.3)"}},children:"Thêm cửa hàng"})]})}),e.jsxs(a,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(y,{sx:{borderRadius:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:e.jsx(f,{children:e.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(c,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:m.length}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Tổng cửa hàng"})]}),e.jsx(L,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(y,{sx:{borderRadius:2,background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white"},children:e.jsx(f,{children:e.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(c,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:m.filter(s=>s.is_active).length}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Đang hoạt động"})]}),e.jsx(de,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(y,{sx:{borderRadius:2,background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white"},children:e.jsx(f,{children:e.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(c,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:w(m.reduce((s,n)=>s+(n.analytics?.sales.total_revenue||0),0))}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Tổng doanh thu"})]}),e.jsx(he,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(y,{sx:{borderRadius:2,background:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",color:"white"},children:e.jsx(f,{children:e.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(c,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:m.reduce((s,n)=>s+(n.analytics?.customers.total_customers||0),0)}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Tổng khách hàng"})]}),e.jsx(xe,{sx:{fontSize:40,opacity:.8}})]})})})})]}),e.jsx(a,{container:!0,spacing:3,children:m.map(s=>e.jsx(a,{item:!0,xs:12,md:6,lg:4,children:e.jsxs(y,{sx:{borderRadius:3,overflow:"hidden",transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:z.shadows[8]},border:"1px solid",borderColor:"divider"},children:[e.jsx(c,{sx:{background:s.is_active?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%)",color:"white",p:2},children:e.jsxs(o,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(c,{sx:{flex:1},children:[e.jsx(t,{variant:"h6",fontWeight:"bold",noWrap:!0,children:s.name}),e.jsxs(o,{direction:"row",alignItems:"center",spacing:1,sx:{mt:.5},children:[e.jsx(J,{label:s.is_active?"Hoạt động":"Tạm dừng",size:"small",sx:{bgcolor:s.is_active?"rgba(76, 175, 80, 0.8)":"rgba(244, 67, 54, 0.8)",color:"white",fontWeight:"bold"}}),s.analytics&&s.analytics.inventory.low_stock_items>0&&e.jsx(I,{title:`${s.analytics.inventory.low_stock_items} sản phẩm sắp hết hàng`,children:e.jsx(Y,{badgeContent:s.analytics.inventory.low_stock_items,color:"error",children:e.jsx(ge,{sx:{fontSize:20}})})})]})]}),e.jsx(Z,{sx:{bgcolor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},children:e.jsx(D,{})})]})}),e.jsxs(f,{sx:{p:2},children:[e.jsxs(o,{spacing:1.5,sx:{mb:2},children:[e.jsxs(o,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(F,{sx:{fontSize:18,color:"text.secondary"}}),e.jsx(t,{variant:"body2",color:"text.secondary",noWrap:!0,children:s.address})]}),e.jsxs(o,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx($,{sx:{fontSize:18,color:"text.secondary"}}),e.jsx(t,{variant:"body2",color:"text.secondary",children:s.phone})]}),e.jsxs(o,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(M,{sx:{fontSize:18,color:"text.secondary"}}),e.jsx(t,{variant:"body2",color:"text.secondary",noWrap:!0,children:s.email})]})]}),e.jsx(q,{sx:{my:2}}),s.analytics&&e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",fontWeight:"bold",sx:{mb:1.5,color:"primary.main"},children:"📊 Thống kê (30 ngày)"}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:6,children:e.jsxs(c,{sx:{textAlign:"center",p:1,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(t,{variant:"h6",fontWeight:"bold",color:"primary.main",children:s.analytics.sales.total_sales}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"Đơn hàng"})]})}),e.jsx(a,{item:!0,xs:6,children:e.jsxs(c,{sx:{textAlign:"center",p:1,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(t,{variant:"h6",fontWeight:"bold",color:"success.main",children:w(s.analytics.sales.total_revenue)}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"Doanh thu"})]})}),e.jsx(a,{item:!0,xs:6,children:e.jsxs(c,{sx:{textAlign:"center",p:1,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(t,{variant:"h6",fontWeight:"bold",color:"info.main",children:s.analytics.inventory.total_products}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"Sản phẩm"})]})}),e.jsx(a,{item:!0,xs:6,children:e.jsxs(c,{sx:{textAlign:"center",p:1,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(t,{variant:"h6",fontWeight:"bold",color:"warning.main",children:s.analytics.customers.total_customers}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"Khách hàng"})]})})]})]})]}),e.jsxs(U,{sx:{p:2,pt:0,justifyContent:"space-between"},children:[e.jsxs(o,{direction:"row",spacing:1,children:[e.jsx(I,{title:"Xem chi tiết",children:e.jsx(_,{size:"small",onClick:()=>v("view",s),sx:{color:"primary.main"},children:e.jsx(me,{})})}),e.jsx(I,{title:"Chỉnh sửa",children:e.jsx(_,{size:"small",onClick:()=>v("edit",s),sx:{color:"warning.main"},children:e.jsx(ue,{})})}),e.jsx(I,{title:"Xóa",children:e.jsx(_,{size:"small",onClick:()=>X(s.id),sx:{color:"error.main"},children:e.jsx(je,{})})})]}),e.jsx(S,{variant:"outlined",size:"small",startIcon:e.jsx(pe,{}),sx:{borderRadius:2},children:"Dashboard"})]})]})},s.id))}),O&&e.jsx(ee,{color:"primary",sx:{position:"fixed",bottom:16,right:16,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},onClick:()=>v("create"),children:e.jsx(B,{})}),e.jsxs(se,{open:H,onClose:W,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3}},children:[e.jsxs(te,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",display:"flex",alignItems:"center",gap:1},children:[e.jsx(D,{}),r==="create"&&"Thêm cửa hàng mới",r==="edit"&&"Chỉnh sửa cửa hàng",r==="view"&&"Thông tin cửa hàng"]}),e.jsx(ne,{sx:{p:3},children:e.jsxs(o,{spacing:3,sx:{mt:1},children:[e.jsx(T,{fullWidth:!0,label:"Tên cửa hàng",value:i.name,onChange:s=>j({...i,name:s.target.value}),disabled:r==="view",variant:"outlined",InputProps:{startAdornment:e.jsx(L,{sx:{mr:1,color:"text.secondary"}})}}),e.jsx(T,{fullWidth:!0,label:"Địa chỉ",value:i.address,onChange:s=>j({...i,address:s.target.value}),disabled:r==="view",variant:"outlined",multiline:!0,rows:2,InputProps:{startAdornment:e.jsx(F,{sx:{mr:1,color:"text.secondary",alignSelf:"flex-start",mt:1}})}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(T,{fullWidth:!0,label:"Số điện thoại",value:i.phone,onChange:s=>j({...i,phone:s.target.value}),disabled:r==="view",variant:"outlined",InputProps:{startAdornment:e.jsx($,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(T,{fullWidth:!0,label:"Email",type:"email",value:i.email,onChange:s=>j({...i,email:s.target.value}),disabled:r==="view",variant:"outlined",InputProps:{startAdornment:e.jsx(M,{sx:{mr:1,color:"text.secondary"}})}})})]}),e.jsx(ae,{control:e.jsx(re,{checked:i.is_active,onChange:s=>j({...i,is_active:s.target.checked}),disabled:r==="view"}),label:"Cửa hàng đang hoạt động"}),r==="view"&&u?.analytics&&e.jsxs(c,{children:[e.jsx(t,{variant:"h6",sx:{mb:2,color:"primary.main"},children:"📊 Thống kê chi tiết"}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsxs(C,{sx:{p:2,textAlign:"center",bgcolor:"primary.50"},children:[e.jsx(t,{variant:"h4",color:"primary.main",fontWeight:"bold",children:u.analytics.sales.total_sales}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Tổng đơn hàng"})]})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsxs(C,{sx:{p:2,textAlign:"center",bgcolor:"success.50"},children:[e.jsx(t,{variant:"h4",color:"success.main",fontWeight:"bold",children:w(u.analytics.sales.total_revenue)}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Tổng doanh thu"})]})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsxs(C,{sx:{p:2,textAlign:"center",bgcolor:"info.50"},children:[e.jsx(t,{variant:"h4",color:"info.main",fontWeight:"bold",children:w(u.analytics.sales.avg_order_value)}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Giá trị TB/đơn"})]})})]})]})]})}),e.jsxs(ie,{sx:{p:3,pt:0},children:[e.jsx(S,{onClick:W,variant:"outlined",children:r==="view"?"Đóng":"Hủy"}),r!=="view"&&e.jsx(S,{onClick:V,variant:"contained",sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:r==="create"?"Tạo cửa hàng":"Cập nhật"})]})]}),e.jsx(oe,{open:b.open,autoHideDuration:6e3,onClose:()=>h({...b,open:!1}),children:e.jsx(ce,{onClose:()=>h({...b,open:!1}),severity:b.severity,sx:{width:"100%"},children:b.message})})]})};export{_e as default};
