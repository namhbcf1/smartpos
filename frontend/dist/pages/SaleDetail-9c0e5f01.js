import{j as e,af as g,av as y,aj as t,ae as D,t as p,W as i,T as n,Y as d,Z as h,C as l,a3 as K,ap as Q,P as G,aq as L,ar as A,as as T,at as c,au as $}from"../chunks/mui-core-cd9e8750.js";import{j as N,u as R,r as j}from"../chunks/react-vendor-9ee90314.js";import{a as U}from"../chunks/ui-vendor-11834b8a.js";import{b as o,a as V}from"../assets/index-fad1ea34.js";import{$ as C,i as F,ah as H,ai as b,a3 as M,aj as Y,x as k,ak as z,k as Z,l as J,j as O,a as X,Q as ee,Y as ne}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/utils-vendor-8faa4a85.js";const le=()=>{const{id:m}=N(),v=R(),{enqueueSnackbar:f}=U(),[r,w]=j.useState(null),[x,W]=j.useState([]),[B,_]=j.useState(!0),[I,S]=j.useState(null);j.useEffect(()=>{(async()=>{if(m)try{_(!0);const a=await V.get(`/sales/${m}`);console.log("SaleDetail API response:",a),a.success&&a.data?(w(a.data.order),W(a.data.items)):S(a.message||"Không tìm thấy đơn hàng")}catch(a){console.error("Fetch sale details error:",a),S("Lỗi khi tải chi tiết đơn hàng"),f("Lỗi khi tải chi tiết đơn hàng",{variant:"error"})}finally{_(!1)}})()},[m,f]);const P=s=>{const a={paid:{label:"Đã thanh toán",color:"success",icon:e.jsx(X,{})},pending:{label:"Chờ thanh toán",color:"warning",icon:e.jsx(ee,{})},cancelled:{label:"Đã hủy",color:"error",icon:e.jsx(ne,{})}},u=a[s]||a.pending;return e.jsx(l,{label:u.label,color:u.color,icon:u.icon,size:"small"})},E=s=>({cash:"Tiền mặt",card:"Thẻ",transfer:"Chuyển khoản",qr:"QR Code"})[s]||s,q=()=>{window.print()};return B?e.jsxs(g,{maxWidth:"lg",sx:{py:3},children:[e.jsx(y,{variant:"text",width:300,height:40}),e.jsxs(t,{container:!0,spacing:3,sx:{mt:2},children:[e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(y,{variant:"rectangular",height:200})}),e.jsx(t,{item:!0,xs:12,md:8,children:e.jsx(y,{variant:"rectangular",height:200})})]})]}):I||!r?e.jsxs(g,{maxWidth:"lg",sx:{py:3},children:[e.jsx(D,{severity:"error",children:I||"Không tìm thấy đơn hàng"}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(C,{}),onClick:()=>v("/sales"),sx:{mt:2},children:"Quay lại"})]}):e.jsxs(g,{maxWidth:"lg",sx:{py:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{variant:"h4",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{}),"Chi tiết đơn hàng #",r.id]}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(p,{variant:"outlined",startIcon:e.jsx(C,{}),onClick:()=>v("/sales"),children:"Quay lại"}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(H,{}),onClick:q,children:"In hóa đơn"})]})]}),e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(d,{children:e.jsxs(h,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Thông tin đơn hàng"}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Mã đơn hàng"}),e.jsxs(n,{variant:"body1",fontWeight:600,children:["#",r.id]})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Trạng thái"}),e.jsx(i,{sx:{mt:.5},children:P(r.payment_status)})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Phương thức thanh toán"}),e.jsx(n,{variant:"body1",children:E(r.payment_method)})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Ngày tạo"}),e.jsx(n,{variant:"body1",children:new Date(r.created_at).toLocaleString("vi-VN")})]}),r.notes&&e.jsxs(i,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Ghi chú"}),e.jsx(n,{variant:"body1",children:r.notes})]})]})})}),e.jsxs(t,{item:!0,xs:12,md:8,children:[e.jsx(d,{sx:{mb:3},children:e.jsxs(h,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Thông tin khách hàng"}),e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:12,sm:6,children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Tên khách hàng"}),e.jsx(n,{variant:"body1",children:r.customer_name||"Khách vãng lai"})]}),e.jsxs(t,{item:!0,xs:12,sm:6,children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Số điện thoại"}),e.jsx(n,{variant:"body1",children:r.customer_phone||"-"})]}),r.customer_email&&e.jsxs(t,{item:!0,xs:12,children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Email"}),e.jsx(n,{variant:"body1",children:r.customer_email})]})]})]})}),e.jsx(d,{sx:{mb:3},children:e.jsxs(h,{children:[e.jsxs(n,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{color:"primary"}),"Thông tin người bán"]}),e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:12,sm:6,children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(M,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Tên nhân viên"})]}),e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:r.cashier_name||"Không xác định"})]}),e.jsxs(t,{item:!0,xs:12,sm:6,children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(b,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Username"})]}),e.jsxs(n,{variant:"body1",children:["@",r.cashier_username||"unknown"]})]}),e.jsxs(t,{item:!0,xs:12,sm:6,children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Y,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Email"})]}),e.jsx(n,{variant:"body1",children:r.cashier_email||"-"})]}),e.jsxs(t,{item:!0,xs:12,sm:6,children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(b,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Vai trò"})]}),e.jsx(l,{label:r.cashier_role==="admin"?"Quản trị viên":r.cashier_role==="manager"?"Quản lý":r.cashier_role==="cashier"?"Thu ngân":r.cashier_role==="inventory"?"Kho":r.cashier_role,size:"small",color:r.cashier_role==="admin"?"error":r.cashier_role==="manager"?"warning":"primary",variant:"outlined"})]})]})]})}),e.jsx(d,{children:e.jsxs(h,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Tóm tắt đơn hàng"}),e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:6,children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Tạm tính"}),e.jsx(n,{variant:"body1",children:o(r.total_amount-r.tax_amount)})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Thuế VAT"}),e.jsx(n,{variant:"body1",children:o(r.tax_amount)})]}),r.discount_amount>0&&e.jsxs(t,{item:!0,xs:6,children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Giảm giá"}),e.jsxs(n,{variant:"body1",color:"error",children:["-",o(r.discount_amount)]})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(k,{sx:{fontSize:16}}),"Tổng lợi nhuận"]}),e.jsx(n,{variant:"body1",color:"success.main",fontWeight:600,children:o(x.reduce((s,a)=>s+a.profit_amount,0))})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(z,{sx:{fontSize:16}}),"Tỷ suất lợi nhuận"]}),e.jsxs(n,{variant:"body1",color:"success.main",fontWeight:600,children:[x.length>0?(x.reduce((s,a)=>s+a.profit_amount,0)/x.reduce((s,a)=>s+a.cost_price*a.quantity,0)*100).toFixed(2):0,"%"]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(K,{sx:{my:1}}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"h6",children:"Tổng cộng"}),e.jsx(n,{variant:"h6",color:"primary",children:o(r.total_amount)})]})]})]})]})})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(d,{children:e.jsxs(h,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Chi tiết sản phẩm"}),e.jsx(Q,{component:G,variant:"outlined",children:e.jsxs(L,{children:[e.jsx(A,{children:e.jsxs(T,{children:[e.jsx(c,{children:"Sản phẩm"}),e.jsx(c,{align:"center",children:"Số lượng"}),e.jsx(c,{align:"right",children:"Đơn giá"}),e.jsx(c,{align:"right",children:"Thành tiền"}),e.jsx(c,{align:"right",children:"Lợi nhuận"}),e.jsx(c,{align:"center",children:"Tồn kho"})]})}),e.jsx($,{children:x.map(s=>e.jsxs(T,{children:[e.jsx(c,{children:e.jsxs(i,{children:[e.jsxs(n,{variant:"body2",fontWeight:500,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Z,{sx:{fontSize:16,color:"primary.main"}}),s.product_name]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mt:.5},children:[e.jsxs(n,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(J,{sx:{fontSize:12}}),"SKU: ",s.product_sku]}),s.barcode&&e.jsxs(n,{variant:"caption",color:"text.secondary",children:["Barcode: ",s.barcode]})]}),s.category_name&&e.jsxs(n,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:["📂 ",s.category_name]}),s.product_description&&e.jsx(n,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5,fontStyle:"italic"},children:s.product_description}),e.jsxs(i,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(l,{label:`Giá hiện tại: ${o(s.current_price)}`,size:"small",variant:"outlined",color:"info"}),e.jsx(l,{label:`Giá vốn: ${o(s.cost_price)}`,size:"small",variant:"outlined",color:"warning"})]})]})}),e.jsx(c,{align:"center",children:e.jsx(l,{label:s.quantity,size:"small",color:"primary",sx:{fontWeight:"bold"}})}),e.jsxs(c,{align:"right",children:[e.jsx(n,{variant:"body2",fontWeight:600,children:o(s.unit_price)}),s.unit_price!==s.current_price&&e.jsxs(n,{variant:"caption",color:"text.secondary",children:["(Hiện tại: ",o(s.current_price),")"]})]}),e.jsx(c,{align:"right",children:e.jsx(n,{variant:"body2",fontWeight:600,color:"primary.main",children:o(s.total_price)})}),e.jsx(c,{align:"right",children:e.jsxs(i,{children:[e.jsxs(n,{variant:"body2",fontWeight:600,color:"success.main",sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:.5},children:[e.jsx(k,{sx:{fontSize:16}}),o(s.profit_amount)]}),e.jsxs(n,{variant:"caption",color:"success.main",sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:.5},children:[e.jsx(z,{sx:{fontSize:12}}),s.profit_margin_percent,"%"]})]})}),e.jsx(c,{align:"center",children:e.jsx(l,{label:s.stock_quantity,size:"small",color:s.stock_quantity>10?"success":s.stock_quantity>0?"warning":"error",icon:e.jsx(O,{})})})]},s.id))})]})})]})})})]})]})};export{le as default};
