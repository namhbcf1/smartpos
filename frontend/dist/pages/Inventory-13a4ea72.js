import{j as e,af as W,W as r,ad as ie,T as s,a8 as d,$ as z,t as C,ae as oe,aj as c,Y as j,Z as m,P as B,E as ce,ak as D,al as R,am as A,ab as u,ap as he,aq as de,ar as xe,as as $,at as a,au as je,C as G,V as k,an as me,I as w,ax as ue}from"../chunks/mui-core-cd9e8750.js";import{r as i}from"../chunks/react-vendor-9ee90314.js";import{a as H}from"../assets/index-fad1ea34.js";import{j as v,t as ge,ar as ye,T as _e,x as fe,W as T,E as M,k as ke,a4 as K,e as ve,w as be,Z as pe,al as Se}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/ui-vendor-11834b8a.js";import"../chunks/utils-vendor-8faa4a85.js";const Le=()=>{i.useState(0);const[P,U]=i.useState([]),[x,X]=i.useState(null),[F,q]=i.useState(!1),[L,b]=i.useState(null),[p,E]=i.useState(0),[S,Z]=i.useState(10),[O,Q]=i.useState(0),[y,Y]=i.useState(""),[_,J]=i.useState("all"),[g,ee]=i.useState("all");i.useEffect(()=>{N(),V()},[p,S,y,_,g]);const N=async()=>{q(!0),b(null);try{const t=new URLSearchParams({page:(p+1).toString(),limit:S.toString(),...y&&{search:y},..._!=="all"&&{category_id:_}}),n=await H.get(`/products?${t}`);if(n.success){let l=n.data.data;g==="low_stock"?l=l.filter(h=>h.stock_quantity<=h.stock_alert_threshold&&h.stock_quantity>0):g==="out_of_stock"?l=l.filter(h=>h.stock_quantity===0):g==="in_stock"&&(l=l.filter(h=>h.stock_quantity>h.stock_alert_threshold)),U(l),Q(n.data.pagination.total)}else b("Không thể tải danh sách sản phẩm")}catch(t){console.error("Error loading products:",t),b("Lỗi khi tải danh sách sản phẩm")}finally{q(!1)}},V=async()=>{try{const t=await H.get("/products");if(t.success){const n=t.data.data,l=n.length,h=n.reduce((o,f)=>o+f.stock_quantity*f.cost_price,0),ne=n.filter(o=>o.stock_quantity<=o.stock_alert_threshold&&o.stock_quantity>0).length,re=n.filter(o=>o.stock_quantity===0).length,ae=new Set(n.map(o=>o.category_id)).size,le=l>0?n.reduce((o,f)=>o+f.stock_quantity,0)/l:0;X({total_products:l,total_value:h,low_stock_items:ne,out_of_stock_items:re,categories_count:ae,avg_stock_level:Math.round(le)})}}catch(t){console.error("Error loading inventory stats:",t)}},te=t=>t.stock_quantity===0?{status:"out_of_stock",label:"Hết hàng",color:"error"}:t.stock_quantity<=t.stock_alert_threshold?{status:"low_stock",label:"Sắp hết",color:"warning"}:{status:"in_stock",label:"Còn hàng",color:"success"},se=t=>{switch(t){case"out_of_stock":return e.jsx(M,{sx:{color:"#f44336"}});case"low_stock":return e.jsx(T,{sx:{color:"#FF9800"}});case"in_stock":return e.jsx(K,{sx:{color:"#4CAF50"}});default:return e.jsx(v,{})}},I=t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t);return F&&P.length===0?e.jsx(W,{maxWidth:"xl",sx:{py:4},children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:8},children:[e.jsx(ie,{size:60,sx:{mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",children:"Đang tải dữ liệu tồn kho..."})]})}):e.jsxs(W,{maxWidth:"xl",sx:{py:4},"data-testid":"inventory-list",children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(d,{sx:{bgcolor:"primary.main",mr:2,width:56,height:56},children:e.jsx(v,{fontSize:"large"})}),e.jsxs(r,{children:[e.jsx(s,{variant:"h4",component:"h1",children:"Quản lý Tồn kho"}),e.jsx(s,{variant:"subtitle1",color:"text.secondary",children:"Theo dõi và quản lý inventory sản phẩm"})]})]}),e.jsxs(z,{direction:"row",spacing:2,children:[e.jsx(C,{variant:"outlined",startIcon:e.jsx(ge,{}),onClick:()=>{N(),V()},disabled:F,children:"Làm mới"}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(ye,{}),children:"Xuất Excel"}),e.jsx(C,{variant:"contained",startIcon:e.jsx(_e,{}),onClick:()=>window.location.href="/inventory/stock-in",children:"Nhập hàng"})]})]}),L&&e.jsx(oe,{severity:"error",sx:{mb:3},children:L}),x&&e.jsxs(c,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(c,{item:!0,xs:12,sm:6,md:2,children:e.jsx(j,{children:e.jsx(m,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(d,{sx:{bgcolor:"#2196F3",mr:2},children:e.jsx(v,{})}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Tổng SP"}),e.jsx(s,{variant:"h6",children:x.total_products.toLocaleString("vi-VN")})]})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:2,children:e.jsx(j,{children:e.jsx(m,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(d,{sx:{bgcolor:"#4CAF50",mr:2},children:e.jsx(fe,{})}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Giá trị kho"}),e.jsx(s,{variant:"h6",fontSize:"0.9rem",children:I(x.total_value)})]})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:2,children:e.jsx(j,{children:e.jsx(m,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(d,{sx:{bgcolor:"#FF9800",mr:2},children:e.jsx(T,{})}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Sắp hết"}),e.jsx(s,{variant:"h6",children:x.low_stock_items.toLocaleString("vi-VN")})]})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:2,children:e.jsx(j,{children:e.jsx(m,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(d,{sx:{bgcolor:"#f44336",mr:2},children:e.jsx(M,{})}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Hết hàng"}),e.jsx(s,{variant:"h6",children:x.out_of_stock_items.toLocaleString("vi-VN")})]})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:2,children:e.jsx(j,{children:e.jsx(m,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(d,{sx:{bgcolor:"#9C27B0",mr:2},children:e.jsx(ke,{})}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Danh mục"}),e.jsx(s,{variant:"h6",children:x.categories_count.toLocaleString("vi-VN")})]})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:2,children:e.jsx(j,{children:e.jsx(m,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(d,{sx:{bgcolor:"#607D8B",mr:2},children:e.jsx(K,{})}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"TB tồn kho"}),e.jsx(s,{variant:"h6",children:x.avg_stock_level.toLocaleString("vi-VN")})]})]})})})})]}),e.jsxs(B,{sx:{p:3,mb:4},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Bộ lọc tìm kiếm"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(ce,{fullWidth:!0,label:"Tìm kiếm sản phẩm",value:y,onChange:t=>Y(t.target.value),placeholder:"Tìm theo tên, SKU, barcode...",InputProps:{startAdornment:e.jsx(ve,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(R,{children:"Danh mục"}),e.jsxs(A,{value:_,onChange:t=>J(t.target.value),label:"Danh mục",children:[e.jsx(u,{value:"all",children:"Tất cả danh mục"}),e.jsx(u,{value:"1",children:"Linh kiện máy tính"})]})]})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(R,{children:"Tình trạng kho"}),e.jsxs(A,{value:g,onChange:t=>ee(t.target.value),label:"Tình trạng kho",children:[e.jsx(u,{value:"all",children:"Tất cả"}),e.jsx(u,{value:"in_stock",children:"Còn hàng"}),e.jsx(u,{value:"low_stock",children:"Sắp hết"}),e.jsx(u,{value:"out_of_stock",children:"Hết hàng"})]})]})})]})]}),e.jsxs(B,{children:[e.jsx(he,{children:e.jsxs(de,{children:[e.jsx(xe,{children:e.jsxs($,{children:[e.jsx(a,{children:"Sản phẩm"}),e.jsx(a,{children:"SKU"}),e.jsx(a,{children:"Danh mục"}),e.jsx(a,{align:"right",children:"Giá bán"}),e.jsx(a,{align:"right",children:"Giá vốn"}),e.jsx(a,{align:"center",children:"Tồn kho"}),e.jsx(a,{align:"center",children:"Trạng thái"}),e.jsx(a,{align:"center",children:"Thao tác"})]})}),e.jsx(je,{children:P.map(t=>{const n=te(t);return e.jsxs($,{hover:!0,children:[e.jsx(a,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(d,{sx:{bgcolor:"primary.main",mr:2,width:40,height:40},children:e.jsx(v,{})}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",fontWeight:"medium",children:t.name}),e.jsx(s,{variant:"caption",color:"text.secondary",children:t.barcode})]})]})}),e.jsx(a,{children:e.jsx(s,{variant:"body2",fontFamily:"monospace",children:t.sku})}),e.jsx(a,{children:e.jsx(G,{label:t.category_name,size:"small",variant:"outlined"})}),e.jsx(a,{align:"right",children:e.jsx(s,{variant:"body2",fontWeight:"medium",children:I(t.price)})}),e.jsx(a,{align:"right",children:e.jsx(s,{variant:"body2",children:I(t.cost_price)})}),e.jsxs(a,{align:"center",children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[e.jsx(s,{variant:"body2",fontWeight:"medium",children:t.stock_quantity.toLocaleString("vi-VN")}),t.stock_quantity<=t.stock_alert_threshold&&e.jsx(k,{title:`Ngưỡng cảnh báo: ${t.stock_alert_threshold}`,children:e.jsx(T,{color:"warning",fontSize:"small"})})]}),e.jsx(me,{variant:"determinate",value:Math.min(t.stock_quantity/(t.stock_alert_threshold*2)*100,100),sx:{mt:1,height:4,backgroundColor:"#f0f0f0","& .MuiLinearProgress-bar":{backgroundColor:n.color==="error"?"#f44336":n.color==="warning"?"#FF9800":"#4CAF50"}}})]}),e.jsx(a,{align:"center",children:e.jsx(G,{icon:se(n.status),label:n.label,color:n.color,size:"small"})}),e.jsx(a,{align:"center",children:e.jsxs(z,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(k,{title:"Xem chi tiết",children:e.jsx(w,{size:"small",children:e.jsx(be,{})})}),e.jsx(k,{title:"Chỉnh sửa",children:e.jsx(w,{size:"small",children:e.jsx(pe,{})})}),e.jsx(k,{title:"Serial numbers",children:e.jsx(w,{size:"small",children:e.jsx(Se,{})})})]})})]},t.id)})})]})}),e.jsx(ue,{component:"div",count:O,page:p,onPageChange:(t,n)=>E(n),rowsPerPage:S,onRowsPerPageChange:t=>{Z(parseInt(t.target.value,10)),E(0)},labelRowsPerPage:"Số dòng mỗi trang:",labelDisplayedRows:({from:t,to:n,count:l})=>`${t}-${n} của ${l!==-1?l:`hơn ${n}`}`})]})]})};export{Le as default};
