import{j as e,af as U,W as n,ad as xe,T as r,a8 as b,$,t as N,ae as ue,aj as o,Y as I,Z as E,P as K,E as me,ak as M,al as q,am as X,ab as v,ap as je,aq as ge,ar as pe,as as Y,at as c,au as fe,C as B,V as G,I as Q,ax as ye,D as be,ay as ve,o as Se,v as we}from"../chunks/mui-core-cd9e8750.js";import{r as l}from"../chunks/react-vendor-9ee90314.js";import{a as Z,A as _e}from"../assets/index-fad1ea34.js";import{a as ke}from"../chunks/ui-vendor-11834b8a.js";import{l as P,t as Ce,ar as Ie,T as Ee,a4 as F,a as J,al as Te,aU as ee,W as se,e as De,a3 as Le,w as Ne,ab as Pe,Y as te}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/utils-vendor-8faa4a85.js";function Re(t){return typeof t=="string"?t:t?.response?.data?.message?t.response.data.message:t?.message?t.message:t?.data?.message?t.data.message:"ƒê√£ x·∫£y ra l·ªói kh√¥ng x√°c ƒë·ªãnh"}function Ae(t){return{message:Re(t),code:t?.response?.data?.code||t?.code,status:t?.response?.status||t?.status,details:t?.response?.data||t?.data}}function Be(t,x={}){const{fallbackMessage:h="ƒê√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi v·ªõi m√°y ch·ªß",retryCallback:m,retryDelay:j=3e3,maxRetries:_=3}=x,i=Ae(t);return console.error("API Error:",{message:i.message,status:i.status,code:i.code,details:i.details}),i.status===401?console.warn("Authentication error - user needs to login"):i.status===403?console.warn("Authorization error - insufficient permissions"):i.status===404?console.warn("Resource not found"):i.status>=500&&(console.error("Server error - considering retry"),m&&j>0&&setTimeout(m,j)),(i.message.includes("fetch")||i.message.includes("network")||i.message.includes("ECONNREFUSED"))&&(i.message=h),i}function Fe(t){return!t.response||t.code==="NETWORK_ERROR"||t.message?.includes("Network Error")||t.message?.includes("fetch")}function We(t){return t?.response?.status===401||t?.status===401}function Oe(t){return(t?.response?.status||t?.status)>=500}function ze(){const[t,x]=l.useState(null),[h,m]=l.useState(!1),[j,_]=l.useState(null),{enqueueSnackbar:i}=ke(),R=l.useCallback(()=>{x(null)},[]),S=l.useCallback((g,C={})=>{const{showNotification:p=!0}=C,u=Be(g,C);return x(u),p&&(We(g)?i("Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.",{variant:"warning",autoHideDuration:5e3}):Fe(g)?i("L·ªói k·∫øt n·ªëi m·∫°ng. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi internet.",{variant:"error",autoHideDuration:5e3}):Oe(g)?i("L·ªói m√°y ch·ªß. H·ªá th·ªëng s·∫Ω th·ª≠ l·∫°i t·ª± ƒë·ªông.",{variant:"error",autoHideDuration:5e3}):i(u.message,{variant:"error",autoHideDuration:5e3})),u},[i]),k=l.useCallback(async(g,C={})=>{m(!0),x(null),_(()=>g);try{const p=await g();return x(null),p}catch(p){return S(p,C),null}finally{m(!1)}},[S]),T=l.useCallback(async()=>{j&&await k(j,{showNotification:!1})},[j,k]);return{error:t,isLoading:h,clearError:R,handleError:S,executeWithErrorHandling:k,retryOperation:T}}const Ye=()=>{const[t,x]=l.useState([]),[h,m]=l.useState(null),{error:j,isLoading:_,executeWithErrorHandling:i,clearError:R}=ze(),[S,k]=l.useState(0),[T,g]=l.useState(10),[C,p]=l.useState(0),[u,re]=l.useState(""),[f,ne]=l.useState("all"),[y,ae]=l.useState("all"),[d,ie]=l.useState(null),[le,A]=l.useState(!1),[He,ce]=l.useState(!1);l.useEffect(()=>{W(),oe()},[S,T,u,f,y]);const W=async()=>{const s=await i(async()=>{console.log("üîÑ Loading serial numbers...");const a=new URLSearchParams({page:(S+1).toString(),limit:T.toString()});u.trim()&&a.append("search",u.trim()),f&&f!=="all"&&a.append("status",f),y&&y!=="all"&&a.append("product_id",y);const w=await Z.get(`/serial-numbers?${a.toString()}`);return console.log("‚úÖ Serial numbers loaded successfully:",w.data?.length||0,"items"),w},{fallbackMessage:"Kh√¥ng th·ªÉ t·∫£i danh s√°ch serial numbers"});s?(x(s.data||[]),p(s.pagination?.total||0)):(x([]),p(0))},oe=async()=>{try{try{const a=await Z.get("/serial-numbers-stats");m(a),console.log("‚úÖ Serial number stats loaded successfully from API");return}catch(a){console.warn("Stats endpoint failed, calculating from data:",a)}const s={total_serials:t.length,in_stock:t.filter(a=>a.status==="in_stock").length,sold:t.filter(a=>a.status==="sold").length,warranty_active:t.filter(a=>a.status==="warranty_claim").length,warranty_claims:t.filter(a=>a.status==="warranty_claim").length,defective:t.filter(a=>a.status==="defective").length};m(s),console.log("‚úÖ Serial number stats calculated from data")}catch(s){console.error("Error loading stats:",s),m({total_serials:0,in_stock:0,sold:0,warranty_active:0,warranty_claims:0,defective:0})}},O=s=>{switch(s){case"in_stock":return e.jsx(F,{sx:{color:"#4CAF50"}});case"sold":return e.jsx(J,{sx:{color:"#2196F3"}});case"returned":return e.jsx(te,{sx:{color:"#FF9800"}});case"defective":return e.jsx(se,{sx:{color:"#f44336"}});case"warranty_claim":return e.jsx(ee,{sx:{color:"#9C27B0"}});case"disposed":return e.jsx(te,{sx:{color:"#666"}});default:return e.jsx(P,{})}},z=s=>{switch(s){case"in_stock":return"success";case"sold":return"primary";case"returned":return"warning";case"defective":return"error";case"warranty_claim":return"secondary";case"disposed":return"default";default:return"default"}},H=s=>{switch(s){case"in_stock":return"Trong kho";case"sold":return"ƒê√£ b√°n";case"returned":return"Tr·∫£ h√†ng";case"defective":return"L·ªói";case"warranty_claim":return"B·∫£o h√†nh";case"disposed":return"ƒê√£ h·ªßy";default:return s}},de=s=>{ie(s),A(!0)},D=s=>new Date(s).toLocaleDateString("vi-VN"),he=async()=>{await i(async()=>{console.log("üìä Exporting serial numbers to Excel...");const s=new URLSearchParams({page:"1",limit:"10000",export:"true"});u.trim()&&s.append("search",u.trim()),f&&f!=="all"&&s.append("status",f),y&&y!=="all"&&s.append("product_id",y);const a=await fetch(`${_e}/serial-numbers?${s.toString()}`,{headers:{Authorization:`Bearer ${sessionStorage.getItem("auth_token")}`,Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});if(!a.ok)throw new Error("Export failed");const w=await a.blob(),V=window.URL.createObjectURL(w),L=document.createElement("a");L.href=V,L.download=`serial-numbers-${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(L),L.click(),document.body.removeChild(L),window.URL.revokeObjectURL(V),console.log("‚úÖ Excel export completed successfully")},{fallbackMessage:"Kh√¥ng th·ªÉ xu·∫•t file Excel"})};return _&&t.length===0?e.jsx(U,{maxWidth:"xl",sx:{py:4},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:8},children:[e.jsx(xe,{size:60,sx:{mb:2}}),e.jsx(r,{variant:"h6",color:"text.secondary",children:"ƒêang t·∫£i d·ªØ li·ªáu serial numbers..."})]})}):e.jsxs(U,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{sx:{bgcolor:"primary.main",mr:2,width:56,height:56},children:e.jsx(P,{fontSize:"large"})}),e.jsxs(n,{children:[e.jsx(r,{variant:"h4",component:"h1",children:"Qu·∫£n l√Ω Serial Numbers"}),e.jsx(r,{variant:"subtitle1",color:"text.secondary",children:"Theo d√µi serial numbers t·ª´ nh·∫≠p h√†ng ƒë·∫øn b·∫£o h√†nh"})]})]}),e.jsxs($,{direction:"row",spacing:2,children:[e.jsx(N,{variant:"outlined",startIcon:e.jsx(Ce,{}),onClick:W,disabled:_,children:"L√†m m·ªõi"}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(Ie,{}),onClick:he,disabled:_,children:"Xu·∫•t Excel"}),e.jsx(N,{variant:"contained",startIcon:e.jsx(Ee,{}),onClick:()=>ce(!0),children:"Th√™m Serial"})]})]}),j&&e.jsx(ue,{severity:"error",sx:{mb:3},onClose:R,children:j.message}),h&&e.jsxs(o,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(o,{item:!0,xs:12,sm:6,md:2,children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{sx:{bgcolor:"#2196F3",mr:2},children:e.jsx(P,{})}),e.jsxs(n,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"T·ªïng Serial"}),e.jsx(r,{variant:"h6",children:h.total_serials.toLocaleString("vi-VN")})]})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:2,children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{sx:{bgcolor:"#4CAF50",mr:2},children:e.jsx(F,{})}),e.jsxs(n,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Trong kho"}),e.jsx(r,{variant:"h6",children:h.in_stock.toLocaleString("vi-VN")})]})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:2,children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{sx:{bgcolor:"#FF9800",mr:2},children:e.jsx(J,{})}),e.jsxs(n,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"ƒê√£ b√°n"}),e.jsx(r,{variant:"h6",children:h.sold.toLocaleString("vi-VN")})]})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:2,children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{sx:{bgcolor:"#9C27B0",mr:2},children:e.jsx(Te,{})}),e.jsxs(n,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"B·∫£o h√†nh"}),e.jsx(r,{variant:"h6",children:h.warranty_active.toLocaleString("vi-VN")})]})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:2,children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{sx:{bgcolor:"#f44336",mr:2},children:e.jsx(ee,{})}),e.jsxs(n,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Claim BH"}),e.jsx(r,{variant:"h6",children:h.warranty_claims.toLocaleString("vi-VN")})]})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:2,children:e.jsx(I,{children:e.jsx(E,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{sx:{bgcolor:"#FF5722",mr:2},children:e.jsx(se,{})}),e.jsxs(n,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"L·ªói"}),e.jsx(r,{variant:"h6",children:h.defective.toLocaleString("vi-VN")})]})]})})})})]}),e.jsxs(K,{sx:{p:3,mb:4},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"B·ªô l·ªçc t√¨m ki·∫øm"}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,md:4,children:e.jsx(me,{fullWidth:!0,label:"T√¨m ki·∫øm serial number",value:u,onChange:s=>re(s.target.value),InputProps:{startAdornment:e.jsx(De,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(o,{item:!0,xs:12,md:4,children:e.jsxs(M,{fullWidth:!0,children:[e.jsx(q,{children:"Tr·∫°ng th√°i"}),e.jsxs(X,{value:f,onChange:s=>ne(s.target.value),label:"Tr·∫°ng th√°i",children:[e.jsx(v,{value:"all",children:"T·∫•t c·∫£"}),e.jsx(v,{value:"in_stock",children:"Trong kho"}),e.jsx(v,{value:"sold",children:"ƒê√£ b√°n"}),e.jsx(v,{value:"returned",children:"Tr·∫£ h√†ng"}),e.jsx(v,{value:"defective",children:"L·ªói"}),e.jsx(v,{value:"warranty_claim",children:"B·∫£o h√†nh"}),e.jsx(v,{value:"disposed",children:"ƒê√£ h·ªßy"})]})]})}),e.jsx(o,{item:!0,xs:12,md:4,children:e.jsxs(M,{fullWidth:!0,children:[e.jsx(q,{children:"S·∫£n ph·∫©m"}),e.jsx(X,{value:y,onChange:s=>ae(s.target.value),label:"S·∫£n ph·∫©m",children:e.jsx(v,{value:"all",children:"T·∫•t c·∫£ s·∫£n ph·∫©m"})})]})})]})]}),e.jsxs(K,{children:[e.jsx(je,{children:e.jsxs(ge,{children:[e.jsx(pe,{children:e.jsxs(Y,{children:[e.jsx(c,{children:"Serial Number"}),e.jsx(c,{children:"S·∫£n ph·∫©m"}),e.jsx(c,{children:"Nh√† cung c·∫•p"}),e.jsx(c,{children:"Tr·∫°ng th√°i"}),e.jsx(c,{children:"Ng√†y nh·∫≠p"}),e.jsx(c,{children:"Ng√†y b√°n"}),e.jsx(c,{children:"Kh√°ch h√†ng"}),e.jsx(c,{children:"B·∫£o h√†nh"}),e.jsx(c,{align:"center",children:"Thao t√°c"})]})}),e.jsx(fe,{children:t.map(s=>e.jsxs(Y,{hover:!0,children:[e.jsx(c,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{sx:{bgcolor:"primary.main",mr:2,width:32,height:32},children:e.jsx(P,{fontSize:"small"})}),e.jsx(r,{variant:"body2",fontWeight:"medium",children:s.serial_number})]})}),e.jsx(c,{children:e.jsxs(n,{children:[e.jsx(r,{variant:"body2",fontWeight:"medium",children:s.product?.name||s.product_name}),e.jsx(r,{variant:"caption",color:"text.secondary",children:s.product?.sku||s.product_sku})]})}),e.jsx(c,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(F,{sx:{mr:1,color:"text.secondary",fontSize:16}}),e.jsx(r,{variant:"body2",children:s.supplier?.name||s.supplier_name||"-"})]})}),e.jsx(c,{children:e.jsx(B,{icon:O(s.status),label:H(s.status),color:z(s.status),size:"small"})}),e.jsx(c,{children:D(s.received_date)}),e.jsx(c,{children:s.sold_date?D(s.sold_date):"-"}),e.jsx(c,{children:s.customer?.full_name||s.customer_name?e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Le,{sx:{mr:1,color:"text.secondary",fontSize:16}}),e.jsxs(n,{children:[e.jsx(r,{variant:"body2",children:s.customer?.full_name||s.customer_name}),s.customer?.phone&&e.jsx(r,{variant:"caption",color:"text.secondary",children:s.customer.phone})]})]}):"-"}),e.jsx(c,{children:s.warranty_end_date?e.jsxs(n,{children:[e.jsxs(r,{variant:"body2",children:["ƒê·∫øn: ",D(s.warranty_end_date)]}),e.jsx(B,{label:new Date(s.warranty_end_date)>new Date?"C√≤n h·∫°n":"H·∫øt h·∫°n",color:new Date(s.warranty_end_date)>new Date?"success":"error",size:"small"})]}):"-"}),e.jsx(c,{align:"center",children:e.jsxs($,{direction:"row",spacing:1,children:[e.jsx(G,{title:"Xem chi ti·∫øt",children:e.jsx(Q,{size:"small",onClick:()=>de(s),children:e.jsx(Ne,{})})}),e.jsx(G,{title:"L·ªãch s·ª≠",children:e.jsx(Q,{size:"small",children:e.jsx(Pe,{})})})]})})]},s.id))})]})}),e.jsx(ye,{component:"div",count:C,page:S,onPageChange:(s,a)=>k(a),rowsPerPage:T,onRowsPerPageChange:s=>{g(parseInt(s.target.value,10)),k(0)},labelRowsPerPage:"S·ªë d√≤ng m·ªói trang:",labelDisplayedRows:({from:s,to:a,count:w})=>`${s}-${a} c·ªßa ${w!==-1?w:`h∆°n ${a}`}`})]}),e.jsxs(be,{open:le,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ve,{children:"Chi ti·∫øt Serial Number"}),e.jsx(Se,{children:d&&e.jsx(n,{sx:{pt:2},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Th√¥ng tin c∆° b·∫£n"}),e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Serial Number:"}),e.jsx(r,{variant:"body1",fontWeight:"medium",children:d.serial_number})]}),e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"S·∫£n ph·∫©m:"}),e.jsx(r,{variant:"body1",children:d.product?.name})]}),e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Tr·∫°ng th√°i:"}),e.jsx(B,{icon:O(d.status),label:H(d.status),color:z(d.status),size:"small"})]})]}),e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Th√¥ng tin b·∫£o h√†nh"}),d.warranty_start_date&&e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"B·∫Øt ƒë·∫ßu:"}),e.jsx(r,{variant:"body1",children:D(d.warranty_start_date)})]}),d.warranty_end_date&&e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"K·∫øt th√∫c:"}),e.jsx(r,{variant:"body1",children:D(d.warranty_end_date)})]}),d.customer&&e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Kh√°ch h√†ng:"}),e.jsx(r,{variant:"body1",children:d.customer.full_name}),e.jsx(r,{variant:"body2",color:"text.secondary",children:d.customer.phone})]})]})]})})}),e.jsx(we,{children:e.jsx(N,{onClick:()=>A(!1),children:"ƒê√≥ng"})})]})]})};export{Ye as default};
