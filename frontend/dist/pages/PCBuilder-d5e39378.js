import{e as Q,p as X,j as e,W as l,Y as v,Z as C,T as s,an as re,ae as V,aj as d,P as D,$ as R,C as L,L as F,w as G,a1 as ie,a2 as E,a3 as Z,t as w,D as _,ay as ee,o as ne,v as te,af as ae,I as oe,aU as ce,V as le,aM as de}from"../chunks/mui-core-cd9e8750.js";import{r as h,b as se}from"../chunks/react-vendor-9ee90314.js";import{a as he}from"../chunks/ui-vendor-11834b8a.js";import{aU as H,E as K,W as Y,a as me,z as ue,x as pe,I as J,_ as xe,T as ge,m as ye,b0 as je,J as fe,b1 as be,F as ve,b2 as Ce,j as Ie,b3 as Se}from"../chunks/mui-icons-f0327ae6.js";import{b as z}from"../assets/index-fad1ea34.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/utils-vendor-8faa4a85.js";const ke=({selectedComponents:c,onComponentRemove:N,onBuildSave:u,showBuildTools:y=!0})=>{const I=Q();X(I.breakpoints.down("md"));const[p,x]=h.useState([]),[B,j]=h.useState(!1),[f,T]=h.useState(""),[M,S]=h.useState(!1),O=()=>{S(!0);const r=[],i=c.reduce((n,t)=>(n[t.type]||(n[t.type]=[]),n[t.type].push(t),n),{});if(i.cpu&&i.motherboard){const n=i.cpu[0],t=i.motherboard[0];n.compatibility.socket!==t.compatibility.socket&&r.push({type:"error",component1:n.name,component2:t.name,message:`Socket không tương thích: ${n.compatibility.socket} vs ${t.compatibility.socket}`,suggestion:"Chọn CPU và Motherboard có cùng socket"})}if(i.ram&&i.motherboard){const n=i.ram[0],t=i.motherboard[0];n.compatibility.memoryType!==t.compatibility.memoryType&&r.push({type:"error",component1:n.name,component2:t.name,message:`Loại RAM không tương thích: ${n.compatibility.memoryType} vs ${t.compatibility.memoryType}`,suggestion:"Chọn RAM phù hợp với motherboard"})}if(i.psu){const n=i.psu[0],t=c.reduce((o,m)=>o+(m.compatibility.powerRequirement||0),0),a=n.specifications.wattage||0;t>a*.8&&r.push({type:"warning",component1:n.name,component2:"Tổng hệ thống",message:`PSU có thể không đủ công suất: ${a}W vs ${t}W cần thiết`,suggestion:"Nên chọn PSU có công suất cao hơn 20-30%"})}if(i.gpu&&i.case){const n=i.gpu[0],t=i.case[0],a=n.specifications.length||0,o=t.specifications.gpuClearance||0;a>o&&r.push({type:"error",component1:n.name,component2:t.name,message:`GPU quá dài cho case: ${a}mm vs ${o}mm`,suggestion:"Chọn case lớn hơn hoặc GPU nhỏ hơn"})}setTimeout(()=>{x(r),S(!1)},1500)};h.useEffect(()=>{c.length>1?O():x([])},[c]);const k=()=>{const r=c.find(m=>m.type==="cpu"),i=c.find(m=>m.type==="gpu"),n=c.find(m=>m.type==="ram"),t=r?.specifications.benchmarkScore||50,a=i?.specifications.benchmarkScore||50,o=n?.specifications.speed?Math.min(n.specifications.speed/100,100):50;return{gaming:Math.round(a*.6+t*.3+o*.1),productivity:Math.round(t*.6+o*.3+a*.1),overall:Math.round((t+a+o)/3)}},A=c.reduce((r,i)=>r+i.price,0),$=r=>{switch(r){case"error":return e.jsx(K,{color:"error"});case"warning":return e.jsx(Y,{color:"warning"});case"info":return e.jsx(J,{color:"info"});default:return e.jsx(J,{})}},q=r=>{switch(r){case"error":return"error.main";case"warning":return"warning.main";case"info":return"info.main";default:return"text.secondary"}},U=()=>{if(!f.trim())return;const r=c.reduce((n,t)=>(t.type==="ram"||t.type==="storage"?(n[t.type]||(n[t.type]=[]),n[t.type].push(t)):n[t.type]=t,n),{}),i={name:f,components:r,totalPrice:A,estimatedPerformance:k()};u?.(i),j(!1),T("")},g=k(),P=p.some(r=>r.type==="error"),b=p.some(r=>r.type==="warning");return e.jsxs(l,{children:[e.jsx(v,{sx:{mb:3},children:e.jsxs(C,{children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[e.jsxs(s,{variant:"h6",display:"flex",alignItems:"center",gap:1,children:[e.jsx(H,{color:"primary"}),"Kiểm tra tương thích PC"]}),M&&e.jsx(re,{sx:{width:100}})]}),c.length===0?e.jsx(V,{severity:"info",children:"Chọn linh kiện để kiểm tra tương thích"}):e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(D,{sx:{p:2,bgcolor:P?"error.50":b?"warning.50":"success.50"},children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[P?e.jsx(K,{color:"error"}):b?e.jsx(Y,{color:"warning"}):e.jsx(me,{color:"success"}),e.jsx(s,{variant:"subtitle1",fontWeight:600,children:P?"Có lỗi tương thích":b?"Có cảnh báo":"Tương thích tốt"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[p.length," vấn đề được phát hiện"]})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(D,{sx:{p:2},children:e.jsxs(R,{spacing:1,children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Tổng giá:"}),e.jsxs(s,{variant:"h6",color:"primary.main",children:[A.toLocaleString("vi-VN")," ₫"]})]}),e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Hiệu năng:"}),e.jsx(L,{label:`${g.overall}/100`,color:g.overall>=80?"success":g.overall>=60?"warning":"error",size:"small"})]})]})})})]})]})}),p.length>0&&e.jsx(v,{sx:{mb:3},children:e.jsxs(C,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Vấn đề tương thích"}),e.jsx(F,{children:p.map((r,i)=>e.jsxs(se.Fragment,{children:[e.jsxs(G,{children:[e.jsx(ie,{children:$(r.type)}),e.jsx(E,{primary:r.message,secondary:r.suggestion,primaryTypographyProps:{color:q(r.type)}})]}),i<p.length-1&&e.jsx(Z,{})]},i))})]})}),c.length>0&&e.jsx(v,{sx:{mb:3},children:e.jsxs(C,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,display:"flex",alignItems:"center",gap:1,children:[e.jsx(ue,{color:"primary"}),"Hiệu năng dự kiến"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{textAlign:"center",children:[e.jsx(s,{variant:"h4",color:"primary.main",children:g.gaming}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Gaming"})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{textAlign:"center",children:[e.jsx(s,{variant:"h4",color:"secondary.main",children:g.productivity}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Productivity"})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{textAlign:"center",children:[e.jsx(s,{variant:"h4",color:"success.main",children:g.overall}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Tổng thể"})]})})]})]})}),y&&c.length>0&&e.jsx(v,{children:e.jsx(C,{children:e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(s,{variant:"h6",children:"Hành động"}),e.jsxs(R,{direction:"row",spacing:1,children:[e.jsx(w,{variant:"outlined",startIcon:e.jsx(pe,{}),size:"small",children:"So sánh"}),e.jsx(w,{variant:"contained",startIcon:e.jsx(H,{}),onClick:()=>j(!0),disabled:P,children:"Lưu Build"})]})]})})}),e.jsxs(_,{open:B,onClose:()=>j(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ee,{children:"Lưu cấu hình PC"}),e.jsxs(ne,{children:[e.jsx(TextField,{autoFocus:!0,margin:"dense",label:"Tên cấu hình",fullWidth:!0,variant:"outlined",value:f,onChange:r=>T(r.target.value),placeholder:"VD: Gaming Build 2024, Office PC..."}),e.jsx(V,{severity:"info",sx:{mt:2},children:"Cấu hình này sẽ được lưu để sử dụng sau hoặc chia sẻ với khách hàng."})]}),e.jsxs(te,{children:[e.jsx(w,{onClick:()=>j(!1),children:"Hủy"}),e.jsx(w,{onClick:U,variant:"contained",disabled:!f.trim(),children:"Lưu"})]})]})]})},W=[{type:"cpu",name:"CPU",icon:e.jsx(ye,{}),required:!0},{type:"motherboard",name:"Motherboard",icon:e.jsx(je,{}),required:!0},{type:"ram",name:"RAM",icon:e.jsx(fe,{}),required:!0,multiple:!0},{type:"gpu",name:"GPU",icon:e.jsx(be,{}),required:!1},{type:"storage",name:"Storage",icon:e.jsx(ve,{}),required:!0,multiple:!0},{type:"psu",name:"PSU",icon:e.jsx(Ce,{}),required:!0},{type:"case",name:"Case",icon:e.jsx(Ie,{}),required:!0},{type:"cooler",name:"Cooler",icon:e.jsx(Se,{}),required:!1}],Pe=async()=>{try{return[]}catch(c){return console.error("Failed to load PC components from API:",c),[]}},Me=()=>{const c=Q(),N=X(c.breakpoints.down("md")),{enqueueSnackbar:u}=he(),[y,I]=h.useState([]),[p,x]=h.useState(!1),[B,j]=h.useState(""),[f,T]=h.useState([]),[M,S]=h.useState([]),[O,k]=h.useState(!0);h.useEffect(()=>{(async()=>{k(!0);try{const t=await Pe();S(t||[]),(!t||t.length===0)&&u("Không có linh kiện nào trong cơ sở dữ liệu",{variant:"info"})}catch(t){console.error("Failed to load components from API:",t),u("Lỗi khi tải danh sách linh kiện",{variant:"error"}),S([])}finally{k(!1)}})()},[]);const A=n=>M.filter(t=>t.type===n),$=n=>{const t=y.find(o=>o.type===n.type),a=W.find(o=>o.type===n.type);t&&!a?.multiple?(I(o=>o.map(m=>m.type===n.type?n:m)),u(`Đã thay thế ${a?.name}`,{variant:"info"})):(I(o=>[...o,n]),u(`Đã thêm ${n.name}`,{variant:"success"})),x(!1)},q=n=>{I(t=>t.filter(a=>a.id!==n)),u("Đã xóa linh kiện",{variant:"info"})},U=n=>{const t={...n,id:Date.now()};T(a=>[...a,t]),u(`Đã lưu cấu hình "${n.name}"`,{variant:"success"})},g=n=>W.find(t=>t.type===n),b=(()=>W.map(t=>{const a=y.filter(o=>o.type===t.type);return{...t,components:a,hasComponent:a.length>0,isComplete:!t.required||a.length>0}}))(),r=y.reduce((n,t)=>n+t.price,0),i=b.every(n=>n.isComplete);return e.jsxs(ae,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(l,{mb:4,children:[e.jsxs(s,{variant:"h4",gutterBottom:!0,display:"flex",alignItems:"center",gap:2,children:[e.jsx(H,{color:"primary",fontSize:"large"}),"PC Builder"]}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Xây dựng cấu hình PC tối ưu với kiểm tra tương thích tự động"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,lg:8,children:[e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Chọn linh kiện"}),e.jsx(d,{container:!0,spacing:2,children:b.map(n=>e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(D,{sx:{p:2,border:n.hasComponent?"2px solid":"1px solid",borderColor:n.hasComponent?"success.main":n.required?"warning.main":"divider",cursor:"pointer",transition:"all 0.2s","&:hover":{transform:"translateY(-2px)",boxShadow:c.shadows[4]}},onClick:()=>{j(n.type),x(!0)},children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[n.icon,e.jsx(s,{variant:"subtitle1",fontWeight:600,children:n.name}),n.required&&e.jsx(L,{label:"Bắt buộc",size:"small",color:"warning"})]}),n.components.length>0?e.jsx(l,{children:n.components.map((t,a)=>e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(s,{variant:"body2",noWrap:!0,children:t.name}),e.jsx(oe,{size:"small",onClick:o=>{o.stopPropagation(),q(t.id)},children:e.jsx(xe,{fontSize:"small"})})]},t.id))}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"Chưa chọn"})]})},n.type))})]})}),e.jsx(l,{mt:3,children:e.jsx(ke,{selectedComponents:y,onComponentRemove:q,onBuildSave:U})})]}),e.jsx(d,{item:!0,xs:12,lg:4,children:e.jsxs(R,{spacing:3,children:[e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Tổng kết"}),e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(s,{variant:"body1",children:"Tổng giá:"}),e.jsx(s,{variant:"h5",color:"primary.main",children:z(r)})]}),e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(s,{variant:"body2",children:"Linh kiện:"}),e.jsxs(s,{variant:"body2",children:[y.length," / ",W.filter(n=>n.required).length," bắt buộc"]})]}),e.jsx(L,{label:i?"Hoàn thành":"Chưa đủ linh kiện",color:i?"success":"warning",fullWidth:!0})]})}),f.length>0&&e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Cấu hình đã lưu"}),e.jsx(F,{dense:!0,children:f.slice(-3).map(n=>e.jsxs(G,{children:[e.jsx(E,{primary:n.name,secondary:z(n.totalPrice)}),e.jsx(ce,{children:e.jsx(L,{label:`${n.estimatedPerformance.overall}/100`,size:"small",color:n.estimatedPerformance.overall>=80?"success":"warning"})})]},n.id))})]})})]})})]}),e.jsxs(_,{open:p,onClose:()=>x(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(ee,{children:["Chọn ",g(B)?.name]}),e.jsx(ne,{children:e.jsx(F,{children:A(B).map(n=>e.jsxs(se.Fragment,{children:[e.jsx(G,{button:!0,onClick:()=>$(n),children:e.jsx(E,{primary:n.name,secondary:e.jsxs(l,{children:[e.jsx(s,{variant:"body2",color:"primary.main",children:z(n.price)}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[n.brand," • ",n.model]})]})})}),e.jsx(Z,{})]},n.id))})}),e.jsx(te,{children:e.jsx(w,{onClick:()=>x(!1),children:"Đóng"})})]}),N&&e.jsx(le,{title:"Thêm linh kiện",children:e.jsx(de,{color:"primary",sx:{position:"fixed",bottom:16,right:16},onClick:()=>{const n=b.find(t=>t.required&&!t.hasComponent);n&&(j(n.type),x(!0))},children:e.jsx(ge,{})})})]})};export{Me as default};
