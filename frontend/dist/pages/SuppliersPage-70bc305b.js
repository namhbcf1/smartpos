import{e as J,p as ee,j as e,af as ne,W as c,T as i,t as g,Y as W,Z as ae,aj as s,E as o,A as se,ak as z,al as B,am as E,ab as m,ae as te,ap as le,aq as ie,ar as re,as as j,at as t,au as ce,C as oe,V as $,I as F,ax as he,D as de,ay as xe,o as me,v as ue}from"../chunks/mui-core-cd9e8750.js";import{u as ge,r as u}from"../chunks/react-vendor-9ee90314.js";import{a as je}from"../chunks/ui-vendor-11834b8a.js";import{u as pe}from"../chunks/useApiData-60d9f817.js";import{a as S}from"../assets/index-fad1ea34.js";import{B as L,t as ve,T as be,e as fe,ao as ye,aj as Ce,aB as Te,Z as Se,_ as _e}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/utils-vendor-8faa4a85.js";import"../chunks/query-vendor-0e167262.js";const Ee=()=>{ge();const{enqueueSnackbar:x}=je(),R=J(),p=ee(R.breakpoints.down("sm")),[_,A]=u.useState(""),[v,N]=u.useState("all"),[M,I]=u.useState(!1),[h,b]=u.useState(null),[l,f]=u.useState({name:"",contact_person:"",phone:"",email:"",address:"",tax_number:"",notes:"",is_active:!0}),q={search:_||void 0,is_active:v==="all"?void 0:v==="active"},{data:P,pagination:w,isLoading:H,error:k,refetch:y,page:O,limit:Q,handlePageChange:C,handleLimitChange:G}=pe("/suppliers",q),X=n=>{A(n.target.value),C(1)},Z=n=>{N(n),C(1)},K=(n,a)=>{C(a+1)},U=n=>{G(parseInt(n.target.value,10))},D=n=>{n?(b(n),f({name:n.name,contact_person:n.contact_person||"",phone:n.phone||"",email:n.email||"",address:n.address||"",tax_number:n.tax_number||"",notes:n.notes||"",is_active:n.is_active})):(b(null),f({name:"",contact_person:"",phone:"",email:"",address:"",tax_number:"",notes:"",is_active:!0})),I(!0)},T=()=>{I(!1),b(null)},r=(n,a)=>{f(d=>({...d,[n]:a}))},V=async()=>{try{const n=h?`/suppliers/${h.id}`:"/suppliers",a=h?"PUT":"POST",d=h?await S.put(n,l):await S.post(n,l);d.success?(x(h?"Cập nhật nhà cung cấp thành công":"Tạo nhà cung cấp thành công",{variant:"success"}),T(),y()):x(d.message||"Có lỗi xảy ra",{variant:"error"})}catch(n){console.error("Error saving supplier:",n),x("Có lỗi xảy ra khi lưu nhà cung cấp",{variant:"error"})}},Y=async n=>{if(window.confirm(`Bạn có chắc chắn muốn xóa nhà cung cấp "${n.name}"?`))try{const a=await S.delete(`/suppliers/${n.id}`);a.success?(x("Xóa nhà cung cấp thành công",{variant:"success"}),y()):x(a.message||"Có lỗi xảy ra",{variant:"error"})}catch(a){console.error("Error deleting supplier:",a),x("Có lỗi xảy ra khi xóa nhà cung cấp",{variant:"error"})}};return e.jsxs(ne,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(c,{sx:{mb:4},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[e.jsxs(c,{children:[e.jsxs(i,{variant:"h4",component:"h1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,fontSize:{xs:"1.5rem",sm:"2rem"}},children:[e.jsx(L,{sx:{fontSize:"inherit"}}),"Quản lý nhà cung cấp"]}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Quản lý thông tin nhà cung cấp và đối tác"})]}),e.jsxs(c,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(ve,{}),onClick:y,size:p?"small":"medium",children:"Làm mới"}),e.jsx(g,{variant:"contained",startIcon:e.jsx(be,{}),onClick:()=>D(),size:p?"small":"medium",children:"Thêm nhà cung cấp"})]})]}),e.jsx(W,{sx:{mb:3},children:e.jsx(ae,{children:e.jsxs(s,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(s,{item:!0,xs:12,sm:6,md:4,children:e.jsx(o,{fullWidth:!0,placeholder:"Tìm kiếm nhà cung cấp...",value:_,onChange:X,size:"small",InputProps:{startAdornment:e.jsx(se,{position:"start",children:e.jsx(fe,{})})}})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,size:"small",children:[e.jsx(B,{children:"Trạng thái"}),e.jsxs(E,{value:v,label:"Trạng thái",onChange:n=>Z(n.target.value),children:[e.jsx(m,{value:"all",children:"Tất cả"}),e.jsx(m,{value:"active",children:"Đang hoạt động"}),e.jsx(m,{value:"inactive",children:"Ngừng hoạt động"})]})]})})]})})})]}),k&&e.jsx(te,{severity:"error",sx:{mb:3},children:k}),e.jsxs(W,{children:[e.jsx(le,{children:e.jsxs(ie,{children:[e.jsx(re,{children:e.jsxs(j,{children:[e.jsx(t,{children:"Nhà cung cấp"}),e.jsx(t,{sx:{display:{xs:"none",sm:"table-cell"}},children:"Liên hệ"}),e.jsx(t,{sx:{display:{xs:"none",md:"table-cell"}},children:"Thông tin"}),e.jsx(t,{children:"Trạng thái"}),e.jsx(t,{align:"center",children:"Thao tác"})]})}),e.jsx(ce,{children:H?e.jsx(j,{children:e.jsx(t,{colSpan:5,align:"center",children:"Đang tải..."})}):P.length===0?e.jsx(j,{children:e.jsx(t,{colSpan:5,align:"center",children:"Không có nhà cung cấp nào"})}):P.map(n=>e.jsxs(j,{hover:!0,children:[e.jsx(t,{children:e.jsxs(c,{children:[e.jsx(i,{variant:"subtitle2",fontWeight:600,children:n.name}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["ID: ",n.id,n.tax_number&&` | MST: ${n.tax_number}`]}),e.jsxs(c,{sx:{display:{xs:"block",sm:"none"},mt:.5},children:[n.contact_person&&e.jsxs(i,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:["Liên hệ: ",n.contact_person]}),n.phone&&e.jsxs(i,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:["SĐT: ",n.phone]})]})]})}),e.jsx(t,{sx:{display:{xs:"none",sm:"table-cell"}},children:e.jsxs(c,{children:[n.contact_person&&e.jsxs(i,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[e.jsx(L,{sx:{fontSize:16}}),n.contact_person]}),n.phone&&e.jsxs(i,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[e.jsx(ye,{sx:{fontSize:16}}),n.phone]}),n.email&&e.jsxs(i,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ce,{sx:{fontSize:16}}),n.email]})]})}),e.jsx(t,{sx:{display:{xs:"none",md:"table-cell"}},children:n.address&&e.jsxs(i,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Te,{sx:{fontSize:16}}),n.address]})}),e.jsx(t,{children:e.jsx(oe,{label:n.is_active?"Hoạt động":"Ngừng hoạt động",color:n.is_active?"success":"default",size:"small"})}),e.jsx(t,{align:"center",children:e.jsxs(c,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[e.jsx($,{title:"Chỉnh sửa",children:e.jsx(F,{size:"small",onClick:()=>D(n),children:e.jsx(Se,{fontSize:"small"})})}),e.jsx($,{title:"Xóa",children:e.jsx(F,{size:"small",onClick:()=>Y(n),color:"error",children:e.jsx(_e,{fontSize:"small"})})})]})})]},n.id))})]})}),w&&e.jsx(he,{component:"div",count:w.total,page:O-1,onPageChange:K,rowsPerPage:Q,onRowsPerPageChange:U,rowsPerPageOptions:[5,10,25,50],labelRowsPerPage:"Số dòng mỗi trang:",labelDisplayedRows:({from:n,to:a,count:d})=>`${n}-${a} của ${d!==-1?d:`hơn ${a}`}`})]}),e.jsxs(de,{open:M,onClose:T,maxWidth:"md",fullWidth:!0,fullScreen:p,children:[e.jsx(xe,{children:h?"Chỉnh sửa nhà cung cấp":"Thêm nhà cung cấp mới"}),e.jsx(me,{children:e.jsxs(s,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Tên nhà cung cấp *",value:l.name,onChange:n=>r("name",n.target.value),required:!0})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Người liên hệ",value:l.contact_person,onChange:n=>r("contact_person",n.target.value)})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Số điện thoại",value:l.phone,onChange:n=>r("phone",n.target.value)})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Email",type:"email",value:l.email,onChange:n=>r("email",n.target.value)})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{fullWidth:!0,label:"Địa chỉ",value:l.address,onChange:n=>r("address",n.target.value),multiline:!0,rows:2})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Mã số thuế",value:l.tax_number,onChange:n=>r("tax_number",n.target.value)})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(z,{fullWidth:!0,children:[e.jsx(B,{children:"Trạng thái"}),e.jsxs(E,{value:l.is_active,label:"Trạng thái",onChange:n=>r("is_active",n.target.value),children:[e.jsx(m,{value:"active",children:"Hoạt động"}),e.jsx(m,{value:"inactive",children:"Ngừng hoạt động"})]})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{fullWidth:!0,label:"Ghi chú",value:l.notes,onChange:n=>r("notes",n.target.value),multiline:!0,rows:3})})]})}),e.jsxs(ue,{children:[e.jsx(g,{onClick:T,children:"Hủy"}),e.jsx(g,{onClick:V,variant:"contained",disabled:!l.name.trim(),children:h?"Cập nhật":"Tạo mới"})]})]})]})};export{Ee as default};
