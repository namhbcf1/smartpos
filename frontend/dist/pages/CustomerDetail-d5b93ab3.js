import{j as e,W as r,ad as z,ae as p,t as f,I as D,T as n,aj as a,Y as c,Z as l,a8 as L,a3 as $,C as v,ap as K,aq as N,ar as P,as as C,at as i,au as q}from"../chunks/mui-core-cd9e8750.js";import{j as G,u as H,r as h}from"../chunks/react-vendor-9ee90314.js";import{a as M}from"../chunks/ui-vendor-11834b8a.js";import{a as _,d,b as I}from"../assets/index-fad1ea34.js";import{$ as T,Z as R,B as V,a3 as Z,ao as O,aj as Q,aB as U,ae as Y,S as J,a9 as X,an as ee}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/utils-vendor-8faa4a85.js";const le=()=>{const{id:o}=G(),x=H(),{enqueueSnackbar:B}=M(),[s,E]=h.useState(null),[j,S]=h.useState([]),[k,m]=h.useState(!0),[g,u]=h.useState(null);h.useEffect(()=>{o&&A()},[o]);const A=async()=>{try{m(!0),u(null);const t=await _.get(`/customers/${o}`);E(t);const W=await _.get(`/customers/${o}/orders`);S(W||[])}catch(t){console.error("Error fetching customer details:",t),u("Không thể tải thông tin khách hàng"),B("Lỗi khi tải thông tin khách hàng",{variant:"error"})}finally{m(!1)}},F=t=>t>=1e8?{tier:"Kim cương",color:"#E1F5FE"}:t>=5e7?{tier:"Bạch kim",color:"#F3E5F5"}:t>=2e7?{tier:"Vàng",color:"#FFF8E1"}:t>=5e6?{tier:"Bạc",color:"#FAFAFA"}:{tier:"Đồng",color:"#EFEBE9"},w=()=>{x(`/customers/${o}/edit`)},y=()=>{x("/customers")};if(k)return e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(z,{})});if(g||!s)return e.jsxs(r,{sx:{p:3},children:[e.jsx(p,{severity:"error",sx:{mb:2},children:g||"Không tìm thấy thông tin khách hàng"}),e.jsx(f,{startIcon:e.jsx(T,{}),onClick:y,variant:"outlined",children:"Quay lại danh sách"})]});const b=F(s.total_spent);return e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(D,{onClick:y,children:e.jsx(T,{})}),e.jsx(n,{variant:"h4",fontWeight:"bold",children:"Chi tiết khách hàng"})]}),e.jsx(f,{variant:"contained",startIcon:e.jsx(R,{}),onClick:w,children:"Chỉnh sửa"})]}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(c,{children:e.jsxs(l,{children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[e.jsx(L,{sx:{width:80,height:80,mb:2,bgcolor:s.customer_type==="business"?"primary.main":"secondary.main"},children:s.customer_type==="business"?e.jsx(V,{}):e.jsx(Z,{})}),e.jsx(n,{variant:"h5",fontWeight:"bold",textAlign:"center",children:s.full_name}),e.jsx(n,{variant:"body2",color:"text.secondary",textAlign:"center",children:s.customer_type==="business"?"Doanh nghiệp":"Cá nhân"})]}),e.jsx($,{sx:{my:2}}),e.jsxs(r,{sx:{mb:2},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Thông tin liên hệ"}),s.phone&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(O,{fontSize:"small",color:"action"}),e.jsx(n,{variant:"body2",children:s.phone})]}),s.email&&e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Q,{fontSize:"small",color:"action"}),e.jsx(n,{variant:"body2",children:s.email})]}),s.address&&e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:1,mb:1},children:[e.jsx(U,{fontSize:"small",color:"action"}),e.jsxs(n,{variant:"body2",children:[s.address,s.city&&`, ${s.city}`]})]})]}),s.customer_type==="business"&&e.jsxs(r,{sx:{mb:2},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Thông tin doanh nghiệp"}),s.company_name&&e.jsxs(n,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Tên công ty:"})," ",s.company_name]}),s.tax_number&&e.jsxs(n,{variant:"body2",children:[e.jsx("strong",{children:"Mã số thuế:"})," ",s.tax_number]})]}),e.jsxs(r,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Thông tin thành viên"}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(n,{variant:"body2",children:"Hạng thành viên:"}),e.jsx(v,{icon:e.jsx(Y,{}),label:b.tier,size:"small",sx:{bgcolor:b.color}})]}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(n,{variant:"body2",children:"Điểm tích lũy:"}),e.jsxs(n,{variant:"body2",fontWeight:"bold",children:[s.loyalty_points.toLocaleString("vi-VN")," điểm"]})]}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"body2",children:"Ngày tham gia:"}),e.jsx(n,{variant:"body2",children:d(s.created_at)})]})]})]})})}),e.jsxs(a,{item:!0,xs:12,md:8,children:[e.jsxs(a,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(c,{children:e.jsxs(l,{sx:{textAlign:"center"},children:[e.jsx(J,{color:"primary",sx:{fontSize:40,mb:1}}),e.jsx(n,{variant:"h4",fontWeight:"bold",children:s.total_orders}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Tổng đơn hàng"})]})})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(c,{children:e.jsxs(l,{sx:{textAlign:"center"},children:[e.jsx(X,{color:"success",sx:{fontSize:40,mb:1}}),e.jsx(n,{variant:"h4",fontWeight:"bold",children:I(s.total_spent)}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Tổng chi tiêu"})]})})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(c,{children:e.jsxs(l,{sx:{textAlign:"center"},children:[e.jsx(ee,{color:"info",sx:{fontSize:40,mb:1}}),e.jsx(n,{variant:"h6",fontWeight:"bold",children:s.last_order_date?d(s.last_order_date):"Chưa có"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Đơn hàng cuối"})]})})})]}),e.jsx(c,{children:e.jsxs(l,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Đơn hàng gần đây"}),j.length>0?e.jsx(K,{children:e.jsxs(N,{children:[e.jsx(P,{children:e.jsxs(C,{children:[e.jsx(i,{children:"Mã đơn"}),e.jsx(i,{align:"right",children:"Tổng tiền"}),e.jsx(i,{align:"center",children:"Trạng thái"}),e.jsx(i,{align:"center",children:"Ngày tạo"}),e.jsx(i,{align:"center",children:"Sản phẩm"})]})}),e.jsx(q,{children:j.slice(0,10).map(t=>e.jsxs(C,{hover:!0,children:[e.jsx(i,{children:e.jsxs(n,{variant:"body2",fontWeight:"medium",children:["#",t.receipt_number]})}),e.jsx(i,{align:"right",children:e.jsx(n,{variant:"body2",fontWeight:"bold",children:I(t.total_amount)})}),e.jsx(i,{align:"center",children:e.jsx(v,{label:t.payment_status==="paid"?"Đã thanh toán":t.payment_status==="pending"?"Chờ thanh toán":"Đã hủy",color:t.payment_status==="paid"?"success":t.payment_status==="pending"?"warning":"error",size:"small"})}),e.jsx(i,{align:"center",children:e.jsx(n,{variant:"body2",children:d(t.created_at)})}),e.jsx(i,{align:"center",children:e.jsxs(n,{variant:"body2",children:[t.items_count," sản phẩm"]})})]},t.id))})]})}):e.jsx(p,{severity:"info",children:"Khách hàng chưa có đơn hàng nào"})]})}),s.notes&&e.jsx(c,{sx:{mt:2},children:e.jsxs(l,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Ghi chú"}),e.jsx(n,{variant:"body2",children:s.notes})]})})]})]})]})};export{le as default};
