import{j as e,af as u,W as n,ad as W,T as s,an as O,ae as T,t as j,a8 as x,V as $,I as V,P as M,aj as a,E as w,ak as z,al as G,am as K,ab as y,Y as c,Z as d,C as p,L as X,w as Y,a1 as Z,a2 as q,a3 as H}from"../chunks/mui-core-cd9e8750.js";import{r as l,b as J}from"../chunks/react-vendor-9ee90314.js";import{a as Q}from"../assets/index-fad1ea34.js";import{t as A,r as D,ar as U,S as _,P as ee,x as re,aD as se,aF as te,W as ne,aT as ae,p as ie,aM as oe}from"../chunks/mui-icons-f0327ae6.js";import{R as le,g as ce,b as de,X as xe,Y as he,T as me,A as L}from"../chunks/chart-vendor-c17345c1.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/ui-vendor-11834b8a.js";import"../chunks/utils-vendor-8faa4a85.js";const Ie=()=>{const[t,S]=l.useState(null),[N,g]=l.useState(!1),[f,b]=l.useState(null),[v,k]=l.useState(new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0]),[I,E]=l.useState(new Date().toISOString().split("T")[0]),[C,B]=l.useState("all");l.useEffect(()=>{h()},[]);const h=async()=>{g(!0),b(null);try{const r=await Q.get(`/reports/revenue?dateFrom=${v}&dateTo=${I}&store=${C}`);S(r)}catch(r){console.error("Error loading revenue report:",r);const i=r?.response?.data?.message||r?.message||"Lỗi khi tải báo cáo doanh thu";b(i)}finally{g(!1)}},m=r=>r==null||isNaN(r)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r),F=(r,i=1)=>r==null||isNaN(r)?"0":r.toFixed(i),o=r=>r==null||isNaN(r)?0:r,P=r=>{switch(r){case"trend":return e.jsx(oe,{sx:{color:"#4CAF50"}});case"pattern":return e.jsx(ie,{sx:{color:"#2196F3"}});case"opportunity":return e.jsx(ae,{sx:{color:"#FF9800"}});case"warning":return e.jsx(ne,{sx:{color:"#f44336"}});default:return e.jsx(te,{})}},R=r=>{switch(r){case"trend":return"#E8F5E8";case"pattern":return"#E3F2FD";case"opportunity":return"#FFF3E0";case"warning":return"#FFEBEE";default:return"#F5F5F5"}};return N?e.jsx(u,{maxWidth:"xl",sx:{py:4},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:8},children:[e.jsx(W,{size:60,sx:{mb:2}}),e.jsx(s,{variant:"h6",color:"text.secondary",children:"AI đang phân tích dữ liệu doanh thu..."}),e.jsx(O,{sx:{width:"300px",mt:2}})]})}):f?e.jsxs(u,{maxWidth:"xl",sx:{py:4},children:[e.jsx(T,{severity:"error",sx:{mb:3},children:f}),e.jsx(j,{variant:"contained",onClick:h,startIcon:e.jsx(A,{}),children:"Thử lại"})]}):t?e.jsxs(u,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(x,{sx:{bgcolor:"primary.main",mr:2,width:56,height:56},children:e.jsx(D,{fontSize:"large"})}),e.jsxs(n,{children:[e.jsx(s,{variant:"h4",component:"h1",children:"Báo cáo Doanh thu Thông minh"}),e.jsxs(s,{variant:"subtitle1",color:"text.secondary",children:["Phân tích AI • ",t?.summary?.period||"Đang tải..."," • ",o(t?.summary?.daysAnalyzed)," ngày"]})]})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx($,{title:"Làm mới dữ liệu",children:e.jsx(V,{onClick:h,children:e.jsx(A,{})})}),e.jsx(j,{variant:"outlined",startIcon:e.jsx(U,{}),children:"Xuất báo cáo"})]})]}),e.jsxs(M,{sx:{p:3,mb:4},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Bộ lọc báo cáo"}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(w,{fullWidth:!0,label:"Từ ngày",type:"date",value:v,onChange:r=>k(r.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(w,{fullWidth:!0,label:"Đến ngày",type:"date",value:I,onChange:r=>E(r.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsxs(z,{fullWidth:!0,children:[e.jsx(G,{children:"Cửa hàng"}),e.jsxs(K,{value:C,onChange:r=>B(r.target.value),label:"Cửa hàng",children:[e.jsx(y,{value:"all",children:"Tất cả cửa hàng"}),e.jsx(y,{value:"main",children:"Cửa hàng chính"}),e.jsx(y,{value:"branch",children:"Chi nhánh"})]})]})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(j,{fullWidth:!0,variant:"contained",onClick:h,sx:{height:"56px"},children:"Cập nhật báo cáo"})})]})]}),e.jsxs(a,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{children:e.jsxs(d,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(x,{sx:{bgcolor:"#4CAF50",mr:2},children:e.jsx(D,{})}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Tổng doanh thu"}),e.jsx(s,{variant:"h6",children:m(t?.summary?.totalRevenue)})]})]}),e.jsx(p,{label:`${o(t?.summary?.avgGrowth)>0?"+":""}${F(t?.summary?.avgGrowth,1)}%`,color:o(t?.summary?.avgGrowth)>0?"success":"error",size:"small"})]})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{children:e.jsxs(d,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(x,{sx:{bgcolor:"#2196F3",mr:2},children:e.jsx(_,{})}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Tổng đơn hàng"}),e.jsx(s,{variant:"h6",children:o(t?.summary?.totalOrders).toLocaleString("vi-VN")})]})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["TB: ",Math.floor(o(t?.summary?.totalOrders)/o(t?.summary?.daysAnalyzed))," đơn/ngày"]})]})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{children:e.jsxs(d,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(x,{sx:{bgcolor:"#FF9800",mr:2},children:e.jsx(ee,{})}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Khách hàng"}),e.jsx(s,{variant:"h6",children:o(t?.summary?.totalCustomers).toLocaleString("vi-VN")})]})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["AOV: ",m(t?.summary?.avgOrderValue)]})]})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{children:e.jsxs(d,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(x,{sx:{bgcolor:"#9C27B0",mr:2},children:e.jsx(re,{})}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Lợi nhuận"}),e.jsx(s,{variant:"h6",children:m(t?.summary?.totalProfit)})]})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Margin: ",F(t?.summary?.avgProfitMargin,1),"%"]})]})})})]}),e.jsxs(a,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(a,{item:!0,xs:12,lg:8,children:e.jsx(c,{children:e.jsxs(d,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Xu hướng doanh thu theo ngày"}),e.jsx(le,{width:"100%",height:400,children:e.jsxs(ce,{data:t?.dailyData||[],children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(xe,{dataKey:"date"}),e.jsx(he,{}),e.jsx(me,{formatter:(r,i)=>[i==="revenue"?m(Number(r)):r,i==="revenue"?"Doanh thu":i==="orders"?"Đơn hàng":"Lợi nhuận"]}),e.jsx(L,{type:"monotone",dataKey:"revenue",stackId:"1",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6}),e.jsx(L,{type:"monotone",dataKey:"profit",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.6})]})})]})})}),e.jsx(a,{item:!0,xs:12,lg:4,children:e.jsx(c,{sx:{height:"100%"},children:e.jsxs(d,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"AI Insights"}),e.jsx(X,{dense:!0,children:(t?.insights||[]).map((r,i)=>e.jsxs(J.Fragment,{children:[e.jsxs(Y,{sx:{bgcolor:R(r.type),borderRadius:1,mb:1},children:[e.jsx(Z,{children:P(r.type)}),e.jsx(q,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(s,{variant:"subtitle2",children:r.title}),e.jsx(p,{label:`${Math.round(r.confidence*100)}%`,size:"small",color:"primary"})]}),secondary:e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{mb:1},children:r.description}),e.jsxs(s,{variant:"caption",color:"primary",children:["💡 ",r.recommendation]})]})})]}),i<(t?.insights?.length||0)-1&&e.jsx(H,{})]},i))})]})})})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(p,{icon:e.jsx(se,{}),label:`Phân tích bởi AI • Độ tin cậy: ${t?.metadata?.confidenceLevel||"high"} • Cập nhật: ${new Date(t?.metadata?.generatedAt||Date.now()).toLocaleString("vi-VN")}`,variant:"outlined",color:"primary"})})]}):e.jsx(u,{maxWidth:"xl",sx:{py:4},children:e.jsx(T,{severity:"info",children:"Không có dữ liệu báo cáo"})})};export{Ie as default};
