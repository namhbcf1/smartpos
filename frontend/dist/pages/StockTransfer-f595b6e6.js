import{j as e,af as B,T as s,W as o,t as b,Y as F,Z as G,aj as a,aE as O,E as x,A as z,ae as S,ak as I,al as C,am as T,ab as L}from"../chunks/mui-core-cd9e8750.js";import{u as D,r as c}from"../chunks/react-vendor-9ee90314.js";import{b as m,a as Q}from"../assets/index-fad1ea34.js";import{a as K}from"../chunks/ui-vendor-11834b8a.js";import{u as N}from"../chunks/useApiData-60d9f817.js";import{as as q,$ as X,e as H,a4 as W,a0 as M}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/query-vendor-0e167262.js";import"../chunks/utils-vendor-8faa4a85.js";const ne=()=>{const j=D(),{enqueueSnackbar:u}=K(),[n,p]=c.useState(null),[i,y]=c.useState(1),[l,$]=c.useState(1),[h,w]=c.useState(2),[g,f]=c.useState(""),[v,k]=c.useState(!1),{data:E,isLoading:P}=N("/products",{limit:100,is_active:!0}),[d,_]=c.useState([]);c.useEffect(()=>{(async()=>{try{const r=await Q.get("/stores");_(r||[])}catch(r){console.error("Error fetching stores:",r),u("Lỗi khi tải danh sách cửa hàng",{variant:"error"})}})()},[]);const A=async()=>{if(!n||i<=0||l===h){u("Vui lòng kiểm tra lại thông tin chuyển kho",{variant:"warning"});return}if(n.stockQuantity<i){u(`Không đủ tồn kho. Còn lại: ${n.stockQuantity}`,{variant:"error"});return}k(!0);try{const t=await Q.post("/inventory/stock-transfer",{product_id:n.id,quantity:i,from_store_id:l,to_store_id:h,notes:g});u(`Chuyển kho thành công! ${i} ${n.name} đã được chuyển từ ${d.find(r=>r.id===l)?.name} đến ${d.find(r=>r.id===h)?.name}`,{variant:"success",autoHideDuration:5e3}),p(null),y(1),f(""),setTimeout(()=>{j("/inventory")},2e3)}catch(t){console.error("Stock transfer error:",t),u(t instanceof Error?t.message:"Lỗi khi chuyển kho",{variant:"error"})}finally{k(!1)}};return e.jsxs(B,{maxWidth:"md",sx:{py:3},children:[e.jsxs(s,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(q,{}),"Chuyển kho"]}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(s,{variant:"h6",color:"text.secondary",children:"Chuyển sản phẩm giữa các chi nhánh"}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(X,{}),onClick:()=>j("/inventory"),children:"Quay lại"})]}),e.jsx(F,{children:e.jsx(G,{children:e.jsxs(a,{container:!0,spacing:3,children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Chọn sản phẩm"}),e.jsx(O,{options:E||[],getOptionLabel:t=>`${t.name} (${t.sku})`,value:n,onChange:(t,r)=>p(r),renderInput:t=>e.jsx(x,{...t,label:"Chọn sản phẩm cần chuyển",placeholder:"Tìm kiếm sản phẩm...",InputProps:{...t.InputProps,startAdornment:e.jsx(z,{position:"start",children:e.jsx(H,{})})}}),renderOption:(t,r)=>e.jsx(o,{component:"li",...t,children:e.jsxs(o,{children:[e.jsx(s,{variant:"body2",fontWeight:500,children:r.name}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",r.sku," | Danh mục: ",r.categoryName]}),e.jsxs(s,{variant:"caption",display:"block",color:"text.secondary",children:["Tồn kho: ",r.stockQuantity," | Giá: ",m(r.price)]})]})}),loading:P,noOptionsText:"Không tìm thấy sản phẩm"})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx(a,{item:!0,xs:12,children:e.jsxs(S,{severity:"info",children:[e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Sản phẩm:"})," ",n.name," (",n.sku,")"]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Tồn kho hiện tại:"})," ",n.stockQuantity]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Giá:"})," ",m(n.price)]})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(I,{fullWidth:!0,children:[e.jsx(C,{children:"Từ chi nhánh"}),e.jsx(T,{value:l,label:"Từ chi nhánh",onChange:t=>$(t.target.value),children:d.map(t=>e.jsx(L,{value:t.id,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{fontSize:"small"}),e.jsxs(o,{children:[e.jsx(s,{variant:"body2",children:t.name}),e.jsx(s,{variant:"caption",color:"text.secondary",children:t.address})]})]})},t.id))})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(I,{fullWidth:!0,children:[e.jsx(C,{children:"Đến chi nhánh"}),e.jsx(T,{value:h,label:"Đến chi nhánh",onChange:t=>w(t.target.value),children:d.filter(t=>t.id!==l).map(t=>e.jsx(L,{value:t.id,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{fontSize:"small"}),e.jsxs(o,{children:[e.jsx(s,{variant:"body2",children:t.name}),e.jsx(s,{variant:"caption",color:"text.secondary",children:t.address})]})]})},t.id))})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,type:"number",label:"Số lượng chuyển",value:i,onChange:t=>y(parseInt(t.target.value)||0),inputProps:{min:1,max:n.stockQuantity},helperText:`Tối đa: ${n.stockQuantity}`})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Tổng giá trị",value:m(i*n.price),InputProps:{readOnly:!0},variant:"filled"})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Ghi chú",value:g,onChange:t=>f(t.target.value),multiline:!0,rows:3,placeholder:"Lý do chuyển kho, ghi chú đặc biệt..."})}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(S,{severity:"warning",children:[e.jsx(s,{variant:"body2",gutterBottom:!0,children:e.jsx("strong",{children:"Xác nhận chuyển kho:"})}),e.jsxs(s,{variant:"body2",children:["• Chuyển ",i," ",n.name," từ ",d.find(t=>t.id===l)?.name,"đến ",d.find(t=>t.id===h)?.name]}),e.jsxs(s,{variant:"body2",children:["• Tổng giá trị: ",m(i*n.price)]})]})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(o,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(b,{variant:"contained",size:"large",startIcon:e.jsx(M,{}),onClick:A,disabled:v||i<=0||l===h,sx:{minWidth:200},children:v?"Đang xử lý...":"Xác nhận chuyển kho"})})})]})]})})})]})};export{ne as default};
