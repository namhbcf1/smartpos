import{j as e,af as K,T as s,W as t,t as m,Y as E,Z as U,aj as i,E as p,A as V,ak as X,al as G,am as M,ab as l,V as S,I as L,ae as w,ap as H,P as O,aq as Q,ar as Y,as as j,at as n,au as Z,ax as q,C as o}from"../chunks/mui-core-cd9e8750.js";import{u as J,r as c,L as g}from"../chunks/react-vendor-9ee90314.js";import{u as ee}from"../chunks/useApiData-60d9f817.js";import{a as re}from"../chunks/ui-vendor-11834b8a.js";import{b as se}from"../assets/index-fad1ea34.js";import{j as ne,T as ae,as as y,al as F,e as te,t as ie,U as le,at as oe,x as ce}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/utils-vendor-8faa4a85.js";import"../chunks/query-vendor-0e167262.js";const ye=()=>{J(),re();const[d,f]=c.useState(""),[h,b]=c.useState(""),[x,v]=c.useState(""),[u,_]=c.useState(""),$=c.useMemo(()=>{const r={};return d.trim()&&(r.search=d.trim()),h&&(r.transaction_type=h),x&&(r.date_from=x),u&&(r.date_to=u),r},[d,h,x,u]),{data:k,pagination:T,isLoading:W,error:C,refetch:R,handlePageChange:D,handleLimitChange:N,page:z,limit:I}=ee("/inventory/transactions",$),A=(r,a)=>{switch(r){case"stock_in":return e.jsx(o,{icon:e.jsx(ce,{}),label:`Nhập kho (+${a})`,color:"success",size:"small"});case"stock_out":return e.jsx(o,{icon:e.jsx(oe,{}),label:`Xuất kho (-${a})`,color:"error",size:"small"});case"transfer_in":return e.jsx(o,{icon:e.jsx(y,{}),label:`Chuyển đến (+${a})`,color:"info",size:"small"});case"transfer_out":return e.jsx(o,{icon:e.jsx(y,{}),label:`Chuyển đi (-${a})`,color:"warning",size:"small"});case"adjustment":return e.jsx(o,{icon:e.jsx(F,{}),label:`Điều chỉnh (${a>0?"+":""}${a})`,color:"secondary",size:"small"});default:return e.jsx(o,{label:r,size:"small"})}},B=()=>{f(""),b(""),v(""),_("")};return e.jsxs(K,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(s,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{}),"Lịch sử giao dịch kho"]}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(s,{variant:"h6",color:"text.secondary",children:"Theo dõi mọi thay đổi tồn kho"}),e.jsxs(t,{sx:{display:"flex",gap:1},children:[e.jsx(m,{variant:"outlined",startIcon:e.jsx(ae,{}),component:g,to:"/inventory/stock-in",children:"Nhập kho"}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(y,{}),component:g,to:"/inventory/transfer",children:"Chuyển kho"}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(F,{}),component:g,to:"/inventory/check",children:"Kiểm kê"})]})]}),e.jsx(E,{sx:{mb:3},children:e.jsx(U,{children:e.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(i,{item:!0,xs:12,md:3,children:e.jsx(p,{fullWidth:!0,label:"Tìm kiếm",placeholder:"Tên sản phẩm, SKU, số tham chiếu...",value:d,onChange:r=>f(r.target.value),InputProps:{startAdornment:e.jsx(V,{position:"start",children:e.jsx(te,{})})}})}),e.jsx(i,{item:!0,xs:12,md:2,children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(G,{children:"Loại giao dịch"}),e.jsxs(M,{value:h,label:"Loại giao dịch",onChange:r=>b(r.target.value),children:[e.jsx(l,{value:"",children:"Tất cả"}),e.jsx(l,{value:"stock_in",children:"Nhập kho"}),e.jsx(l,{value:"stock_out",children:"Xuất kho"}),e.jsx(l,{value:"transfer_in",children:"Chuyển đến"}),e.jsx(l,{value:"transfer_out",children:"Chuyển đi"}),e.jsx(l,{value:"adjustment",children:"Điều chỉnh"})]})]})}),e.jsx(i,{item:!0,xs:12,md:2,children:e.jsx(p,{fullWidth:!0,type:"date",label:"Từ ngày",value:x,onChange:r=>v(r.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(i,{item:!0,xs:12,md:2,children:e.jsx(p,{fullWidth:!0,type:"date",label:"Đến ngày",value:u,onChange:r=>_(r.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(i,{item:!0,xs:12,md:3,children:e.jsxs(t,{sx:{display:"flex",gap:1},children:[e.jsx(S,{title:"Làm mới",children:e.jsx(L,{onClick:R,children:e.jsx(ie,{})})}),e.jsx(S,{title:"Xóa bộ lọc",children:e.jsx(L,{onClick:B,children:e.jsx(le,{})})})]})})]})})}),C&&e.jsx(w,{severity:"error",sx:{mb:2},children:C}),e.jsxs(H,{component:O,children:[e.jsxs(Q,{children:[e.jsx(Y,{children:e.jsxs(j,{children:[e.jsx(n,{children:"Sản phẩm"}),e.jsx(n,{children:"Loại giao dịch"}),e.jsx(n,{align:"right",children:"Số lượng"}),e.jsx(n,{align:"right",children:"Giá trị"}),e.jsx(n,{children:"Tham chiếu"}),e.jsx(n,{children:"Ngày"})]})}),e.jsx(Z,{children:W?Array.from({length:I}).map((r,a)=>e.jsx(j,{children:e.jsx(n,{colSpan:6,children:e.jsx(t,{sx:{display:"flex",alignItems:"center",gap:2},children:e.jsx(t,{sx:{width:"100%",height:40,bgcolor:"grey.200",borderRadius:1}})})})},a)):k.length>0?k.map(r=>e.jsxs(j,{hover:!0,children:[e.jsx(n,{children:e.jsxs(t,{children:[e.jsx(s,{variant:"body2",fontWeight:500,children:r.product_name}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["SKU: ",r.product_sku]}),r.category_name&&e.jsx(s,{variant:"caption",display:"block",color:"text.secondary",children:r.category_name})]})}),e.jsx(n,{children:A(r.transaction_type,r.quantity)}),e.jsx(n,{align:"right",children:e.jsxs(s,{variant:"body2",fontWeight:600,color:["stock_in","transfer_in"].includes(r.transaction_type)?"success.main":["stock_out","transfer_out"].includes(r.transaction_type)?"error.main":"text.primary",children:[["stock_in","transfer_in"].includes(r.transaction_type)?"+":["stock_out","transfer_out"].includes(r.transaction_type)?"-":"",r.quantity]})}),e.jsx(n,{align:"right",children:r.cost_price?e.jsx(s,{variant:"body2",color:"primary.main",children:se(r.cost_price*r.quantity)}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(n,{children:e.jsxs(t,{children:[r.reference_number&&e.jsx(s,{variant:"body2",fontWeight:500,children:r.reference_number}),r.supplier_name&&e.jsx(s,{variant:"caption",color:"text.secondary",children:r.supplier_name}),r.notes&&e.jsx(s,{variant:"caption",display:"block",color:"text.secondary",children:r.notes})]})}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",children:new Date(r.created_at).toLocaleDateString("vi-VN")}),e.jsx(s,{variant:"caption",color:"text.secondary",children:new Date(r.created_at).toLocaleTimeString("vi-VN")})]})]},r.id)):e.jsx(j,{children:e.jsx(n,{colSpan:6,align:"center",children:e.jsx(w,{severity:"info",sx:{border:"none"},children:e.jsx(s,{children:"Không tìm thấy giao dịch kho nào."})})})})})]}),T&&e.jsx(q,{component:"div",count:T.total,page:z-1,onPageChange:(r,a)=>D(a+1),rowsPerPage:I,onRowsPerPageChange:r=>N(parseInt(r.target.value)),rowsPerPageOptions:[10,25,50,100],labelRowsPerPage:"Số dòng mỗi trang:",labelDisplayedRows:({from:r,to:a,count:P})=>`${r}-${a} của ${P!==-1?P:`hơn ${a}`}`})]})]})};export{ye as default};
