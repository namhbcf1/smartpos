import{e as J,p as ee,j as e,W as i,$ as _,T as t,t as j,aj as d,Y as Q,Z as X,C,E as R,A as q,ak as D,al as L,am as M,ab as l,a0 as Ee,I as ge,a8 as Ve,ap as Ne,P as $e,aq as He,ar as Ke,as as G,at as u,au as Fe,aa as qe,af as je,ae as pe,a3 as Ge,ad as Oe,ax as Qe,D as ye,ay as be,o as ve,v as _e}from"../chunks/mui-core-cd9e8750.js";import{r as m,b as U,u as Xe}from"../chunks/react-vendor-9ee90314.js";import{a as Ue}from"../chunks/ui-vendor-11834b8a.js";import{u as Ye}from"../chunks/useApiData-60d9f817.js";import{b as B,d as fe,e as Ze,a as V}from"../assets/index-fad1ea34.js";import{i as Y,S as Je,y as N,t as en,a1 as nn,a2 as tn,T as an,x as sn,e as rn,U as on,c as ln,d as cn,a3 as Se,a4 as dn,b as hn,a5 as Ce,w as xn,a6 as we,Q as O,Y as un,a as mn,l as Z,a7 as gn,a8 as Te,a9 as jn}from"../chunks/mui-icons-f0327ae6.js";import"../chunks/utils-vendor-8faa4a85.js";import"../chunks/query-vendor-0e167262.js";function pn(n,h){const[c,p]=m.useState(n);return m.useEffect(()=>{const w=setTimeout(()=>{p(n)},h);return()=>{clearTimeout(w)}},[n,h]),c}const yn=({summary:n,onNewSale:h,onExport:c,onRefresh:p,onAnalytics:w,loading:b})=>{const y=J(),g=ee(y.breakpoints.down("sm")),S=[{title:"Hôm nay",sales:n?.today?.sales_count||0,amount:n?.today?.total_amount||0,average:n?.today?.average_sale||0,growth:n?.growth_rates?.daily||0,icon:e.jsx(Y,{}),color:"primary"},{title:"Tuần này",sales:n?.this_week?.sales_count||0,amount:n?.this_week?.total_amount||0,average:n?.this_week?.average_sale||0,growth:n?.growth_rates?.weekly||0,icon:e.jsx(Je,{}),color:"success"},{title:"Tháng này",sales:n?.this_month?.sales_count||0,amount:n?.this_month?.total_amount||0,average:n?.this_month?.average_sale||0,growth:n?.growth_rates?.monthly||0,icon:e.jsx(N,{}),color:"info"}];return e.jsxs(i,{sx:{mb:3},children:[e.jsxs(_,{direction:g?"column":"row",justifyContent:"space-between",alignItems:g?"stretch":"center",spacing:2,sx:{mb:3},children:[e.jsxs(i,{children:[e.jsxs(t,{variant:"h4",component:"h1",gutterBottom:!0,children:[e.jsx(Y,{sx:{mr:1,verticalAlign:"middle"}}),"Lịch sử bán hàng"]}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Theo dõi và quản lý tất cả các giao dịch bán hàng"})]}),e.jsxs(_,{direction:g?"column":"row",spacing:1,children:[e.jsx(j,{startIcon:e.jsx(en,{}),onClick:p,variant:"outlined",disabled:b,size:g?"small":"medium",children:"Làm mới"}),e.jsx(j,{startIcon:e.jsx(nn,{}),onClick:w,variant:"outlined",disabled:b,size:g?"small":"medium",children:"Phân tích"}),e.jsx(j,{startIcon:e.jsx(tn,{}),onClick:c,variant:"outlined",disabled:b,size:g?"small":"medium",children:"Xuất báo cáo"}),e.jsx(j,{startIcon:e.jsx(an,{}),onClick:h,variant:"contained",disabled:b,size:g?"small":"medium",children:"Bán hàng mới"})]})]}),e.jsx(d,{container:!0,spacing:2,children:S.map((x,T)=>e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Q,{sx:{background:`linear-gradient(135deg, ${y.palette[x.color].light}, ${y.palette[x.color].main})`,color:"white",height:"100%"},children:e.jsxs(X,{children:[e.jsxs(_,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(i,{sx:{p:1,borderRadius:2,bgcolor:"rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:x.icon}),e.jsxs(i,{sx:{flexGrow:1},children:[e.jsx(t,{variant:"body2",sx:{opacity:.9},children:x.title}),e.jsxs(t,{variant:"h5",fontWeight:"bold",children:[x.sales," đơn"]}),e.jsx(t,{variant:"h6",fontWeight:"bold",children:B(x.amount)})]})]}),e.jsx(i,{sx:{mt:2},children:e.jsxs(_,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(t,{variant:"body2",sx:{opacity:.9},children:["TB: ",B(x.average)]}),e.jsx(C,{icon:e.jsx(sn,{}),label:`${x.growth>0?"+":""}${x.growth.toFixed(1)}%`,size:"small",sx:{bgcolor:x.growth>0?"rgba(76, 175, 80, 0.3)":"rgba(244, 67, 54, 0.3)",color:"white",fontWeight:"bold"}})]})})]})})},T))}),n&&e.jsx(i,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:2},children:e.jsxs(_,{direction:"row",spacing:4,flexWrap:"wrap",children:[e.jsxs(i,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"So với hôm qua"}),e.jsxs(_,{direction:"row",alignItems:"center",spacing:1,children:[e.jsxs(t,{variant:"body1",fontWeight:"medium",children:[n?.today?.sales_count||0," vs ",n?.yesterday?.sales_count||0]}),e.jsx(C,{label:`${(n?.growth_rates?.daily||0)>0?"+":""}${(n?.growth_rates?.daily||0).toFixed(1)}%`,color:(n?.growth_rates?.daily||0)>0?"success":"error",size:"small"})]})]}),e.jsxs(i,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Doanh thu hôm qua"}),e.jsx(t,{variant:"body1",fontWeight:"medium",children:B(n?.yesterday?.total_amount||0)})]}),e.jsxs(i,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Đơn hàng TB/ngày (tuần)"}),e.jsxs(t,{variant:"body1",fontWeight:"medium",children:[Math.round((n?.this_week?.sales_count||0)/7)," đơn"]})]})]})})]})},bn=({filters:n,onFiltersChange:h,cashiers:c,stores:p,onClearFilters:w})=>{const b=J(),y=ee(b.breakpoints.down("sm")),[g,S]=U.useState(!1),x=s=>{h({...n,search:s.target.value})},T=s=>{h({...n,payment_status:s.target.value})},z=s=>{h({...n,payment_method:s.target.value})},f=s=>{h({...n,status:s.target.value})},I=s=>{h({...n,cashier_id:s.target.value||void 0})},P=s=>{h({...n,store_id:s.target.value||void 0})},W=(s,A)=>{h({...n,date_range:{...n.date_range,[s]:A}})},v=(s,A)=>{h({...n,amount_range:{...n.amount_range,[s]:parseFloat(A)||0}})},a=(()=>{let s=0;return n.search&&s++,n.payment_status!=="all"&&s++,n.payment_method!=="all"&&s++,n.status!=="all"&&s++,n.cashier_id&&s++,n.store_id&&s++,(n.date_range.start||n.date_range.end)&&s++,(n.amount_range.min>0||n.amount_range.max<999999999)&&s++,s})();return e.jsxs(i,{sx:{mb:3},children:[e.jsxs(_,{direction:y?"column":"row",spacing:2,alignItems:y?"stretch":"center",sx:{mb:2},children:[e.jsx(R,{placeholder:"Tìm kiếm theo mã đơn, khách hàng, thu ngân...",value:n.search,onChange:x,InputProps:{startAdornment:e.jsx(q,{position:"start",children:e.jsx(rn,{})})},sx:{flexGrow:1,minWidth:y?"auto":300},size:"small"}),e.jsxs(D,{size:"small",sx:{minWidth:150},children:[e.jsx(L,{children:"Trạng thái thanh toán"}),e.jsxs(M,{value:n.payment_status,onChange:T,label:"Trạng thái thanh toán",children:[e.jsx(l,{value:"all",children:"Tất cả"}),e.jsx(l,{value:"paid",children:"Đã thanh toán"}),e.jsx(l,{value:"pending",children:"Chờ thanh toán"}),e.jsx(l,{value:"partial",children:"Thanh toán một phần"}),e.jsx(l,{value:"refunded",children:"Đã hoàn tiền"}),e.jsx(l,{value:"cancelled",children:"Đã hủy"})]})]}),e.jsxs(D,{size:"small",sx:{minWidth:150},children:[e.jsx(L,{children:"Phương thức"}),e.jsxs(M,{value:n.payment_method,onChange:z,label:"Phương thức",children:[e.jsx(l,{value:"all",children:"Tất cả"}),e.jsx(l,{value:"cash",children:"Tiền mặt"}),e.jsx(l,{value:"card",children:"Thẻ"}),e.jsx(l,{value:"bank_transfer",children:"Chuyển khoản"}),e.jsx(l,{value:"e_wallet",children:"Ví điện tử"}),e.jsx(l,{value:"multiple",children:"Nhiều phương thức"})]})]}),e.jsxs(j,{startIcon:e.jsx(on,{}),endIcon:g?e.jsx(ln,{}):e.jsx(cn,{}),onClick:()=>S(!g),variant:"outlined",size:"small",children:["Bộ lọc ",a>0&&e.jsx(C,{label:a,size:"small",color:"primary",sx:{ml:1}})]}),a>0&&e.jsx(j,{startIcon:e.jsx(hn,{}),onClick:w,variant:"text",size:"small",color:"error",children:"Xóa bộ lọc"})]}),e.jsx(Ee,{in:g,children:e.jsx(i,{sx:{p:2,bgcolor:"background.paper",borderRadius:2,border:1,borderColor:"divider"},children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{label:"Từ ngày",type:"date",value:n.date_range.start||"",onChange:s=>W("start",s.target.value),InputLabelProps:{shrink:!0},size:"small",fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{label:"Đến ngày",type:"date",value:n.date_range.end||"",onChange:s=>W("end",s.target.value),InputLabelProps:{shrink:!0},size:"small",fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{label:"Số tiền từ",type:"number",value:n.amount_range.min||"",onChange:s=>v("min",s.target.value),InputProps:{startAdornment:e.jsx(q,{position:"start",children:e.jsx(N,{})})},size:"small",fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{label:"Số tiền đến",type:"number",value:n.amount_range.max===999999999?"":n.amount_range.max,onChange:s=>v("max",s.target.value||"999999999"),InputProps:{startAdornment:e.jsx(q,{position:"start",children:e.jsx(N,{})})},size:"small",fullWidth:!0})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(D,{size:"small",fullWidth:!0,children:[e.jsx(L,{children:"Trạng thái đơn hàng"}),e.jsxs(M,{value:n.status,onChange:f,label:"Trạng thái đơn hàng",children:[e.jsx(l,{value:"all",children:"Tất cả"}),e.jsx(l,{value:"draft",children:"Nháp"}),e.jsx(l,{value:"completed",children:"Hoàn thành"}),e.jsx(l,{value:"cancelled",children:"Đã hủy"}),e.jsx(l,{value:"refunded",children:"Đã hoàn tiền"})]})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(D,{size:"small",fullWidth:!0,children:[e.jsx(L,{children:"Thu ngân"}),e.jsxs(M,{value:n.cashier_id||"",onChange:I,label:"Thu ngân",startAdornment:e.jsx(Se,{sx:{mr:1}}),children:[e.jsx(l,{value:"",children:"Tất cả"}),Array.isArray(c)?c.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id)):null]})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(D,{size:"small",fullWidth:!0,children:[e.jsx(L,{children:"Cửa hàng"}),e.jsxs(M,{value:n.store_id||"",onChange:P,label:"Cửa hàng",startAdornment:e.jsx(dn,{sx:{mr:1}}),children:[e.jsx(l,{value:"",children:"Tất cả"}),Array.isArray(p)?p.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id)):null]})]})})]})})})]})},vn=({sales:n,onViewDetails:h,onPrintReceipt:c,onRefund:p,loading:w})=>{const b=J(),y=ee(b.breakpoints.down("md")),[g,S]=U.useState(null),[x,T]=U.useState(null),z=(a,s)=>{S(a.currentTarget),T(s)},f=()=>{S(null),T(null)},I=a=>{switch(a){case"paid":return"success";case"pending":return"warning";case"partial":return"info";case"refunded":return"secondary";case"cancelled":return"error";default:return"default"}},P=a=>{switch(a){case"paid":return"Đã thanh toán";case"pending":return"Chờ thanh toán";case"partial":return"Thanh toán một phần";case"refunded":return"Đã hoàn tiền";case"cancelled":return"Đã hủy";default:return"Không xác định"}},W=a=>{switch(a){case"paid":return e.jsx(mn,{});case"pending":return e.jsx(O,{});case"partial":return e.jsx(O,{});case"refunded":return e.jsx(we,{});case"cancelled":return e.jsx(un,{});default:return e.jsx(O,{})}},v=a=>{switch(a){case"cash":return e.jsx(N,{});case"card":return e.jsx(Te,{});case"bank_transfer":return e.jsx(gn,{});case"e_wallet":return e.jsx(Z,{});case"qr":return e.jsx(Z,{});default:return e.jsx(N,{})}},k=a=>{switch(a){case"cash":return"Tiền mặt";case"card":return"Thẻ";case"bank_transfer":return"Chuyển khoản";case"e_wallet":return"Ví điện tử";case"qr":return"QR Code";case"multiple":return"Nhiều phương thức";default:return"Không xác định"}};return y?e.jsx(i,{children:Array.isArray(n)?n.map(a=>e.jsx(Q,{sx:{mb:2},children:e.jsx(X,{children:e.jsxs(_,{spacing:2,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(i,{children:[e.jsxs(t,{variant:"subtitle1",fontWeight:"bold",children:["#",a.receipt_number]}),e.jsx(t,{variant:"body2",color:"text.secondary",children:fe(a.sale_date)})]}),e.jsx(ge,{onClick:s=>z(s,a),size:"small",children:e.jsx(Ce,{})})]}),e.jsx(_,{direction:"row",spacing:2,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ve,{sx:{width:24,height:24},children:e.jsx(Se,{fontSize:"small"})}),e.jsxs(i,{children:[e.jsx(t,{variant:"body2",fontWeight:"medium",children:a.customer_name||"Khách lẻ"}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:["Thu ngân: ",a.cashier_name||"Chưa có thông tin"]})]})]})}),e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[e.jsxs(i,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Tổng tiền"}),e.jsx(t,{variant:"h6",fontWeight:"bold",color:"primary",children:B(a.total_amount)})]}),e.jsxs(i,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Số sản phẩm"}),e.jsxs(t,{variant:"body1",fontWeight:"bold",children:[a.items_count," sản phẩm"]})]})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(C,{icon:W(a.payment_status),label:P(a.payment_status),color:I(a.payment_status),size:"small"}),e.jsx(C,{icon:v(a.payment_method),label:k(a.payment_method),variant:"outlined",size:"small"})]}),e.jsxs(_,{direction:"row",spacing:1,children:[e.jsx(j,{size:"small",variant:"outlined",onClick:()=>h(a),fullWidth:!0,children:"Xem chi tiết"}),e.jsx(j,{size:"small",variant:"contained",onClick:()=>c(a),fullWidth:!0,children:"In hóa đơn"})]})]})})},a.id)):e.jsx(Q,{children:e.jsx(X,{children:e.jsx(t,{align:"center",color:"text.secondary",children:"Không có dữ liệu bán hàng"})})})}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{component:$e,children:e.jsxs(He,{children:[e.jsx(Ke,{children:e.jsxs(G,{children:[e.jsx(u,{children:"Mã đơn hàng"}),e.jsx(u,{children:"Khách hàng"}),e.jsx(u,{children:"Thu ngân"}),e.jsx(u,{align:"right",children:"Tổng tiền"}),e.jsx(u,{align:"center",children:"Sản phẩm"}),e.jsx(u,{align:"center",children:"Thanh toán"}),e.jsx(u,{align:"center",children:"Phương thức"}),e.jsx(u,{children:"Thời gian"}),e.jsx(u,{align:"center",children:"Thao tác"})]})}),e.jsx(Fe,{children:Array.isArray(n)&&n.length>0?n.map(a=>e.jsxs(G,{hover:!0,children:[e.jsx(u,{children:e.jsxs(t,{variant:"body2",fontWeight:"medium",children:["#",a.receipt_number]})}),e.jsx(u,{children:e.jsxs(i,{children:[e.jsx(t,{variant:"body2",fontWeight:"medium",children:a.customer_name||"Khách lẻ"}),a.customer_phone&&e.jsx(t,{variant:"caption",color:"text.secondary",children:a.customer_phone})]})}),e.jsx(u,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:a.cashier_name||"Chưa có thông tin"})}),e.jsxs(u,{align:"right",children:[e.jsx(t,{variant:"body2",fontWeight:"bold",color:"primary",children:B(a.total_amount)}),a.discount_amount>0&&e.jsxs(t,{variant:"caption",color:"secondary",children:["Giảm: ",B(a.discount_amount)]})]}),e.jsx(u,{align:"center",children:e.jsx(t,{variant:"body2",children:a.items_count})}),e.jsx(u,{align:"center",children:e.jsx(C,{icon:W(a.payment_status),label:P(a.payment_status),color:I(a.payment_status),size:"small"})}),e.jsx(u,{align:"center",children:e.jsx(C,{icon:v(a.payment_method),label:k(a.payment_method),variant:"outlined",size:"small"})}),e.jsx(u,{children:e.jsxs(i,{children:[e.jsx(t,{variant:"body2",children:Ze(a.sale_date)}),e.jsxs(t,{variant:"caption",color:"text.secondary",children:[fe(a.sale_date).split(" ").slice(-1)[0]," "]})]})}),e.jsx(u,{align:"center",children:e.jsx(ge,{onClick:s=>z(s,a),size:"small",children:e.jsx(Ce,{})})})]},a.id)):e.jsx(G,{children:e.jsx(u,{colSpan:8,align:"center",children:e.jsx(t,{color:"text.secondary",children:"Không có dữ liệu bán hàng"})})})})]})}),e.jsxs(qe,{anchorEl:g,open:!!g,onClose:f,children:[e.jsxs(l,{onClick:()=>{x&&h(x),f()},children:[e.jsx(xn,{sx:{mr:1}}),"Xem chi tiết"]}),e.jsxs(l,{onClick:()=>{x&&c(x),f()},children:[e.jsx(Y,{sx:{mr:1}}),"In hóa đơn"]}),x?.payment_status==="paid"&&e.jsxs(l,{onClick:()=>{x&&p(x),f()},sx:{color:"warning.main"},children:[e.jsx(we,{sx:{mr:1}}),"Hoàn tiền"]})]})]})},Pn=()=>{const n=Xe(),{enqueueSnackbar:h}=Ue(),[c,p]=m.useState({search:"",date_range:{start:void 0,end:void 0},payment_status:"all",payment_method:"all",status:"all",amount_range:{min:0,max:999999999}}),w=pn(c.search,500),[b,y]=m.useState(null),g={today:{sales_count:0,total_amount:0,average_sale:0},yesterday:{sales_count:0,total_amount:0,average_sale:0},this_week:{sales_count:0,total_amount:0,average_sale:0},this_month:{sales_count:0,total_amount:0,average_sale:0},growth_rates:{daily:0,weekly:0,monthly:0}},[S,x]=m.useState([]),[T,z]=m.useState([]),[f,I]=m.useState(0),[P,W]=m.useState(25),[v,k]=m.useState(!1),[a]=m.useState(null),[s,A]=m.useState(!1),[Ie,$]=m.useState(!1),[r,ne]=m.useState(null),[K,te]=m.useState(0),[H,ae]=m.useState(""),[se,re]=m.useState("cash"),{data:ie,isLoading:F,error:oe,refetch:le,pagination:ke}=Ye("/sales",{page:f+1,limit:P,search:w,payment_status:c.payment_status!=="all"?c.payment_status:void 0,payment_method:c.payment_method!=="all"?c.payment_method:void 0,sale_status:c.status!=="all"?c.status:void 0,user_id:c.cashier_id,store_id:c.store_id,date_from:c.date_range.start,date_to:c.date_range.end,min_amount:c.amount_range.min>0?c.amount_range.min:void 0,max_amount:c.amount_range.max<999999999?c.amount_range.max:void 0,sort_by:"created_at",sort_order:"desc"});m.useEffect(()=>{ce(),de(),he()},[]);const ce=async()=>{try{const o=await V.get("/sales/summary");y(o)}catch{}},de=async()=>{try{const o=await V.get("/users?role=cashier");x(o||[])}catch{}},he=async()=>{try{const o=await V.get("/stores");z(o||[])}catch{}},Pe=()=>{n("/new-sale-simple")},We=o=>{ne(o),A(!0)},xe=async o=>{try{k(!0),await V.post(`/sales/${o.id}/print-receipt`),h("Đã gửi lệnh in hóa đơn",{variant:"success"})}catch{h("Lỗi khi in hóa đơn",{variant:"error"})}finally{k(!1)}},Ae=o=>{ne(o),te(o.total_amount),ae(""),re("cash"),$(!0)},Re=async()=>{if(!r||!H.trim()){h("Vui lòng nhập lý do hoàn tiền",{variant:"error"});return}try{k(!0);const o={sale_id:r.id,refund_amount:K,refund_method:se,reason:H,notes:`Hoàn tiền đơn hàng #${r.receipt_number}`};await V.post(`/sales/${r.id}/refund`,o),h("Hoàn tiền thành công",{variant:"success"}),$(!1),le()}catch{h("Lỗi khi hoàn tiền",{variant:"error"})}finally{k(!1)}},ze=()=>{h("Chức năng xuất báo cáo sẽ được triển khai sớm",{variant:"info"})},De=()=>{n("/reports/sales-analytics")},ue=()=>{le(),ce(),de(),he()},Le=()=>{p({search:"",date_range:{start:void 0,end:void 0},payment_status:"all",payment_method:"all",status:"all",cashier_id:void 0,store_id:void 0,amount_range:{min:0,max:999999999}}),I(0)},Me=(o,E)=>{I(E)},Be=o=>{W(parseInt(o.target.value,10)),I(0)};return a||oe?e.jsxs(je,{maxWidth:"xl",sx:{py:3},children:[e.jsx(pe,{severity:"error",sx:{mb:2},children:a||oe}),e.jsx(j,{onClick:ue,variant:"contained",children:"Thử lại"})]}):e.jsxs(je,{maxWidth:"xl",sx:{py:3},"data-testid":"sales-list",children:[e.jsx(yn,{summary:b||g,onNewSale:Pe,onExport:ze,onRefresh:ue,onAnalytics:De,loading:v||F}),e.jsx(Ge,{sx:{my:3}}),e.jsx(bn,{filters:c,onFiltersChange:p,cashiers:S,stores:T,onClearFilters:Le}),F&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Oe,{})}),!F&&Array.isArray(ie)&&e.jsxs(e.Fragment,{children:[e.jsx(vn,{sales:ie,onViewDetails:We,onPrintReceipt:xe,onRefund:Ae,loading:v}),e.jsx(Qe,{component:"div",count:ke?.total||0,page:f,onPageChange:Me,rowsPerPage:P,onRowsPerPageChange:Be,rowsPerPageOptions:[10,25,50,100],labelRowsPerPage:"Số dòng mỗi trang:",labelDisplayedRows:({from:o,to:E,count:me})=>`${o}-${E} của ${me!==-1?me:`hơn ${E}`}`})]}),e.jsxs(ye,{open:s,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(be,{children:["Chi tiết đơn hàng #",r?.receipt_number]}),e.jsx(ve,{children:r&&e.jsx(i,{sx:{p:2},children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Thông tin đơn hàng"}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Mã đơn hàng"}),e.jsxs(t,{variant:"body1",fontWeight:"medium",children:["#",r.receipt_number]})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Ngày tạo"}),e.jsx(t,{variant:"body1",children:new Date(r.created_at).toLocaleString("vi-VN")})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Thu ngân"}),e.jsx(t,{variant:"body1",children:r.cashier_name||"Chưa có thông tin"})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Trạng thái"}),e.jsx(C,{label:r.payment_status==="paid"?"Đã thanh toán":r.payment_status==="pending"?"Chờ thanh toán":r.payment_status==="partial"?"Thanh toán một phần":r.payment_status==="refunded"?"Đã hoàn tiền":"Đã hủy",color:r.payment_status==="paid"?"success":r.payment_status==="pending"?"warning":r.payment_status==="partial"?"info":"error",size:"small"})]})]}),e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Thông tin khách hàng"}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Tên khách hàng"}),e.jsx(t,{variant:"body1",children:r.customer_name||"Khách lẻ"})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Số điện thoại"}),e.jsx(t,{variant:"body1",children:r.customer_phone||"Chưa có thông tin"})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Email"}),e.jsx(t,{variant:"body1",children:r.customer_email||"Chưa có thông tin"})]})]}),e.jsxs(d,{item:!0,xs:12,children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Thông tin thanh toán"}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:6,sm:3,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Tạm tính"}),e.jsxs(t,{variant:"h6",children:[(r.subtotal||0).toLocaleString("vi-VN")," ₫"]})]})}),e.jsx(d,{item:!0,xs:6,sm:3,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Giảm giá"}),e.jsxs(t,{variant:"h6",color:"error",children:["-",(r.discount_amount||0).toLocaleString("vi-VN")," ₫"]})]})}),e.jsx(d,{item:!0,xs:6,sm:3,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Thuế"}),e.jsxs(t,{variant:"h6",children:[(r.tax_amount||0).toLocaleString("vi-VN")," ₫"]})]})}),e.jsx(d,{item:!0,xs:6,sm:3,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"primary.main",borderRadius:1},children:[e.jsx(t,{variant:"body2",color:"white",children:"Tổng cộng"}),e.jsxs(t,{variant:"h6",color:"white",fontWeight:"bold",children:[(r.total_amount||0).toLocaleString("vi-VN")," ₫"]})]})})]})]}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Phương thức thanh toán:"}),e.jsx(C,{icon:r.payment_method==="cash"?e.jsx(jn,{}):r.payment_method==="card"?e.jsx(Te,{}):e.jsx(Z,{}),label:r.payment_method==="cash"?"Tiền mặt":r.payment_method==="card"?"Thẻ":r.payment_method==="bank_transfer"?"Chuyển khoản":r.payment_method==="e_wallet"?"Ví điện tử":"QR Code",variant:"outlined",size:"small"})]})}),r.notes&&e.jsxs(d,{item:!0,xs:12,children:[e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Ghi chú"}),e.jsx(t,{variant:"body1",children:r.notes})]})]})})}),e.jsxs(_e,{children:[e.jsx(j,{onClick:()=>A(!1),children:"Đóng"}),r&&e.jsx(j,{onClick:()=>xe(r),variant:"contained",children:"In hóa đơn"})]})]}),e.jsxs(ye,{open:Ie,onClose:()=>$(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(be,{children:["Hoàn tiền đơn hàng #",r?.receipt_number]}),e.jsx(ve,{children:r&&e.jsxs(i,{sx:{pt:2},children:[e.jsx(pe,{severity:"warning",sx:{mb:3},children:"Hành động hoàn tiền không thể hoàn tác. Vui lòng kiểm tra kỹ thông tin trước khi xác nhận."}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Thông tin đơn hàng"}),e.jsxs(i,{sx:{p:2,bgcolor:"grey.50",borderRadius:1,mb:2},children:[e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Mã đơn hàng: #",r.receipt_number]}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Tổng tiền: ",r.total_amount.toLocaleString("vi-VN")," ₫"]}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Khách hàng: ",r.customer_name||"Khách lẻ"]})]})]}),e.jsx(d,{item:!0,xs:12,children:e.jsx(R,{fullWidth:!0,label:"Số tiền hoàn",type:"number",value:K,onChange:o=>te(Number(o.target.value)),InputProps:{endAdornment:e.jsx(t,{variant:"body2",children:"₫"})},helperText:`Tối đa: ${r.total_amount.toLocaleString("vi-VN")} ₫`,inputProps:{min:0,max:r.total_amount}})}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(L,{children:"Phương thức hoàn tiền"}),e.jsxs(M,{value:se,label:"Phương thức hoàn tiền",onChange:o=>re(o.target.value),children:[e.jsx(l,{value:"cash",children:"Tiền mặt"}),e.jsx(l,{value:"card",children:"Hoàn về thẻ"}),e.jsx(l,{value:"store_credit",children:"Tín dụng cửa hàng"})]})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(R,{fullWidth:!0,label:"Lý do hoàn tiền",multiline:!0,rows:3,value:H,onChange:o=>ae(o.target.value),placeholder:"Nhập lý do hoàn tiền...",required:!0})})]})]})}),e.jsxs(_e,{children:[e.jsx(j,{onClick:()=>$(!1),children:"Hủy"}),e.jsx(j,{variant:"contained",color:"warning",onClick:Re,disabled:v||!H.trim()||K<=0,children:v?"Đang xử lý...":"Xác nhận hoàn tiền"})]})]})]})};export{Pn as default};
