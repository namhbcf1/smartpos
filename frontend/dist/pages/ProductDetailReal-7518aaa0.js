import{j as e,af as x,W as s,ad as N,T as n,I as D,ae as m,t as j,C as h,aj as a,P as B,Y as k,Z as W,a3 as w}from"../chunks/mui-core-cd9e8750.js";import{j as K,u as F,r as f}from"../chunks/react-vendor-9ee90314.js";import{$ as S,l as P,k as G,y as H,j as z,S as M,E as O,W as Q,a as V}from"../chunks/mui-icons-f0327ae6.js";const X=()=>{const{id:p}=K(),g=F(),[t,L]=f.useState(null),[R,b]=f.useState(!0),[y,l]=f.useState(null);f.useEffect(()=>{v()},[p]);const v=async()=>{try{b(!0),l(null),console.log("🔍 Fetching product with ID:",p),console.log("📡 Calling SmartPOS API...");const i=await(await fetch("https://smartpos-api.bangachieu2.workers.dev/api/v1/products?limit=100")).json();if(console.log("📦 D1 Database response:",i),i.success&&i.data&&i.data.data){const c=i.data.data.find(E=>E.id===parseInt(p||"0"));c?(console.log("✅ Found product from D1:",c),L(c)):(console.log("❌ Product not found in D1"),l("Không tìm thấy sản phẩm"))}else console.log("❌ Invalid D1 response format"),l("Không thể tải dữ liệu từ D1 Database")}catch(r){console.error("❌ Error fetching from D1:",r),l("Lỗi kết nối D1 Database")}finally{b(!1)}},o=r=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r),T=r=>new Date(r).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),$=(r,i)=>r<=0?{label:"Hết hàng",color:"error",icon:e.jsx(O,{})}:r<=i?{label:"Sắp hết",color:"warning",icon:e.jsx(Q,{})}:{label:"Còn hàng",color:"success",icon:e.jsx(V,{})},A=(r,i)=>{const u=r-i,c=u/i*100;return{profit:u,margin:c}};if(R)return e.jsx(x,{maxWidth:"lg",sx:{py:4},children:e.jsxs(s,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",children:[e.jsx(N,{size:60,sx:{mb:2}}),e.jsx(n,{variant:"h6",color:"text.secondary",children:"Đang tải dữ liệu từ D1 Cloudflare..."})]})});if(y)return e.jsxs(x,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(s,{display:"flex",alignItems:"center",mb:3,children:[e.jsx(D,{onClick:()=>g("/sales/new"),sx:{mr:2},children:e.jsx(S,{})}),e.jsx(n,{variant:"h4",component:"h1",children:"Chi tiết sản phẩm"})]}),e.jsx(m,{severity:"error",sx:{mb:3},children:y}),e.jsx(j,{variant:"contained",onClick:v,children:"Thử lại"})]});if(!t)return e.jsx(x,{maxWidth:"lg",sx:{py:4},children:e.jsx(m,{severity:"info",children:"Không tìm thấy sản phẩm"})});const d=$(t.stockQuantity,t.stockAlertThreshold),{profit:C,margin:I}=A(t.price,t.costPrice);return e.jsxs(x,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(s,{display:"flex",alignItems:"center",mb:4,children:[e.jsx(D,{onClick:()=>g("/sales/new"),sx:{mr:2},children:e.jsx(S,{})}),e.jsx(n,{variant:"h4",component:"h1",sx:{flexGrow:1},children:"Chi tiết sản phẩm"}),e.jsx(h,{label:"D1 CLOUDFLARE",color:"primary",variant:"filled",sx:{fontWeight:"bold"}})]}),e.jsx(m,{severity:"success",sx:{mb:3},children:e.jsxs(n,{variant:"body2",children:["✅ ",e.jsx("strong",{children:"Dữ liệu thực tế 100%"})," - Được lấy trực tiếp từ D1 Cloudflare Database"]})}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,md:4,children:e.jsxs(B,{elevation:3,sx:{p:4,textAlign:"center",background:"linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%)",border:"2px dashed #cbd5e1",borderRadius:2},children:[e.jsx(s,{sx:{fontSize:"4rem",color:"#cbd5e1",mb:2},children:"📦"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Hình ảnh sản phẩm"})]})}),e.jsx(a,{item:!0,xs:12,md:8,children:e.jsx(k,{elevation:3,children:e.jsxs(W,{sx:{p:3},children:[e.jsx(n,{variant:"h5",component:"h2",gutterBottom:!0,sx:{fontWeight:"bold"},children:t.name}),e.jsxs(s,{display:"flex",gap:1,mb:3,flexWrap:"wrap",children:[e.jsx(h,{icon:d.icon,label:d.label,color:d.color,variant:"filled"}),e.jsx(h,{label:t.isActive?"Hoạt động":"Không hoạt động",color:t.isActive?"success":"default",variant:"outlined"}),e.jsx(h,{label:"REALTIME",color:"primary",variant:"filled",sx:{fontWeight:"bold"}})]}),e.jsx(w,{sx:{my:2}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(s,{sx:{"& > div":{mb:2}},children:[e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{p:1.5,bgcolor:"#f8fafc",borderRadius:1,borderLeft:"4px solid #0ea5e9"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(P,{sx:{mr:1,color:"text.secondary"}}),e.jsx(n,{variant:"body2",fontWeight:"600",color:"text.secondary",children:"SKU:"})]}),e.jsx(n,{variant:"body2",fontWeight:"500",children:t.sku})]}),t.barcode&&e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{p:1.5,bgcolor:"#f8fafc",borderRadius:1,borderLeft:"4px solid #0ea5e9"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(P,{sx:{mr:1,color:"text.secondary"}}),e.jsx(n,{variant:"body2",fontWeight:"600",color:"text.secondary",children:"Barcode:"})]}),e.jsx(n,{variant:"body2",fontWeight:"500",children:t.barcode})]}),e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{p:1.5,bgcolor:"#f8fafc",borderRadius:1,borderLeft:"4px solid #0ea5e9"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(G,{sx:{mr:1,color:"text.secondary"}}),e.jsx(n,{variant:"body2",fontWeight:"600",color:"text.secondary",children:"Danh mục:"})]}),e.jsx(n,{variant:"body2",fontWeight:"500",children:t.categoryName||"Chưa phân loại"})]})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(s,{sx:{"& > div":{mb:2}},children:[e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{p:1.5,bgcolor:"#f8fafc",borderRadius:1,borderLeft:"4px solid #dc2626"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(H,{sx:{mr:1,color:"text.secondary"}}),e.jsx(n,{variant:"body2",fontWeight:"600",color:"text.secondary",children:"Giá bán:"})]}),e.jsx(n,{variant:"h6",color:"error.main",fontWeight:"bold",children:o(t.price)})]}),e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{p:1.5,bgcolor:"#f8fafc",borderRadius:1,borderLeft:"4px solid #0ea5e9"},children:[e.jsx(n,{variant:"body2",fontWeight:"600",color:"text.secondary",children:"Giá vốn:"}),e.jsx(n,{variant:"body2",fontWeight:"500",children:o(t.costPrice)})]}),e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{p:1.5,bgcolor:"#f0fdf4",borderRadius:1,borderLeft:"4px solid #16a34a"},children:[e.jsx(n,{variant:"body2",fontWeight:"600",color:"success.main",children:"Lợi nhuận:"}),e.jsxs(n,{variant:"body2",fontWeight:"bold",color:"success.main",children:[o(C)," (",I.toFixed(1),"%)"]})]}),e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{p:1.5,bgcolor:"#f8fafc",borderRadius:1,borderLeft:"4px solid #0ea5e9"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(z,{sx:{mr:1,color:"text.secondary"}}),e.jsx(n,{variant:"body2",fontWeight:"600",color:"text.secondary",children:"Tồn kho:"})]}),e.jsxs(n,{variant:"body2",fontWeight:"500",children:[t.stockQuantity," sản phẩm"]})]})]})})]})]})})})]}),e.jsx(k,{elevation:3,sx:{mt:3},children:e.jsxs(W,{sx:{p:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"📝 Mô tả chi tiết"}),e.jsx(w,{sx:{mb:2}}),e.jsx(s,{sx:{bgcolor:"#f8fafc",p:3,borderRadius:2,whiteSpace:"pre-line",lineHeight:1.6},children:e.jsx(n,{variant:"body2",children:`🔧 Thông số kỹ thuật:
• SKU: ${t.sku}
• Danh mục: ${t.categoryName||"Linh kiện máy tính"}
• Barcode: ${t.barcode||"Không có"}

💰 Thông tin giá:
• Giá bán: ${o(t.price)}
• Giá vốn: ${o(t.costPrice)}
• Lợi nhuận: ${o(C)} (${I.toFixed(1)}%)
• Thuế VAT: ${t.taxRate*100}%

📦 Tồn kho:
• Số lượng hiện có: ${t.stockQuantity} sản phẩm
• Mức cảnh báo: ${t.stockAlertThreshold} sản phẩm
• Trạng thái: ${d.label}

✅ Trạng thái: ${t.isActive?"Đang kinh doanh":"Ngừng kinh doanh"}
📅 Ngày tạo: ${T(t.created_at)}

Sản phẩm chất lượng cao, được quản lý bằng hệ thống SmartPOS với dữ liệu thực tế từ D1 Cloudflare Database.`})})]})}),e.jsxs(s,{display:"flex",gap:2,justifyContent:"center",mt:4,children:[e.jsx(j,{variant:"contained",size:"large",startIcon:e.jsx(M,{}),onClick:()=>g("/sales/new"),sx:{px:4},children:"Quay lại POS"}),e.jsx(j,{variant:"outlined",size:"large",onClick:()=>window.open("https://smartpos-api.bangachieu2.workers.dev/api/v1/products","_blank"),sx:{px:4},children:"Xem API Raw"})]})]})};export{X as default};
